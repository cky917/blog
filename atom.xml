<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¸€åªå¾ˆé…·çš„è˜‘è‡</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.chenkeyi.com/"/>
  <updated>2018-05-07T04:43:55.833Z</updated>
  <id>http://blog.chenkeyi.com/</id>
  
  <author>
    <name>é™ˆæŸ¯ä¼Š</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>çºªå¿µä¸€ä¸‹å‘å¸ƒçš„ç¬¬ä¸€ä¸ªnpmæ¨¡å—</title>
    <link href="http://blog.chenkeyi.com/2018/05/07/ip-proxy-request/"/>
    <id>http://blog.chenkeyi.com/2018/05/07/ip-proxy-request/</id>
    <published>2018-05-07T04:36:00.000Z</published>
    <updated>2018-05-07T04:43:55.833Z</updated>
    
    <content type="html"><![CDATA[<p>çºªå¿µä¸€ä¸‹å‘å¸ƒçš„ç¬¬ä¸€ä¸ªnpmæ¨¡å—ğŸ˜‚ï¼Œ å› ä¸ºæœ€è¿‘ç ”ç©¶nodeçˆ¬è™«ï¼Œéœ€è¦å…è´¹åŠ¨æ€ipä»£ç†å‘å‡ºè¯·æ±‚ï¼Œæ‰€ä»¥æäº†ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºè·å–å…è´¹ipä»£ç†å¹¶ä¸”å‘å‡ºè¯·æ±‚ã€‚åœ°å€:<a href="https://www.npmjs.com/package/ip-proxy-request" target="_blank" rel="noopener">https://www.npmjs.com/package/ip-proxy-request</a></p><p>ä¸»è¦å­¦ä¹ ä¸€ä¸‹npmçš„å‘å¸ƒæµç¨‹ï¼Œè¿˜é¡ºä¾¿å­¦ä¹ å®è·µäº†ä¸€ä¸‹å•æµ‹<code>jest</code>å’ŒæŒç»­é›†æˆ<code>travis</code>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;çºªå¿µä¸€ä¸‹å‘å¸ƒçš„ç¬¬ä¸€ä¸ªnpmæ¨¡å—ğŸ˜‚ï¼Œ å› ä¸ºæœ€è¿‘ç ”ç©¶nodeçˆ¬è™«ï¼Œéœ€è¦å…è´¹åŠ¨æ€ipä»£ç†å‘å‡ºè¯·æ±‚ï¼Œæ‰€ä»¥æäº†ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºè·å–å…è´¹ipä»£ç†å¹¶ä¸”å‘å‡ºè¯·æ±‚ã€‚åœ°å€:&lt;a href=&quot;https://www.npmjs.com/package/ip-proxy-request&quot; targ
      
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>vueæºç å­¦ä¹ ç¬”è®°--äº‹ä»¶æœºåˆ¶</title>
    <link href="http://blog.chenkeyi.com/2018/03/21/vue-source-code-study-4/"/>
    <id>http://blog.chenkeyi.com/2018/03/21/vue-source-code-study-4/</id>
    <published>2018-03-21T13:40:00.000Z</published>
    <updated>2018-03-21T14:17:32.068Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ¥çœ‹çœ‹vueçš„äº‹ä»¶ç›¸å…³æ–¹æ³•ï¼Œæœ¬æ¥æƒ³å…ˆçœ‹æ¨¡æ¿æ¸²æŸ“å’Œè™šæ‹Ÿdomç›¸å…³çš„å†…å®¹ï¼Œä½†æ˜¯çœ‹äº†2å¤©ä¹‹åï¼Œæ„Ÿè§‰é‚£ä¸€å—å†…å®¹å¾ˆå¤šè€Œä¸”éš¾- -ï¼Œæ‰€ä»¥å…ˆå•ƒè¿™å—æ¯”è¾ƒç®€å•ä¸€ç‚¹çš„éª¨å¤´å¥½äº†ã€‚<br><a id="more"></a><br>åœ¨å®ä¾‹åŒ–<code>Vue</code>çš„æ—¶å€™ï¼Œåˆå§‹åŒ–è¿‡ç¨‹ä¼šè°ƒç”¨ä¸€ä¸ª<code>initEvent</code>å‡½æ•°ï¼Œ<a href="https://github.com/vuejs/vue/blob/dev/src/core/instance/events.js" target="_blank" rel="noopener">initEvent</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initEvents</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// _eventså¯¹è±¡æ¥ç¼“å­˜äº‹ä»¶</span></span><br><span class="line">  vm._events = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">  vm._hasHookEvent = <span class="literal">false</span></span><br><span class="line">  <span class="comment">// init parent attached events</span></span><br><span class="line">  <span class="comment">// æ¨¡æ¿äº‹ä»¶ç›¸å…³ï¼Œå…ˆä¸è¯´</span></span><br><span class="line">  <span class="comment">// const listeners = vm.$options._parentListeners</span></span><br><span class="line">  <span class="comment">// if (listeners) &#123;</span></span><br><span class="line">  <span class="comment">//   updateComponentListeners(vm, listeners)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆå§‹åŒ–äº‹ä»¶çš„æ–¹æ³•é‡Œï¼Œä¸»è¦æ˜¯ç”Ÿæˆäº†ä¸€ä¸ª<code>vm._events</code>å¯¹è±¡æ¥ç¼“å­˜äº‹ä»¶ï¼Œ<code>vm._hasHookEvent</code>æ¥æ ‡è¯†æ˜¯å¦æœ‰é’©å­äº‹ä»¶</p><p><code>Vue</code>æä¾›äº†4ä¸ªå®ä¾‹æ–¹æ³•ä¾›æˆ‘ä»¬æ³¨å†Œå’Œè§¦å‘äº‹ä»¶ã€‚<a href="https://cn.vuejs.org/v2/api/#vm-on" target="_blank" rel="noopener">vm.$on</a>ã€<a href="https://cn.vuejs.org/v2/api/#vm-once" target="_blank" rel="noopener">vm.$once</a>ã€<a href="https://cn.vuejs.org/v2/api/#vm-off" target="_blank" rel="noopener">vm.$off</a>ã€<a href="https://cn.vuejs.org/v2/api/#vm-emit" target="_blank" rel="noopener">vm.$emit</a></p><p>ä¸‹é¢æ¥åˆ†åˆ«çœ‹çœ‹å®ƒä»¬çš„å®ç°</p><h2 id="vm-on"><a href="#vm-on" class="headerlink" title="vm.$on"></a>vm.$on</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hookRE = <span class="regexp">/^hook:/</span></span><br><span class="line">Vue.prototype.$on = <span class="function"><span class="keyword">function</span> (<span class="params">event: string | Array&lt;string&gt;, fn: Function</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¼ å…¥çš„eventæ˜¯æ•°ç»„ï¼Œåˆ™å¾ªç¯æ¯ä¸ªeventï¼Œé€’å½’è°ƒç”¨$onç»‘å®š</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(event)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = event.length; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$on(event[i], fn)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœvm._events[event]æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å‚¨å­˜äº†è§¦å‘è¿™ä¸ªäº‹ä»¶æ—¶çš„å›è°ƒæ–¹æ³•å®šä¹‰</span></span><br><span class="line">    <span class="comment">// å¦‚æœå­˜åœ¨å°±ç›´æ¥pushï¼Œå¦åˆ™åˆå§‹åŒ–[]</span></span><br><span class="line">    (vm._events[event] || (vm._events[event] = [])).push(fn)</span><br><span class="line">    <span class="comment">// optimize hook:event cost by using a boolean flag marked at registration</span></span><br><span class="line">    <span class="comment">// instead of a hash lookup</span></span><br><span class="line">    <span class="comment">// å¦‚æœeventåŒ…å« hook:xx åˆ™æ ‡è®°_hasHookEventä¸ºtrue</span></span><br><span class="line">    <span class="keyword">if</span> (hookRE.test(event)) &#123;</span><br><span class="line">      vm._hasHookEvent = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="vm-emit"><a href="#vm-emit" class="headerlink" title="vm.$emit"></a>vm.$emit</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$emit = <span class="function"><span class="keyword">function</span> (<span class="params">event: string</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> lowerCaseEvent = event.toLowerCase()</span><br><span class="line">    <span class="keyword">if</span> (lowerCaseEvent !== event &amp;&amp; vm._events[lowerCaseEvent]) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœå°å†™å½¢å¼çš„eventè¢«æ³¨å†Œäº†ï¼Œä½†æ˜¯æœ¬èº«ä¼ å…¥çš„ä¸æ˜¯å°å†™å½¢å¼ï¼Œåˆ™å‹æƒ…æç¤º</span></span><br><span class="line">      <span class="comment">// tip(</span></span><br><span class="line">      <span class="comment">//   `Event "$&#123;lowerCaseEvent&#125;" is emitted in component ` +</span></span><br><span class="line">      <span class="comment">//   `$&#123;formatComponentName(vm)&#125; but the handler is registered for "$&#123;event&#125;". ` +</span></span><br><span class="line">      <span class="comment">//   `Note that HTML attributes are case-insensitive and you cannot use ` +</span></span><br><span class="line">      <span class="comment">//   `v-on to listen to camelCase events when using in-DOM templates. ` +</span></span><br><span class="line">      <span class="comment">//   `You should probably use "$&#123;hyphenate(event)&#125;" instead of "$&#123;event&#125;".`</span></span><br><span class="line">      <span class="comment">// )</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¯¥eventçš„å›è°ƒå‡½æ•°åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">let</span> cbs = vm._events[event]</span><br><span class="line">  <span class="keyword">if</span> (cbs) &#123;</span><br><span class="line">    cbs = cbs.length &gt; <span class="number">1</span> ? toArray(cbs) : cbs</span><br><span class="line">    <span class="comment">// å°†å‰©ä½™çš„å‚æ•°è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">    <span class="keyword">const</span> args = toArray(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = cbs.length; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="comment">// ä¾æ¬¡è°ƒç”¨å›è°ƒå‡½æ•°</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        cbs[i].apply(vm, args)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        handleError(e, vm, <span class="string">`event handler for "<span class="subst">$&#123;event&#125;</span>"`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸‹ä»£ç è¯•è¯•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a.$on(<span class="string">'say'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'say'</span> + name)</span><br><span class="line">&#125;)</span><br><span class="line">a.$on(<span class="string">'say'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'say2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">a.$on(<span class="string">'sing'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">song</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'sing a song: '</span> + song)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="/images/15.png"><br><img src="/images/16.png"><br>å¯ä»¥çœ‹åˆ°äº‹ä»¶æ³¨å†Œåˆ°äº†<code>_events</code>é‡Œï¼Œç„¶å<code>$emit</code>è§¦å‘ã€‚è€Œä¸”æ–¹æ³•è¿”å›çš„æ˜¯<code>vm</code>å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œé“¾å¼è°ƒç”¨<br><img src="/images/17.png"></p><h2 id="vm-off"><a href="#vm-off" class="headerlink" title="vm.$off"></a>vm.$off</h2><blockquote><p>å‚æ•°ï¼š<br><code>{string | Array&lt;string&gt;} event</code> (åªåœ¨ 2.2.2+ æ”¯æŒæ•°ç»„)<br><code>{Function} [callback]</code></p></blockquote><blockquote><p>ç”¨æ³•ï¼š</p><ul><li>ç§»é™¤è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨ã€‚</li><li>å¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™ç§»é™¤æ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼›</li><li>å¦‚æœåªæä¾›äº†äº‹ä»¶ï¼Œåˆ™ç§»é™¤è¯¥äº‹ä»¶æ‰€æœ‰çš„ç›‘å¬å™¨ï¼›</li><li>å¦‚æœåŒæ—¶æä¾›äº†äº‹ä»¶ä¸å›è°ƒï¼Œåˆ™åªç§»é™¤è¿™ä¸ªå›è°ƒçš„ç›‘å¬å™¨ã€‚</li></ul></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$off = <span class="function"><span class="keyword">function</span> (<span class="params">event?: string | Array&lt;string&gt;, fn?: Function</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">  <span class="comment">// all</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬ï¼Œ_eventsè®¾ä¸ºç©ºå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">arguments</span>.length) &#123;</span><br><span class="line">    vm._events = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// array of events</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¼ äº†æ•°ç»„eventï¼Œåˆ™å¾ªç¯é€’å½’è°ƒç”¨$offç§»é™¤æ¯ä¸ªevent</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(event)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = event.length; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$off(event[i], fn)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// specific event</span></span><br><span class="line">  <span class="comment">// å•ä¸ªeventï¼Œå¦‚æœæ²¡è¢«æ³¨å†Œï¼Œåˆ™è¿”å›</span></span><br><span class="line">  <span class="keyword">const</span> cbs = vm._events[event]</span><br><span class="line">  <span class="keyword">if</span> (!cbs) &#123;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰ä¼ å…¥fnï¼Œåˆ™è¿™ä¸ªeventçš„å›è°ƒå…¨éƒ¨æ¸…ç©º</span></span><br><span class="line">  <span class="keyword">if</span> (!fn) &#123;</span><br><span class="line">    vm._events[event] = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœä¼ äº†fn, åˆ™å¾ªç¯å›è°ƒåˆ—è¡¨åˆ é™¤è¯¥fn</span></span><br><span class="line">  <span class="keyword">if</span> (fn) &#123;</span><br><span class="line">    <span class="comment">// specific handler</span></span><br><span class="line">    <span class="keyword">let</span> cb</span><br><span class="line">    <span class="keyword">let</span> i = cbs.length</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      cb = cbs[i]</span><br><span class="line">      <span class="comment">// cb.fnè§$once</span></span><br><span class="line">      <span class="keyword">if</span> (cb === fn || cb.fn === fn) &#123;</span><br><span class="line">        cbs.splice(i, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="vm-once"><a href="#vm-once" class="headerlink" title="vm.$once"></a>vm.$once</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$once = <span class="function"><span class="keyword">function</span> (<span class="params">event: string, fn: Function</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">on</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    vm.$off(event, on)</span><br><span class="line">    fn.apply(vm, <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åœ¨$onæ–¹æ³•æ³¨å†Œeventï¼Œä¸”é‡æ–°å®šä¹‰ä¸€ä¸ªå›è°ƒï¼Œåœ¨å›è°ƒé‡Œè°ƒ$offæ–¹æ³•ç§»é™¤äº‹ä»¶ç»‘å®šï¼ŒæŠŠåŸæ¥çš„fnèµ‹å€¼ç»™on.fn</span></span><br><span class="line">  on.fn = fn</span><br><span class="line">  vm.$on(event, on)</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="hook-event"><a href="#hook-event" class="headerlink" title="hook event"></a>hook event</h2><p>ä¹‹å‰è¯´çš„<code>_hasHookEvent</code>ï¼Œç”¨äºæ ‡è¯†æ˜¯å¦æœ‰æ³¨å†Œè¿‡é’©å­å‡½æ•°ï¼Œé’©å­å‡½æ•°çš„å•ç‹¬æ³¨å†Œå°±æ˜¯ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚æˆ‘æ„Ÿè§‰è¿™ä¸ªå•ç‹¬æ³¨å†Œé’©å­å‡½æ•°çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯ç”¨äºæµ‹è¯•æ–¹ä¾¿ã€‚å¹³æ—¶ä½¿ç”¨è¿˜æ˜¯åœ¨<code>options</code>é‡Œç›´æ¥å®šä¹‰çš„å¤šã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$on(<span class="string">'hook:created'</span>, created)</span><br><span class="line"><span class="keyword">this</span>.$on(<span class="string">'hook:mounted'</span>, mounted)</span><br><span class="line"><span class="keyword">this</span>.$on(<span class="string">'hook:destroyed'</span>, destroyed)</span><br></pre></td></tr></table></figure><p>ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ç­‰ä¼šåœ¨æŒ‡å®šæ—¶æœŸçš„ä»£ç å†…éƒ¨è°ƒç”¨<code>callHook</code>æ–¹æ³•è¿›è¡Œè§¦å‘</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">callHook</span> (<span class="params">vm: Component, hook: string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> handlers = vm.$options[hook]</span><br><span class="line">  <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, j = handlers.length; i &lt; j; i++) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        handlers[i].call(vm)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        handleError(e, vm, <span class="string">`<span class="subst">$&#123;hook&#125;</span> hook`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm._hasHookEvent) &#123;</span><br><span class="line">    vm.$emit(<span class="string">'hook:'</span> + hook)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ¥çœ‹çœ‹vueçš„äº‹ä»¶ç›¸å…³æ–¹æ³•ï¼Œæœ¬æ¥æƒ³å…ˆçœ‹æ¨¡æ¿æ¸²æŸ“å’Œè™šæ‹Ÿdomç›¸å…³çš„å†…å®¹ï¼Œä½†æ˜¯çœ‹äº†2å¤©ä¹‹åï¼Œæ„Ÿè§‰é‚£ä¸€å—å†…å®¹å¾ˆå¤šè€Œä¸”éš¾- -ï¼Œæ‰€ä»¥å…ˆå•ƒè¿™å—æ¯”è¾ƒç®€å•ä¸€ç‚¹çš„éª¨å¤´å¥½äº†ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="vueæºç å­¦ä¹ " scheme="http://blog.chenkeyi.com/tags/vue%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>blogæŠ˜è…¾å°è®°ï¼Œandç¥å™¨æ¨è</title>
    <link href="http://blog.chenkeyi.com/2018/03/21/blog-transfer/"/>
    <id>http://blog.chenkeyi.com/2018/03/21/blog-transfer/</id>
    <published>2018-03-21T07:38:00.000Z</published>
    <updated>2018-03-21T08:42:54.640Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™2å¤©æŠŠåšå®¢æ¢äº†ä¸ªåŸŸåï¼Œé‚£ä¸ª<code>coolmogu</code>çš„åŸŸåä¸å‡†å¤‡ç»­è´¹äº†- -ï¼Œç›®å‰éƒ½å¼ºåˆ¶302åˆ°äº†è¿™ä¸ªåŸŸåã€‚è·Ÿç€è¿™ä¸ª<a href="https://www.gaoshilei.com/2017/10/30/hexo-init/" target="_blank" rel="noopener">æ•™ç¨‹</a>æäº†https+githubçš„<code>webhook</code>ï¼ŒåŸŸåå‰é¢æœ‰ä¸ªç»¿è‰²çš„æ ‡å¿—çœ‹ä¸Šå»å°±æ˜¯çˆ½~~<br><img src="https://t10.baidu.com/it/u=558790623,3064289337&amp;fm=170&amp;s=C55F38D29ED69E82E38D05730100A0E2&amp;w=198&amp;h=156&amp;img.JPEG" alt="åŠ›é‡!"></p><p>è¯è¯´ä¹‹å‰ä¸æ˜¯æäº†ä¸ªå¾®ä¿¡å…¬ä¼—å·çˆ¬è™«å’©ï¼Œåæ¥å› ä¸ºç¬¬ä¸‰æ–¹éªŒè¯ç è¯†åˆ«æ¥å£æ¶¨ä»·äº†ï¼Œå°±ç›´æ¥å¼ƒç”¨äº†ã€‚è€Œä¸”æˆ‘å‘ç°æˆ‘çˆ¬çš„é‚£äº›å…¬ä¼—å·å…¶å®éƒ½æœ‰è‡ªå·±çš„ç½‘ç«™ï¼Œä¹Ÿæä¾›äº†<code>rss</code>ï¼Œè¿™ç§ä¿¡æ¯èšåˆçš„åŠŸèƒ½è¿˜æ˜¯<code>rss</code>å¥½ç”¨å•Šã€‚è¿™é‡Œè¦æ¨èä¸€ä¸ªmacçš„rssç¥å™¨ â€“ <code>reeder</code>ï¼Œè™½ç„¶è¦èŠ±å‡ åå—é’±è´­ä¹°ï¼Œä½†æ˜¯å®Œå…¨ç‰©è¶…æ‰€å€¼å•Šã€‚<br>ç•Œé¢ä¸»è¦å¤§è‡´å¦‚ä¸‹ï¼Œ<br><img src="/images/rss.png"><br>è®¢é˜…äº†ä¸€äº›å‰ç«¯æ–‡ç« åšå®¢ä¹‹ç±»çš„ï¼Œæ„Ÿè§‰é˜…è¯»ä½“éªŒå’Œä½¿ç”¨ä½“éªŒå¾ˆæ£’ã€‚</p><p>æˆ‘ç»™æˆ‘çš„åšå®¢ä¹Ÿå¢åŠ äº†rssåŠŸèƒ½ï¼Œ<a href="https://blog.chenkeyi.com/atom.xml">æ¬¢è¿è®¢é˜…~</a></p><p>ä¹‹å‰åœ¨githubä¸Šçœ‹è§ä¹Ÿæœ‰å¤§ä½¬è‡ªå·±å†™æ¥å£æä¾›å„ç§ä¿¡æ¯çš„rssé¡µé¢ï¼Œæ„Ÿè§‰ä¹‹åä¹Ÿå¯ä»¥æä¸€æ³¢ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™2å¤©æŠŠåšå®¢æ¢äº†ä¸ªåŸŸåï¼Œé‚£ä¸ª&lt;code&gt;coolmogu&lt;/code&gt;çš„åŸŸåä¸å‡†å¤‡ç»­è´¹äº†- -ï¼Œç›®å‰éƒ½å¼ºåˆ¶302åˆ°äº†è¿™ä¸ªåŸŸåã€‚è·Ÿç€è¿™ä¸ª&lt;a href=&quot;https://www.gaoshilei.com/2017/10/30/hexo-init/&quot; target=&quot;_bla
      
    
    </summary>
    
    
      <category term="ç”Ÿæ´»çäº‹" scheme="http://blog.chenkeyi.com/tags/%E7%94%9F%E6%B4%BB%E7%90%90%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title>vueæºç å­¦ä¹ ç¬”è®°--Vueæ•°æ®å“åº”å¼åŸç†</title>
    <link href="http://blog.chenkeyi.com/2018/03/19/vue-source-code-study-3/"/>
    <id>http://blog.chenkeyi.com/2018/03/19/vue-source-code-study-3/</id>
    <published>2018-03-19T10:32:00.000Z</published>
    <updated>2018-03-21T04:33:42.165Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/cky917/vue-source-code-study" target="_blank" rel="noopener">å­¦ä¹ ä»£ç ä»“åº“</a></p><a id="more"></a><p>ä»Šå¤©æ¥çœ‹Vueçš„æ•°æ®å“åº”å¼åŸç†ï¼Œä¹Ÿå°±æ˜¯watchä¸€ä¸ªå€¼ï¼Œæ”¹å˜äº†è¿™ä¸ªæ•°æ®ï¼Œèƒ½å¤Ÿå¾—åˆ°é€šçŸ¥å¹¶ä¸”åœ¨å›è°ƒé‡Œè·å¾—æ–°å€¼å’Œæ—§å€¼ä»è€Œè¿›è¡Œæ“ä½œï¼Œè¿™ä¸€ä¸ªåŠŸèƒ½çš„å®ç°ã€‚æœ¬ç¯‡æš‚ä¸åŒ…å«ä¸æ¨¡æ¿å±‚çš„åŒå‘ç»‘å®šã€‚</p><h2 id="æ•°æ®åˆå§‹åŒ–"><a href="#æ•°æ®åˆå§‹åŒ–" class="headerlink" title="æ•°æ®åˆå§‹åŒ–"></a>æ•°æ®åˆå§‹åŒ–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo/index.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vue3</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._init(options)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¯æ¬¡æ‰§è¡Œnew Vue()æ“ä½œéƒ½ä¼šæ‰§è¡Œçš„æ„é€ å‡½æ•°</span></span><br><span class="line">Vue3.prototype._init = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm = <span class="keyword">this</span></span><br><span class="line">  vm.$options = options || &#123;&#125;</span><br><span class="line">  vm._watchers = []</span><br><span class="line">  <span class="keyword">if</span> (vm.$options.data) initData(vm)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initData</span>(<span class="params">vm</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data = vm.$options.data</span><br><span class="line">  <span class="comment">// å°†é…ç½®é¡¹dataçš„å€¼æŒ‚è½½åœ¨vm._dataä¸Šï¼Œå¦‚æœdataæ˜¯ä¸ªå‡½æ•°ï¼Œåˆ™è°ƒç”¨`getData`æ–¹æ³•è·å–è¿”å›å€¼</span></span><br><span class="line">  data = vm._data = <span class="keyword">typeof</span> data === <span class="string">'function'</span> ? getData(data, vm) : data || &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...çœç•¥dataçš„æ ¡éªŒæ­¥éª¤</span></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(data)</span><br><span class="line">  <span class="keyword">let</span> i = keys.length</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="comment">// ...çœç•¥dataçš„keyå€¼æ ¡éªŒæ­¥éª¤</span></span><br><span class="line">    <span class="comment">// éå† data çš„ keyï¼ŒæŠŠ data ä¸Šçš„å±æ€§ä»£ç†åˆ° vm å®ä¾‹ä¸Š</span></span><br><span class="line">    proxy(vm, <span class="string">'_data'</span>, key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// observe(data, true /* asRootData */)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">data, vm</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> data.call(vm, vm)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(e)</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noop</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">proxy</span>(<span class="params">target, sourceKey, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> sharedPropertyDefinition = &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    get: noop,</span><br><span class="line">    set: noop</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è·å– vm[key]å€¼çš„æ—¶å€™ï¼Œè¿”å›vm._data[key]</span></span><br><span class="line">  sharedPropertyDefinition.get = <span class="function"><span class="keyword">function</span> <span class="title">proxyGetter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[sourceKey][key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è®¾ç½® vm[key]å€¼çš„æ—¶å€™ï¼Œvm._data[key] = val</span></span><br><span class="line">  sharedPropertyDefinition.set = <span class="function"><span class="keyword">function</span> <span class="title">proxySetter</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>[sourceKey][key] = val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†[key]æŒ‚è½½åœ¨vmä¸Š</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(target, key, sharedPropertyDefinition)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Vue3 = Vue3</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šçš„åˆå§‹åŒ–ï¼ŒæˆåŠŸè®©é…ç½®é¡¹é‡Œ<code>data</code>çš„æ¯ä¸ªå€¼éƒ½æŒ‚åˆ°äº†<code>vm</code>å®ä¾‹ä¸Šã€‚å¹¶ä¸”<code>vm[key]</code>çš„æ“ä½œä¼šåŒæ­¥åˆ°<code>vm._data[key]</code>ä¸Š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Vue3(&#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">'cky'</span>,</span><br><span class="line">      age: <span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="/images/5.png"><br><img src="/images/6.png"></p><h2 id="Observerã€Watcherã€Dep"><a href="#Observerã€Watcherã€Dep" class="headerlink" title="Observerã€Watcherã€Dep"></a>Observerã€Watcherã€Dep</h2><p>æ¥ä¸‹æ¥è¦è¯´çš„ä¸‰ä¸ªç±»<code>Observer</code>ã€<code>Watcher</code>ã€<code>Dep</code>ï¼Œæˆ‘ä»¬å…ˆæå‰ææ¸…æ¥šä»–ä»¬ä¸‰ä¸ªçš„ä½œç”¨ã€‚<br><code>Observer</code>ç±»æ˜¯ç”¨æ¥æŠŠä¸€ä¸ªå€¼å˜å¾—å¯è§‚æµ‹çš„å·¥å…·ï¼Œå®ƒä¼šå¾ªç¯ä¼ å…¥çš„å€¼ï¼Œç„¶åæ”¹å†™å®ƒä»¬çš„<code>getter/setter</code>ã€‚å®ƒçš„å®ä¾‹æ–¹æ³•æœ‰<code>observeArray</code>å’Œ<code>walk</code>ï¼Œåˆ†åˆ«æŠŠæ•°ç»„å’Œå¯¹è±¡ç±»å‹å˜å¾—å¯è§‚æµ‹ã€‚</p><p><code>Watcher</code>å¯ä»¥è®¾å®šå¤šä¸ªè§‚å¯Ÿå¯¹è±¡ï¼Œç„¶åå¯¹äºå®ƒä»¬çš„æ”¹å˜åšå‡ºç›¸åº”è¡Œä¸ºã€‚å®ƒçš„å®ä¾‹æ–¹æ³•æœ‰ä»¥ä¸‹ï¼š</p><ul><li><code>get()</code>ã€‚æ ¹æ®ä¼ å…¥çš„è¡¨è¾¾å¼æˆ–å‡½æ•°ï¼Œè®¡ç®—å‡ºå€¼</li><li><code>addDep(dep)</code>ã€‚å¦‚æœæ²¡æœ‰å°†è‡ªèº«ä¼ å…¥è¿‡è¯¥<code>dep</code>è®°å½•ä¾èµ–,åˆ™å°†è‡ªèº«ä¼ å…¥ï¼Œè°ƒç”¨<code>dep.addSub(this)</code></li><li><code>cleanupDeps()</code>ã€‚æ¸…ç†ä¸å†ä¾èµ–çš„<code>dep</code>, åŒæ—¶åœ¨<code>dep</code>çš„ä¾èµ–åˆ—è¡¨ä¸­ç§»é™¤è‡ªèº«</li><li><code>update()</code>ã€‚è®¢é˜…è€…æ¥å£ï¼Œå½“è®¢é˜…çš„å€¼æ”¹å˜æ—¶ä¼šè§¦å‘</li><li><code>run()</code>ã€‚å¯¹æ¯”å‰åå€¼ï¼Œå¦‚æœå‰åå€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œæˆ–è€…<code>deep</code>ä¸º<code>true</code>ï¼Œæˆ–è€…è¯¥å€¼ä¸ºå¯¹è±¡ï¼Œåˆ™è§¦å‘cbå›è°ƒã€‚</li><li><code>evaluate()</code>ã€‚è§¦å‘<code>this.get()</code> åªä¼šåœ¨<code>lazy watcher</code>é‡Œè¢«è§¦å‘</li><li><code>depend()</code>ã€‚å¾ªç¯è§¦å‘<code>this.deps</code>çš„é¡¹çš„<code>depend()</code>æ–¹æ³•</li><li><code>teardown()</code>ã€‚é”€æ¯<code>watcher</code>ï¼Œä»æ‰€æœ‰çš„<code>this.deps</code>é‡Œç§»é™¤è‡ªèº«ï¼Œå¹¶ä¸”å°†<code>active</code>è®¾ä¸º<code>false</code></li></ul><p><code>Dep</code>ç±»æ˜¯é’ˆå¯¹æŸä¸ªå€¼çš„ä¾èµ–æ”¶é›†å™¨ï¼Œæ¯”å¦‚idä¸º1çš„<code>Dep</code>å®ä¾‹å¯¹è±¡æ˜¯è´Ÿè´£æ”¶é›†<code>_data.name</code>çš„ä¾èµ–çš„ï¼Œé‚£ä»¥åæ‰€æœ‰å¯¹è¿™ä¸ªå€¼çš„è¿›è¡Œè§‚æµ‹çš„<code>watcher</code>éƒ½ä¼šè¢«ç»Ÿè®¡åˆ°è¿™ä¸ªå®ä¾‹é‡Œã€‚<br>å®ƒçš„å®ä¾‹æ–¹æ³•æœ‰å¦‚ä¸‹ï¼š</p><ul><li><code>addSub(sub: Watcher)</code>ã€‚ å¢åŠ ä¾èµ–</li><li><code>removeSub (sub: Watcher)</code>ã€‚ ç§»é™¤ä¾èµ–</li><li><code>depend()</code>ã€‚å¦‚æœæœ‰<code>Watcher</code>åœ¨<code>Dep.target</code>, åˆ™å°†è¿™ä¸ª<code>Watcher</code>åŠ å…¥ä¾èµ–</li><li><code>notify()</code>ã€‚è°ƒç”¨æ‰€æœ‰çš„<code>subs</code>çš„<code>update()</code>æ–¹æ³•ã€‚</li></ul><p>ä¸Šé¢åœ¨<code>initData()</code>å‡½æ•°ä¸­æ³¨é‡Šäº†ä¸€å¥</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">observe(data, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°æ˜¯å¹²ä»€ä¹ˆçš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /demo/observer.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; isObject &#125; <span class="keyword">from</span> <span class="string">'./util'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observe</span>(<span class="params">value, asRootData</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ob</span><br><span class="line">  <span class="comment">// å¦‚æœvalueå¯¹è±¡ä¸Šæœ‰__ob__å±æ€§ï¼Œè€Œä¸”è¿™ä¸ªå±æ€§æ˜¯Observerç±»çš„ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">  <span class="keyword">if</span> (hasOwn(value, <span class="string">'__ob__'</span>) &amp;&amp; value.__ob__ <span class="keyword">instanceof</span> Observer) &#123;</span><br><span class="line">    ob = value.__ob__</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦åˆ™obä¸ºä¸€ä¸ªæ–°çš„Oserverå®ä¾‹</span></span><br><span class="line">    ob = <span class="keyword">new</span> Observer(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯vm.$data, é‚£ä¹ˆ ob.vmCount++</span></span><br><span class="line">  <span class="keyword">if</span> (asRootData &amp;&amp; ob) &#123;</span><br><span class="line">    ob.vmCount++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ob</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hasOwnProperty = <span class="built_in">Object</span>.prototype.hasOwnProperty</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hasOwn</span>(<span class="params">obj, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> hasOwnProperty.call(obj, key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">def</span>(<span class="params">obj, key, val, enumerable</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    value: val,</span><br><span class="line">    enumerable: !!enumerable,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢å¹²äº†ä»€ä¹ˆï¼Œ<code>observe</code>å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª<code>Observer</code>ç±»çš„å®ä¾‹ï¼Œå¦‚æœä¼ å…¥çš„valueæœ‰<code>__ob__</code>å±æ€§ï¼Œç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ åˆ™ä¼ å…¥<code>value</code>å€¼å»æ„é€ ä¸€ä¸ª<code>Observer</code>çš„å®ä¾‹å¹¶è¿”å›ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹<code>Observer</code>ç±»çš„å®šä¹‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="comment">// value</span></span><br><span class="line">  <span class="comment">// dep</span></span><br><span class="line">  <span class="comment">// vmCount // number of vms that has this object as root $data</span></span><br><span class="line">  <span class="keyword">constructor</span>(value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value</span><br><span class="line">    <span class="keyword">this</span>.vmCount = <span class="number">0</span></span><br><span class="line">    <span class="comment">// ç»™valueæ·»åŠ '__ob__'å±æ€§ï¼Œå°±æ˜¯è¿™ä¸ªå®ä¾‹</span></span><br><span class="line">    def(value, <span class="string">'__ob__'</span>, <span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">this</span>.walk(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å¾ªç¯æ¯ä¸ªå±æ€§ï¼Œå¹¶è½¬æ¢å®ƒä»¬çš„getter/settersï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½ç”¨äºObjectç±»å‹çš„å€¼</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  walk(obj) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">      <span class="comment">// ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶ï¼Œ obj: vm._data  keys[i]: key, obj[keys[i]]: value</span></span><br><span class="line">      defineReactive(obj, keys[i], obj[keys[i]])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªå“åº”å¼çš„å±æ€§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">obj, key, val, customSetter, shallow</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> property = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, key)</span><br><span class="line">  <span class="keyword">if</span> (property &amp;&amp; property.configurable === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getter = property &amp;&amp; property.get</span><br><span class="line">  <span class="keyword">const</span> setter = property &amp;&amp; property.set</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span> <span class="title">reactiveGetter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä¹‹å‰è¿™ä¸ªå­—æ®µå·²ç»å®šä¹‰è¿‡getteräº†å°±ç”¨ä¹‹å‰çš„getter</span></span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.call(obj) : val</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span> <span class="title">reactiveSetter</span>(<span class="params">newVal</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.call(obj) : val</span><br><span class="line">      <span class="keyword">if</span> (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå€¼æ²¡æœ‰æ”¹å˜ æˆ–è€…ç±»ä¼¼ NaN !== NaNè¿™ç§æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; customSetter) &#123;</span><br><span class="line">        customSetter()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">        setter.call(obj, newVal)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val = newVal</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`æˆ‘è¢«æ”¹å˜äº†ï¼Œæ–°å€¼:<span class="subst">$&#123;newVal&#125;</span>, æ—§å€¼:<span class="subst">$&#123;value&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„æ“ä½œï¼Œ<code>Observer</code>çš„æ„é€ å‡½æ•°ç»™ä¼ å…¥çš„<code>value</code>å€¼å¢åŠ <code>__ob__</code>å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ„é€ å‡ºçš„å®ä¾‹ï¼Œå¹¶ä¸”å¦‚æœ<code>value</code>æ˜¯å¯¹è±¡ç±»å‹ï¼Œä¼šå¾ªç¯å®ƒçš„æ¯ä¸ªå±æ€§ï¼Œè°ƒç”¨<code>defineReactive</code>æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æ”¹å†™æ¯ä¸ªå±æ€§çš„<code>getter/setter</code>ï¼Œä»è€Œå¯ä»¥åœ¨è¿›è¡Œå€¼è·å–å’Œèµ‹å€¼çš„æ—¶å€™è¿›è¡ŒæŸäº›æ“ä½œï¼Œä¹Ÿå°±èƒ½ç›‘å¬åˆ°å€¼çš„æ”¹å˜ã€‚</p><p>çœ‹çœ‹æ‰§è¡Œä¸Šé¢ä»£ç çš„ç»“æœï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Vue3(&#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">'cky'</span>,</span><br><span class="line">      age: <span class="number">18</span>,</span><br><span class="line">      mom: &#123;</span><br><span class="line">      name: <span class="string">'zj'</span>,</span><br><span class="line">        age: <span class="number">28</span></span><br><span class="line">      &#125;,</span><br><span class="line">      friends: [<span class="string">'aa'</span>, <span class="string">'bbb'</span>, <span class="string">'ccc'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="/images/7.png"><br><img src="/images/9.png"><br><img src="/images/8.png"></p><p>ä¹‹å‰å¯¹äº<code>vm.age</code>å’Œ<code>vm.name</code>ä¹Ÿæœ‰<code>getter</code>å’Œ<code>setter</code>çš„é‡å†™ï¼Œå’Œè¿™é‡Œçš„<code>vm._data.age</code>çš„<code>getter/setter</code>æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨<code>vm.age</code>çš„<code>getter</code>æ˜¯å»è¯»<code>vm._data.age</code>ï¼Œä»è€Œè§¦å‘<code>vm._data.age</code>çš„<code>getter</code>ï¼Œ<code>setter</code>åŒç†ã€‚å…¶å®çœŸæ­£å¯¹äºæ•°æ®æ”¹å˜çš„ç›‘å¬æ˜¯åœ¨<code>_data</code>å±æ€§ä¸Šçš„<code>getter</code>å’Œ<code>setter</code>ä¸Šå®Œæˆçš„ã€‚</p><h3 id="æ•°ç»„æ›´æ–°æ£€æµ‹"><a href="#æ•°ç»„æ›´æ–°æ£€æµ‹" class="headerlink" title="æ•°ç»„æ›´æ–°æ£€æµ‹"></a>æ•°ç»„æ›´æ–°æ£€æµ‹</h3><p>ä¸Šé¢çš„æ“ä½œåœ¨æ•°ç»„æ‰§è¡Œ<code>push</code>è¿™ç±»çš„ä¼šæ”¹å˜æ•°ç»„çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå´æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå› ä¸ºè¿™ä¸ªå¹¶ä¸ä¼šè§¦å‘<code>setter</code>ã€‚é‚£å¯¹äºæ•°ç»„<code>Vue</code>åˆæ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /demo/observer.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; arrayMethods &#125; <span class="keyword">from</span> <span class="string">'./array'</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(value) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value</span><br><span class="line">    <span class="keyword">this</span>.dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="keyword">this</span>.vmCount = <span class="number">0</span></span><br><span class="line">    def(value, <span class="string">'__ob__'</span>, <span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      value.__proto__ = arrayMethods</span><br><span class="line">      <span class="keyword">this</span>.observeArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.walk(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// walk()...</span></span><br><span class="line">  observeArray (items) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = items.length; i &lt; l; i++) &#123;</span><br><span class="line">      observe(items[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /demo/array.js</span></span><br><span class="line"><span class="keyword">const</span> arrayProto = <span class="built_in">Array</span>.prototype</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> arrayMethods = <span class="built_in">Object</span>.create(arrayProto)</span><br><span class="line"><span class="keyword">const</span> methodsToPatch = [</span><br><span class="line">  <span class="string">'push'</span>,</span><br><span class="line">  <span class="string">'pop'</span>,</span><br><span class="line">  <span class="string">'shift'</span>,</span><br><span class="line">  <span class="string">'unshift'</span>,</span><br><span class="line">  <span class="string">'splice'</span>,</span><br><span class="line">  <span class="string">'sort'</span>,</span><br><span class="line">  <span class="string">'reverse'</span></span><br><span class="line">]</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Intercept mutating methods and emit events</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">methodsToPatch.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">method</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// cache original method</span></span><br><span class="line">  <span class="keyword">const</span> original = arrayProto[method]</span><br><span class="line">  def(arrayMethods, method, <span class="function"><span class="keyword">function</span> <span class="title">mutator</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = original.apply(<span class="keyword">this</span>, args)</span><br><span class="line">    <span class="keyword">const</span> ob = <span class="keyword">this</span>.__ob__</span><br><span class="line">    <span class="keyword">let</span> inserted</span><br><span class="line">    <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'push'</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'unshift'</span>:</span><br><span class="line">        inserted = args</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'splice'</span>:</span><br><span class="line">        inserted = args.slice(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (inserted) ob.observeArray(inserted)</span><br><span class="line">    <span class="comment">// notify change</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`æˆ‘æ˜¯æ•°ç»„ï¼Œè¢«<span class="subst">$&#123;method&#125;</span>æ–¹æ³•æ”¹å˜äº†`</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>array.js</code>æ–‡ä»¶<code>export</code>å‡ºäº†ä¸€ä¸ª <code>arrayMethods</code>ï¼Œ<code>arrayMethods</code> ç»§æ‰¿äº† <code>Array.prototype</code>ï¼Œå¹¶åœ¨è‡ªèº«å®šä¹‰äº†é‚£äº›å˜å¼‚æ–¹æ³•æ¥æ‹¦æˆªåŸå§‹æ•°ç»„çš„é‚£äº›æ–¹æ³•è°ƒç”¨ã€‚<br>æˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬è®¿é—®å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå±æ€§çš„æ—¶å€™ï¼Œå‡å¦‚å¯¹è±¡è‡ªèº«ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œåˆ™ä¼šå»¶ç»­åˆ°å®ƒçš„ <code>__proto__</code> ä¸Šå»æ‰¾ï¼Œæ‰¾ä¸åˆ°å°±ç»§ç»­ã€‚æ‰€ä»¥ä¸Šé¢åªéœ€è¦æŠŠæ•°ç»„çš„ <code>__proto__</code> æŒ‡å‘ vue è‡ªå·±çš„ <code>ArrayMethods</code> å°±å®ç°äº†æ‹¦æˆªéƒ¨åˆ†å±æ€§å¹¶ç»§æ‰¿åŸå§‹ <code>Array</code> çš„å…¶ä»–åŸå‹æ–¹æ³•ï¼Œååˆ†å·§å¦™ã€‚</p><p><img src="/images/10.png"></p><p>å®˜æ–¹æ–‡æ¡£è¯´ï¼Œä¸æ”¯æŒç›´æ¥å¯¹æ•°ç»„<code>this.xx[n] = xyz</code>è¿™æ ·çš„èµ‹å€¼ç›‘å¬ï¼Œæä¾›äº†<code>Vue.set</code>å’Œ<code>this.$set</code> æ–¹æ³•ï¼Œå…¶å®è¿™ä¸ªæ–¹æ³•å†…éƒ¨åœ¨å‰ä¸€ç¯‡ä¹Ÿè®²äº†ï¼Œå°±æ˜¯è°ƒç”¨äº†<code>splice</code>è¿™ä¸ªå˜å¼‚æ–¹æ³•ä»è€Œå®ç°ç›‘å¬ã€‚</p><h3 id="ä¾èµ–æ”¶é›†"><a href="#ä¾èµ–æ”¶é›†" class="headerlink" title="ä¾èµ–æ”¶é›†"></a>ä¾èµ–æ”¶é›†</h3><p><br>ä¸Šé¢çš„æ“ä½œè¿˜æ˜¯ä»…ä»…æ˜¯è§‚å¯Ÿè€…èƒ½å¤Ÿç›‘å¬åˆ°äº†æ•°ç»„çš„å˜åŒ–ï¼Œè§‚å¯Ÿè€…çœ‹åˆ°å‘ç”Ÿå˜åŒ–åï¼Œå°±è¦å»é€šçŸ¥é‚£äº›è®¢é˜…è€…(<code>watcher</code>)ã€‚é‚£è¿™ä¸ªè®¢é˜…ä¾èµ–æ˜¯æ€ä¹ˆç»Ÿè®¡èµ·æ¥çš„å‘¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª<code>Dep</code>ç±»ï¼Œè¿™æ˜¯è§‚å¯Ÿè€…å’Œè®¢é˜…è€…çš„æ¡¥æ¢ï¼Œå®ƒç»Ÿè®¡äº†æ‰€æœ‰çš„watcherï¼Œç„¶åç»Ÿä¸€å‘å‡ºé€šçŸ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /demo/dep.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">this</span>.id = uid++</span><br><span class="line">    <span class="keyword">this</span>.subs = []</span><br><span class="line">  &#125;</span><br><span class="line">  addSub () &#123;...&#125;  <span class="comment">// æ·»åŠ è®¢é˜…è€…(ä¾èµ–)</span></span><br><span class="line">  removeSub () &#123;...&#125;  <span class="comment">// åˆ é™¤è®¢é˜…è€…(ä¾èµ–)</span></span><br><span class="line">  depend () &#123;...&#125;  <span class="comment">// æ£€æŸ¥å½“å‰Dep.targetæ˜¯å¦å­˜åœ¨ä»¥åŠåˆ¤æ–­è¿™ä¸ªwatcherå·²ç»è¢«æ·»åŠ åˆ°äº†ç›¸åº”çš„ä¾èµ–å½“ä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ è®¢é˜…è€…(ä¾èµ–)ï¼Œå¦‚æœå·²ç»è¢«æ·»åŠ äº†é‚£ä¹ˆå°±ä¸åšå¤„ç†</span></span><br><span class="line">  notify () &#123;...&#125;  <span class="comment">// é€šçŸ¥è®¢é˜…è€…(ä¾èµ–)æ›´æ–°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä»€ä¹ˆæ—¶å€™è¯¥å»æ·»åŠ ä¾èµ–å‘¢ï¼Œå…¶å®å°±æ˜¯ä½ åœ¨è·å–è¿™ä¸ªå€¼ï¼Œè€Œä¸”è¯´æ˜è‡ªå·±æ˜¯ä¸ªè®¢é˜…è€…çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠä½ ä½œä¸ºè¿™ä¸ªå€¼çš„ä¾èµ–äº†ã€‚<br>è¿™ä¸€æ­¥å°±åœ¨<code>defineReactive</code>æ–¹æ³•é‡Œå®ç°ï¼Œè¿™ä¸€æ­¥é‡å†™äº†<code>getter</code>å’Œ<code>setter</code>ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨<code>getter</code>é‡Œè®°å½•ä¾èµ–ï¼Œåœ¨<code>setter</code>é‡Œé€šçŸ¥æ”¹å˜å°±è¡Œäº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /demo/observer.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">obj, key, val, customSetter, shallow</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep() <span class="comment">// è¯¥å€¼çš„ä¾èµ–æ”¶é›†å™¨</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">let</span> childOb = !shallow &amp;&amp; observe(val) <span class="comment">// è¿”å›çš„æ˜¯ä¸€ä¸ªObserverå®ä¾‹</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span> <span class="title">reactiveGetter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.call(obj) : val</span><br><span class="line">      <span class="keyword">if</span> (Dep.target) &#123; <span class="comment">// å½“è®¢é˜…è€…å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰è¿›è¡Œä¾èµ–æ”¶é›†</span></span><br><span class="line">        dep.depend() <span class="comment">// ä¾èµ–æ”¶é›†ï¼Œ</span></span><br><span class="line">        <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">          childOb.dep.depend()</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">            dependArray(value)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span> <span class="title">reactiveSetter</span>(<span class="params">newVal</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      dep.notify()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Vue</code>çš„è®¢é˜…è€…å®ç°æ˜¯ä¸€ä¸ª<code>Watcher</code>ç±»ï¼Œåœ¨<code>Vue</code>çš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œæœ‰å››ä¸ªåœ°æ–¹ä¼šå®ä¾‹åŒ–è¿™ä¸ªç±»ã€‚</p><ul><li><code>Vue</code>å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­æœ‰<code>watch</code>é€‰é¡¹</li><li><code>Vue</code>å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­æœ‰<code>computed</code>è®¡ç®—å±æ€§é€‰é¡¹</li><li><code>Vue</code>åŸå‹ä¸Šæœ‰æŒ‚è½½<code>$watch</code>æ–¹æ³•: <code>Vue.prototype.$watch</code>ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å®ä¾‹è°ƒç”¨<code>this.$watch</code>æ–¹æ³•</li><li><code>Vue</code>ç”Ÿæˆäº†<code>render</code>å‡½æ•°ï¼Œæ›´æ–°è§†å›¾æ—¶</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo/watcher.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (vm, expOrFn, cb, options) &#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜è¿™ä¸ªå®ä¾‹vm</span></span><br><span class="line">    <span class="keyword">this</span>.vm = vm</span><br><span class="line">    <span class="comment">// vmå®ä¾‹ä¸­çš„_watchersä¸­æ·»åŠ è¿™ä¸ªwatcher</span></span><br><span class="line">    vm._watchers.push(<span class="keyword">this</span>)</span><br><span class="line">    <span class="comment">// options</span></span><br><span class="line">    <span class="keyword">if</span> (options) &#123;</span><br><span class="line">      <span class="keyword">this</span>.deep = !!options.deep</span><br><span class="line">      <span class="keyword">this</span>.user = !!options.user</span><br><span class="line">      <span class="keyword">this</span>.lazy = !!options.lazy</span><br><span class="line">      <span class="keyword">this</span>.sync = !!options.sync</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.deep = <span class="keyword">this</span>.user = <span class="keyword">this</span>.lazy = <span class="keyword">this</span>.sync = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.cb = cb</span><br><span class="line">    <span class="keyword">this</span>.id = ++uid <span class="comment">// uid for batching</span></span><br><span class="line">    <span class="keyword">this</span>.active = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>.dirty = <span class="keyword">this</span>.lazy <span class="comment">// for lazy watchers</span></span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">// parse expression for getter</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> expOrFn === <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.getter = expOrFn</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// eg: 'a.b.c'ï¼ŒparsePathæ–¹æ³•è¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶objå‚æ•°ï¼Œç„¶åè¿”å›obj[a][b][c]çš„å€¼</span></span><br><span class="line">      <span class="keyword">this</span>.getter = parsePath(expOrFn)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.getter) &#123;</span><br><span class="line">        <span class="keyword">this</span>.getter = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡getæ–¹æ³•å»è·å–æœ€æ–°çš„å€¼</span></span><br><span class="line">    <span class="comment">// å¦‚æœlazyä¸ºtrue, åˆå§‹åŒ–çš„æ—¶å€™ä¸ºundefined</span></span><br><span class="line">    <span class="keyword">this</span>.value = <span class="keyword">this</span>.lazy</span><br><span class="line">      ? <span class="literal">undefined</span></span><br><span class="line">      : <span class="keyword">this</span>.get()</span><br><span class="line">  &#125;</span><br><span class="line">  get () &#123;...&#125;</span><br><span class="line">  addDep () &#123;...&#125;</span><br><span class="line">  update () &#123;...&#125;</span><br><span class="line">  run () &#123;...&#125;</span><br><span class="line">  evaluate () &#123;...&#125;</span><br><span class="line">  run () &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é™¤äº†<code>computed</code>é€‰é¡¹å¤–ï¼Œå…¶ä»–å‡ ç§å®ä¾‹åŒ–<code>watcher</code>çš„æ–¹å¼éƒ½æ˜¯åœ¨å®ä¾‹åŒ–è¿‡ç¨‹ä¸­å®Œæˆæ±‚å€¼åŠä¾èµ–çš„æ”¶é›†å·¥ä½œï¼š<code>this.value = this.lazy ? undefined : this.get()</code>.åœ¨<code>Watcher</code>çš„<code>get</code>æ–¹æ³•ä¸­:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">get () &#123;</span><br><span class="line">  <span class="comment">// pushTargetå³è®¾ç½®å½“å‰çš„éœ€è¦è¢«æ‰§è¡Œçš„watcher</span></span><br><span class="line">  pushTarget(<span class="keyword">this</span>)</span><br><span class="line">  <span class="keyword">let</span> value</span><br><span class="line">  <span class="keyword">const</span> vm = <span class="keyword">this</span>.vm</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// $watch(function () &#123;&#125;)</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨this.getterçš„æ—¶å€™ï¼Œè§¦å‘äº†å±æ€§çš„getterå‡½æ•°</span></span><br><span class="line">    <span class="comment">// åœ¨getterä¸­è¿›è¡Œäº†ä¾èµ–çš„ç®¡ç†</span></span><br><span class="line">    value = <span class="keyword">this</span>.getter.call(vm, vm)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    handleError(e, vm, <span class="string">`getter for watcher "<span class="subst">$&#123;<span class="keyword">this</span>.expression&#125;</span>"`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// traverseæ–¹æ³•å…¶å®å°±æ˜¯éå†è¯»å–äº†valueçš„å€¼ï¼Œä»è€Œéå†è§¦å‘äº†ä¸‹é¢çš„`getter`ä»è€Œè¿›è¡Œäº†ä¾èµ–æ”¶é›†</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.deep) &#123;</span><br><span class="line">    traverse(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å®Œæˆäº†ä¾èµ–æ”¶é›†</span></span><br><span class="line">  popTarget()</span><br><span class="line">  <span class="comment">// æ¸…ç†å’Œåˆ é™¤è€æ—§ä¾èµ–</span></span><br><span class="line">  <span class="keyword">this</span>.cleanupDeps()</span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>get()</code>æ–¹æ³•ä¸­è§¦å‘äº†<code>getter</code>ï¼Œè°ƒç”¨<code>dep.depend()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo/dep.js</span></span><br><span class="line">  depend () &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥å½“å‰Dep.targetæ˜¯å¦å­˜åœ¨ä»¥åŠåˆ¤æ–­è¿™ä¸ªwatcherå·²ç»è¢«æ·»åŠ åˆ°äº†ç›¸åº”çš„ä¾èµ–å½“ä¸­ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ è®¢é˜…è€…(ä¾èµ–)ï¼Œå¦‚æœå·²ç»è¢«æ·»åŠ äº†é‚£ä¹ˆå°±ä¸åšå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">      <span class="comment">// Dep.targetä¸ºä¸€ä¸ªwatcher</span></span><br><span class="line">      Dep.target.addDep(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo/watcher.js</span></span><br><span class="line">  <span class="comment">// æ·»åŠ ä¾èµ–</span></span><br><span class="line">  addDep(dep) &#123;</span><br><span class="line">    <span class="comment">// æŸå€¼çš„ä¾èµ–æ”¶é›†å™¨å®ä¾‹ï¼Œå¦‚æœè¿™ä¸ªä¾èµ–æ²¡æœ‰è¢«æ”¶é›†è¿‡</span></span><br><span class="line">    <span class="keyword">const</span> id = dep.id</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.newDepIds.has(id)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.newDepIds.add(id)</span><br><span class="line">      <span class="keyword">this</span>.newDeps.push(dep)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.depIds.has(id)) &#123;</span><br><span class="line">        dep.addSub(<span class="keyword">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„ç»†èŠ‚ä»£ç å°±ä¸ç»†è¯´äº†ï¼Œç°åœ¨å®Œå–„ä»£ç , å¹¶æ‰§è¡Œä»¥ä¸‹ä»£ç å</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Vue3(&#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">       name: <span class="string">'cky'</span>,</span><br><span class="line">       age: <span class="number">18</span>,</span><br><span class="line">       mom: &#123;</span><br><span class="line">     name: <span class="string">'zj'</span>,</span><br><span class="line">         age: <span class="number">28</span></span><br><span class="line">       &#125;,</span><br><span class="line">       friends: [<span class="string">'aa'</span>, <span class="string">'bbb'</span>, <span class="string">'ccc'</span>],</span><br><span class="line">       classmate: [<span class="string">'dd'</span>, <span class="string">'ee'</span>, <span class="string">'gg'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">a.$watch(<span class="string">'name'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">&#125;)</span><br><span class="line">a.$watch(<span class="string">'age'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">&#125;)</span><br><span class="line">a.$watch(<span class="string">'age'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">&#125;)</span><br><span class="line">a.$watch(<span class="string">'name'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">&#125;)</span><br><span class="line">a.$watch(<span class="string">'age'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">&#125;)</span><br><span class="line">a.$watch(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="keyword">this</span>.age</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">&#125;)</span><br><span class="line">a.$watch(<span class="string">'age'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(newValue, oldValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="/images/11.png"><br><img src="/images/12.png"><br><img src="/images/13.png"><br><img src="/images/14.png"></p><p>å…¶ä¸­<code>Dep.id</code>ä¸º1çš„æ˜¯å¯¹<code>name</code>å€¼çš„ä¾èµ–æ”¶é›†å™¨ï¼Œå®ƒä¸‹é¢æœ‰idä¸º1ã€4ã€6çš„<code>watcher</code>ã€‚<br><code>Dep.id</code>ä¸º2çš„æ˜¯å¯¹<code>age</code>çš„ä¾èµ–æ”¶é›†å™¨ï¼Œå®ƒçš„æ”¶é›†çš„è®¢é˜…è€…æœ‰<code>id</code>ä¸º2ã€3ã€5ã€6ã€7çš„<code>watcher</code><br><code>id</code>ä¸º6çš„<code>watcher</code>å› ä¸ºç”¨åˆ°äº†<code>name</code>å’Œ<code>age</code>2ä¸ªå€¼ï¼Œæ‰€ä»¥ä¸Šé¢éƒ½æœ‰ä»–ï¼Œè€Œå®ƒçš„<code>deps</code>å­—æ®µä¹Ÿèƒ½çœ‹å‡ºæ¥ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://segmentfault.com/a/1190000010014281" target="_blank" rel="noopener">Vueçš„æ•°æ®ä¾èµ–å®ç°åŸç†ç®€æ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/cky917/vue-source-code-study&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å­¦ä¹ ä»£ç ä»“åº“&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="vueæºç å­¦ä¹ " scheme="http://blog.chenkeyi.com/tags/vue%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>vueæºç å­¦ä¹ ç¬”è®°--å…¨å±€apiè§£æ</title>
    <link href="http://blog.chenkeyi.com/2018/03/09/vue-source-code-study-2/"/>
    <id>http://blog.chenkeyi.com/2018/03/09/vue-source-code-study-2/</id>
    <published>2018-03-09T11:58:00.000Z</published>
    <updated>2018-03-10T07:52:30.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/cky917/vue-source-code-study" target="_blank" rel="noopener">å­¦ä¹ ä»£ç ä»“åº“</a></p><a id="more"></a><h1 id="å…¨å±€apiè§£æ"><a href="#å…¨å±€apiè§£æ" class="headerlink" title="å…¨å±€apiè§£æ"></a>å…¨å±€apiè§£æ</h1><p>å‹æƒ…æç¤ºï¼šç‚¹å‡»æ¯ä¸ªapiçš„æ ‡é¢˜å¯ä»¥ç›´æ¥æ‰“å¼€APIçš„æ–‡æ¡£</p><p>ä¸Šç¯‡è¯´åˆ°äº†vueçš„åˆå§‹åŒ–æµç¨‹ï¼Œå…¶ä¸­ç»™åŸå‹åˆå§‹åŒ–çš„è¿‡ç¨‹æˆ‘ä»¬ä¹‹åå†åˆ†æï¼Œå…ˆæŠŠä¸æ‰§è¡Œnewå°±èƒ½ç”¨çš„å…¨å±€Apiçœ‹äº†ã€‚<br>æˆ‘çš„æ€è·¯æ˜¯æ ¹æ®<a href="https://github.com/vuejs/vue/blob/dev/src/core/global-api/index.js" target="_blank" rel="noopener">initGlobalApi(Vue)</a>æ–¹æ³•çš„é¡ºåºå¾€ä¸‹çœ‹</p><h2 id="Vue-config"><a href="#Vue-config" class="headerlink" title="Vue.config"></a><a href="https://cn.vuejs.org/v2/api/#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">Vue.config</a></h2><p>è¿™æ˜¯ä¸€ä¸ªå…¨å±€å±æ€§ï¼Œé»˜è®¤æ˜¯è¯»å–çš„è¿™ä¸ª<a href="https://github.com/vuejs/vue/blob/dev/src/core/config.js" target="_blank" rel="noopener">é…ç½®</a></p><ul><li>silent<ul><li>é»˜è®¤å€¼ï¼š<code>false</code></li><li>ä½œç”¨ï¼šæ˜¯å¦å–æ¶ˆ Vue æ‰€æœ‰çš„æ—¥å¿—ä¸è­¦å‘Šã€‚</li></ul></li><li>optionMergeStrategies<ul><li>ç±»å‹ï¼š<code>{ [key: string]: Function }</code></li><li>é»˜è®¤å€¼ <code>{}</code></li><li>ä½œç”¨ï¼šè‡ªå®šä¹‰åˆå¹¶ç­–ç•¥çš„é€‰é¡¹</li></ul></li><li>devtools<ul><li>é»˜è®¤å€¼ï¼šå¼€å‘ç‰ˆæœ¬é»˜è®¤ä¸º<code>true</code>ï¼Œç”Ÿäº§ç‰ˆæœ¬é»˜è®¤ä¸º<code>false</code></li><li>ä½œç”¨ï¼šé…ç½®æ˜¯å¦å…è®¸<code>vue-devtools</code>æ£€æŸ¥ä»£ç ã€‚ç”Ÿäº§ç‰ˆæœ¬è®¾ä¸º true å¯ä»¥å¯ç”¨æ£€æŸ¥ã€‚</li></ul></li><li>errorHandler<ul><li>ç±»å‹ï¼š <code>function</code></li><li>é»˜è®¤å€¼ï¼š<code>undefined</code></li><li>ä½œç”¨ï¼šæŒ‡å®šç»„ä»¶çš„æ¸²æŸ“å’Œè§‚å¯ŸæœŸé—´æœªæ•è·é”™è¯¯çš„å¤„ç†å‡½æ•°ã€‚è¿™ä¸ªå¤„ç†å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯è·å–é”™è¯¯ä¿¡æ¯å’Œ Vue å®ä¾‹ã€‚</li></ul></li><li>warnHandler<ul><li>ç±»å‹ï¼š<code>Function</code></li><li>é»˜è®¤å€¼ï¼š<code>undefined</code></li><li>ä½œç”¨ï¼šä¸º Vue çš„è¿è¡Œæ—¶è­¦å‘Šèµ‹äºˆä¸€ä¸ªè‡ªå®šä¹‰å¤„ç†å‡½æ•°ã€‚æ³¨æ„è¿™åªä¼šåœ¨å¼€å‘è€…ç¯å¢ƒä¸‹ç”Ÿæ•ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å®ƒä¼šè¢«å¿½ç•¥ã€‚</li></ul></li><li>ignoredElements<ul><li>ç±»å‹ï¼š<code>Array&lt;string | RegExp&gt;</code></li><li>é»˜è®¤å€¼ï¼š<code>[]</code></li><li>ä½œç”¨ï¼šé¡»ä½¿ Vue å¿½ç•¥åœ¨ Vue ä¹‹å¤–çš„è‡ªå®šä¹‰å…ƒç´  (e.g. ä½¿ç”¨äº† <code>Web Components APIs</code>)ã€‚å¦åˆ™ï¼Œå®ƒä¼šå‡è®¾ä½ å¿˜è®°æ³¨å†Œå…¨å±€ç»„ä»¶æˆ–è€…æ‹¼é”™äº†ç»„ä»¶åç§°ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªå…³äº<code>Unknown custom element</code>çš„è­¦å‘Šã€‚</li></ul></li><li>keyCodes<ul><li>ç±»å‹ï¼š<code>{ [key: string]: number | Array&lt;number&gt; }</code></li><li>é»˜è®¤å€¼ï¼š<code>{}</code></li><li>ä½œç”¨ï¼šç»™<code>v-on</code>è‡ªå®šä¹‰é”®ä½åˆ«åã€‚</li></ul></li><li>performance<ul><li>ç±»å‹ï¼š<code>boolean</code></li><li>é»˜è®¤å€¼ï¼š<code>false</code></li><li>ä½œç”¨ï¼š è®¾ç½®ä¸º<code>true</code>ä»¥åœ¨æµè§ˆå™¨å¼€å‘å·¥å…·çš„æ€§èƒ½/æ—¶é—´çº¿é¢æ¿ä¸­å¯ç”¨å¯¹ç»„ä»¶åˆå§‹åŒ–ã€ç¼–è¯‘ã€æ¸²æŸ“å’Œæ‰“è¡¥ä¸çš„æ€§èƒ½è¿½è¸ªã€‚åªé€‚ç”¨äºå¼€å‘æ¨¡å¼å’Œæ”¯æŒ<code>performance.mark API</code>çš„æµè§ˆå™¨ä¸Š</li></ul></li><li>productionTip<ul><li>ç±»å‹ï¼š<code>boolean</code></li><li>é»˜è®¤å€¼ï¼š<code>process.env.NODE_ENV !== &#39;production&#39;</code></li><li>ä½œç”¨ï¼šè®¾ç½®ä¸º<code>false</code>ä»¥é˜»æ­¢<code>vue</code>åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚</li></ul></li></ul><p>é…ç½®æ–‡ä»¶é‡Œè¿˜æœ‰ä¸€äº›å±æ€§ï¼Œä¸è¿‡æ²¡æœ‰å†™åˆ°æ–‡æ¡£é‡Œï¼Œæ‰€ä»¥åº”è¯¥ä¸æ¨èç”¨æˆ·ä¿®æ”¹é…ç½®ï¼Œæ‰€ä»¥å°±ä¸è¯´å•¦ã€‚</p><h2 id="Vue-set"><a href="#Vue-set" class="headerlink" title="Vue.set"></a><a href="https://cn.vuejs.org/v2/api/#Vue-set" target="_blank" rel="noopener">Vue.set</a></h2><p><a href="https://cn.vuejs.org/v2/guide/list.html#%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B" target="_blank" rel="noopener">ç›¸å…³é—®é¢˜æ–‡æ¡£</a></p><p>è®¾ç½®å¯¹è±¡çš„å±æ€§ã€‚å¦‚æœå¯¹è±¡æ˜¯å“åº”å¼çš„ï¼Œç¡®ä¿å±æ€§è¢«åˆ›å»ºåä¹Ÿæ˜¯å“åº”å¼çš„ï¼ŒåŒæ—¶è§¦å‘è§†å›¾æ›´æ–°ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºé¿å¼€<code>Vue</code>ä¸èƒ½æ£€æµ‹å±æ€§è¢«æ·»åŠ çš„é™åˆ¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./global-api/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; set, del &#125; <span class="keyword">from</span> <span class="string">'../observer/index'</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">Vue.set = set</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// './observer/index.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Set a property on an object. Adds the new property and</span></span><br><span class="line"><span class="comment"> * triggers change notification if the property doesn't</span></span><br><span class="line"><span class="comment"> * already exist.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">target, key, val</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœtargetæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸”keyæ˜¯ä¸€ä¸ªæ•°ç»„çš„ç´¢å¼•å€¼ï¼Œç›´æ¥ç”¨æ•°ç»„æ–¹æ³•splice()å¯ä»¥ç›´æ¥è§¦å‘å“åº”çš„ç›‘å¬ï¼Œè¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(target) &amp;&amp; isValidArrayIndex(key)) &#123;</span><br><span class="line">    target.length = <span class="built_in">Math</span>.max(target.length, key)</span><br><span class="line">    target.splice(key, <span class="number">1</span>, val)</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœkeyåœ¨targeté‡Œï¼Œè€Œä¸”keyä¸æ˜¯åœ¨Objectæœ¬èº«å°±æœ‰çš„å±æ€§ï¼Œç›´æ¥æ›´æ–°è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (key <span class="keyword">in</span> target &amp;&amp; !(key <span class="keyword">in</span> <span class="built_in">Object</span>.prototype)) &#123;</span><br><span class="line">    target[key] = val</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¼“å­˜è§‚å¯Ÿè€…</span></span><br><span class="line">  <span class="keyword">const</span> ob = (target).__ob__</span><br><span class="line">  <span class="comment">// åˆ¤æ–­targetæ˜¯å¦æ˜¯Vueå®ä¾‹æˆ–è€…æ ¹æ•°æ®å¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æŠ¥é”™,æ‰€ä»¥</span></span><br><span class="line">  <span class="keyword">if</span> (target._isVue || (ob &amp;&amp; ob.vmCount)) &#123;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(<span class="string">'Avoid adding reactive properties to a Vue instance or its root $data '</span> + <span class="string">'at runtime - declare it upfront in the data option.'</span>)</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœtargetä¸æ˜¯å“åº”å¼çš„ï¼Œå°±ç›´æ¥è¿”å›ä¿®æ”¹åçš„å€¼</span></span><br><span class="line">  <span class="keyword">if</span> (!ob) &#123;</span><br><span class="line">    target[key] = val</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¼ å…¥defineReactiveæ–¹æ³•ï¼Œè®©targetçš„keyå±æ€§å¯å“åº”å¼ï¼Œç„¶åè§¦å‘è§‚å¯Ÿè€…çš„ä¾èµ–çš„notify()æ–¹æ³•</span></span><br><span class="line">  defineReactive(ob.value, key, val)</span><br><span class="line">  ob.dep.notify()</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-delete"><a href="#Vue-delete" class="headerlink" title="Vue.delete"></a><a href="https://cn.vuejs.org/v2/api/#Vue-delete" target="_blank" rel="noopener">Vue.delete</a></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./global-api/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">set</span>, del &#125; <span class="keyword">from</span> <span class="string">'../observer/index'</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">Vue.delete = del</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// './observer/index.js'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Delete a property and trigger change if necessary.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">del</span> (<span class="params">target: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; | <span class="built_in">Object</span>, key: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœtargetæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸”keyæ˜¯ä¸€ä¸ªæ•°ç»„çš„ç´¢å¼•å€¼ï¼Œç›´æ¥ç”¨æ•°ç»„æ–¹æ³•splice()å¯ä»¥ç›´æ¥è§¦å‘å“åº”çš„ç›‘å¬ï¼Œè¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(target) &amp;&amp; isValidArrayIndex(key)) &#123;</span><br><span class="line">    target.splice(key, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> ob = (target).__ob__</span><br><span class="line">  <span class="comment">// åˆ¤æ–­targetæ˜¯å¦æ˜¯Vueå®ä¾‹æˆ–è€…æ ¹æ•°æ®å¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æŠ¥é”™</span></span><br><span class="line">  <span class="keyword">if</span> (target._isVue || (ob &amp;&amp; ob.vmCount)) &#123;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">      <span class="string">'Avoid deleting properties on a Vue instance or its root $data '</span> +</span><br><span class="line">      <span class="string">'- just set it to null.'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœkeyä¸æ˜¯targetçš„å±æ€§ï¼Œè¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (!hasOwn(target, key)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">delete</span> target[key]</span><br><span class="line">  <span class="comment">// å¦‚æœtargetä¸æ˜¯å“åº”çš„ï¼Œè¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (!ob) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ‰‹åŠ¨é€šçŸ¥</span></span><br><span class="line">  ob.dep.notify()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-nextTick"><a href="#Vue-nextTick" class="headerlink" title="Vue.nextTick"></a><a href="https://cn.vuejs.org/v2/api/#Vue-nextTick" target="_blank" rel="noopener">Vue.nextTick</a></h2><p>åœ¨ä¸‹æ¬¡<code>DOM</code>æ›´æ–°å¾ªç¯ç»“æŸä¹‹åæ‰§è¡Œå»¶è¿Ÿå›è°ƒã€‚åœ¨ä¿®æ”¹æ•°æ®ä¹‹åç«‹å³ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè·å–æ›´æ–°åçš„ DOMã€‚</p><blockquote><p>2.1.0 èµ·æ–°å¢ï¼šå¦‚æœæ²¡æœ‰æä¾›å›è°ƒä¸”åœ¨æ”¯æŒ <code>Promise</code> çš„ç¯å¢ƒä¸­ï¼Œåˆ™è¿”å›ä¸€ä¸ª <code>Promise</code>ã€‚</p></blockquote><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/util/next-tick.js" target="_blank" rel="noopener">ä»£ç </a>é‡Œçš„<code>microTimerFunc</code>å’Œ<code>macroTimerFunc</code>åˆ†åˆ«æ˜¯ <strong>å¾®ä»»åŠ¡</strong> å’Œ <strong>å®ä»»åŠ¡</strong> ï¼Œè¿™é‡Œçš„<code>microTimerFunc</code>ä¸»è¦æ˜¯ç”¨çš„<code>Promise</code>ï¼Œè‹¥ä¸æ”¯æŒ<code>Promise</code>åˆ™<code>microTimerFunc=macroTimerFunc</code>ã€‚<code>macroTimerFunc</code>åˆ™æ˜¯ç”¨çš„<code>setImmediate</code>,è‹¥ä¸æ”¯æŒ<code>setImmediate</code>åˆ™ç”¨<code>setTimeout</code></p><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ¨å…¥ä¸€ä¸ª<code>callback</code>æ•°ç»„ï¼Œç„¶åç­‰å¾…è¢«è°ƒç”¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> callbacks = []</span><br><span class="line"><span class="keyword">let</span> pending = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Here we have async deferring wrappers using both micro and macro tasks.</span></span><br><span class="line"><span class="comment">// In &lt; 2.4 we used micro tasks everywhere, but there are some scenarios where</span></span><br><span class="line"><span class="comment">// micro tasks have too high a priority and fires in between supposedly</span></span><br><span class="line"><span class="comment">// sequential events (e.g. #4521, #6690) or even between bubbling of the same</span></span><br><span class="line"><span class="comment">// event (#6566). However, using macro tasks everywhere also has subtle problems</span></span><br><span class="line"><span class="comment">// when state is changed right before repaint (e.g. #6813, out-in transitions).</span></span><br><span class="line"><span class="comment">// Here we use micro task by default, but expose a way to force macro task when</span></span><br><span class="line"><span class="comment">// needed (e.g. in event handlers attached by v-on).</span></span><br><span class="line"><span class="keyword">let</span> microTimerFunc</span><br><span class="line"><span class="keyword">let</span> macroTimerFunc</span><br><span class="line"><span class="keyword">let</span> useMacroTask = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushCallbacks</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  pending = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> copies = callbacks.slice(<span class="number">0</span>)</span><br><span class="line">  callbacks.length = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; copies.length; i++) &#123;</span><br><span class="line">    copies[i]()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span> (<span class="params">cb?: Function, ctx?: Object</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _resolve</span><br><span class="line">  callbacks.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        cb.call(ctx)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        handleError(e, ctx, <span class="string">'nextTick'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_resolve) &#123;</span><br><span class="line">      _resolve(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (!pending) &#123;</span><br><span class="line">    pending = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (useMacroTask) &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * macroTimerFunc = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">       *   setImmediate(flushCallbacks)</span></span><br><span class="line"><span class="comment">       * &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      macroTimerFunc()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * const p = Promise.resolve()</span></span><br><span class="line"><span class="comment">       * microTimerFunc = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">       *  p.then(flushCallbacks)</span></span><br><span class="line"><span class="comment">       * &#125;</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      microTimerFunc()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!cb &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">Promise</span> !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      _resolve = resolve</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-use"><a href="#Vue-use" class="headerlink" title="Vue.use"></a><a href="https://cn.vuejs.org/v2/api/#Vue-use" target="_blank" rel="noopener">Vue.use</a></h2><blockquote><p>å®‰è£… <code>Vue.js</code> æ’ä»¶ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æä¾› <code>install</code> æ–¹æ³•ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«ä½œä¸º <code>install</code> æ–¹æ³•ã€‚<code>install</code> æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå°† Vue ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚å½“ <code>install</code> æ–¹æ³•è¢«åŒä¸€ä¸ªæ’ä»¶å¤šæ¬¡è°ƒç”¨ï¼Œæ’ä»¶å°†åªä¼šè¢«å®‰è£…ä¸€æ¬¡ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initUse</span> (<span class="params">Vue: GlobalAPI</span>) </span>&#123;</span><br><span class="line">  Vue.use = <span class="function"><span class="keyword">function</span> (<span class="params">plugin: Function | Object</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜æˆ–åˆå§‹åŒ– installedPlugins</span></span><br><span class="line">    <span class="keyword">const</span> installedPlugins = (<span class="keyword">this</span>._installedPlugins || (<span class="keyword">this</span>._installedPlugins = []))</span><br><span class="line">    <span class="comment">// è‹¥å·²ç»å­˜åœ¨è¯¥plugin(å¼•ç”¨ç›¸åŒ)ï¼Œè¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (installedPlugins.indexOf(plugin) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// additional parameters</span></span><br><span class="line">    <span class="keyword">const</span> args = toArray(<span class="built_in">arguments</span>, <span class="number">1</span>) <span class="comment">// Convert an Array-like object to a real Array</span></span><br><span class="line">    args.unshift(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin.install === <span class="string">'function'</span>) &#123;</span><br><span class="line">      plugin.install.apply(plugin, args)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">'function'</span>) &#123;</span><br><span class="line">      plugin.apply(<span class="literal">null</span>, args)</span><br><span class="line">    &#125;</span><br><span class="line">    installedPlugins.push(plugin) <span class="comment">// this._installedPluginsåŒæ—¶ä¼šæ”¹å˜</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-mixin"><a href="#Vue-mixin" class="headerlink" title="Vue.mixin"></a><a href="https://cn.vuejs.org/v2/api/#Vue-mixin" target="_blank" rel="noopener">Vue.mixin</a></h2><p>å…¨å±€æ³¨å†Œä¸€ä¸ªæ··å…¥ï¼Œå½±å“æ³¨å†Œä¹‹åæ‰€æœ‰åˆ›å»ºçš„æ¯ä¸ª <code>Vue</code> å®ä¾‹ã€‚æ’ä»¶ä½œè€…å¯ä»¥ä½¿ç”¨æ··å…¥ï¼Œå‘ç»„ä»¶æ³¨å…¥è‡ªå®šä¹‰çš„è¡Œä¸ºã€‚ä¸æ¨èåœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initMixin</span> (<span class="params">Vue: GlobalAPI</span>) </span>&#123;</span><br><span class="line">  Vue.mixin = <span class="function"><span class="keyword">function</span> (<span class="params">mixin: Object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.options = mergeOptions(<span class="keyword">this</span>.options, mixin)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-extend"><a href="#Vue-extend" class="headerlink" title="Vue.extend"></a><a href="https://cn.vuejs.org/v2/api/#Vue-extend" target="_blank" rel="noopener">Vue.extend</a></h2><p>ä½¿ç”¨åŸºç¡€ Vue æ„é€ å™¨ï¼Œåˆ›å»ºä¸€ä¸ªâ€œå­ç±»â€ã€‚å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«ç»„ä»¶é€‰é¡¹çš„å¯¹è±¡ã€‚<br><code>data</code> é€‰é¡¹æ˜¯ç‰¹ä¾‹ï¼Œéœ€è¦æ³¨æ„ - åœ¨ <code>Vue.extend()</code> ä¸­å®ƒå¿…é¡»æ˜¯å‡½æ•°ã€‚è¿™é‡Œæˆ‘çš„ç†è§£æ˜¯å› ä¸ºåˆ›å»ºå‡ºæ¥çš„å­ç±»çš„å®ä¾‹ä¼šå…±äº«è¿™ä¸ªoptions.dataé…ç½®ï¼Œå®ä¾‹ä¹‹é—´å¯¹äºdataçš„ä¿®æ”¹ä¹Ÿä¼šäº’ç›¸å½±å“</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initExtend</span> (<span class="params">Vue: GlobalAPI</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Each instance constructor, including Vue, has a unique</span></span><br><span class="line"><span class="comment">   * cid. This enables us to create wrapped "child</span></span><br><span class="line"><span class="comment">   * constructors" for prototypal inheritance and cache them.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  Vue.cid = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> cid = <span class="number">1</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Class inheritance</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  Vue.extend = <span class="function"><span class="keyword">function</span> (<span class="params">extendOptions: Object</span>): <span class="title">Function</span> </span>&#123;</span><br><span class="line">    extendOptions = extendOptions || &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> Super = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">const</span> SuperId = Super.cid</span><br><span class="line">    <span class="keyword">const</span> cachedCtors = extendOptions._Ctor || (extendOptions._Ctor = &#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> (cachedCtors[SuperId]) &#123; <span class="comment">// å¦‚æœæœ‰é€šè¿‡è¯¥æ„é€ å™¨å’Œoptionså¯¹è±¡æ„é€ çš„ç¤ºä¾‹ç¼“å­˜ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">return</span> cachedCtors[SuperId]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> name = extendOptions.name || Super.options.name <span class="comment">// è¯»å–nameæˆ–Superçš„name</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; name) &#123;</span><br><span class="line">      <span class="comment">// æ ¡éªŒnameå±æ€§å€¼</span></span><br><span class="line">      validateComponentName(name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> Sub = <span class="function"><span class="keyword">function</span> <span class="title">VueComponent</span> (<span class="params">options</span>) </span>&#123; <span class="comment">// Subç±»ï¼Œè°ƒç”¨Vueçš„æ„é€ å‡½æ•°_init</span></span><br><span class="line">      <span class="keyword">this</span>._init(options)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»„åˆç»§æ‰¿</span></span><br><span class="line">    Sub.prototype = <span class="built_in">Object</span>.create(Super.prototype)</span><br><span class="line">    Sub.prototype.constructor = Sub</span><br><span class="line"></span><br><span class="line">    Sub.cid = cid++</span><br><span class="line">    <span class="comment">// åˆå¹¶options</span></span><br><span class="line">    Sub.options = mergeOptions(</span><br><span class="line">      Super.options,</span><br><span class="line">      extendOptions</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// åœ¨./instance/init.js resolveConstructorOptionsç­‰æ–¹æ³•ä¸­ä¼šç”¨åˆ°è¿™ä¸ªå­—æ®µ</span></span><br><span class="line">    Sub[<span class="string">'super'</span>] = Super</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For props and computed properties, we define the proxy getters on</span></span><br><span class="line">    <span class="comment">// the Vue instances at extension time, on the extended prototype. This</span></span><br><span class="line">    <span class="comment">// avoids Object.defineProperty calls for each instance created.</span></span><br><span class="line">    <span class="comment">// æŠŠpropså’Œcomputedæ”¾åœ¨åŸå‹é“¾ä¸Šï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å®ä¾‹åˆ›å»ºéƒ½è¦å»è°ƒç”¨Object.defineProperty</span></span><br><span class="line">    <span class="keyword">if</span> (Sub.options.props) &#123;</span><br><span class="line">      initProps(Sub)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Sub.options.computed) &#123;</span><br><span class="line">      initComputed(Sub)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// allow further extension/mixin/plugin usage</span></span><br><span class="line">    Sub.extend = Super.extend</span><br><span class="line">    Sub.mixin = Super.mixin</span><br><span class="line">    Sub.use = Super.use</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create asset registers, so extended classes</span></span><br><span class="line">    <span class="comment">// can have their private assets too.</span></span><br><span class="line">    ASSET_TYPES.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">      Sub[type] = Super[type]</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// enable recursive self-lookup</span></span><br><span class="line">    <span class="keyword">if</span> (name) &#123;</span><br><span class="line">      Sub.options.components[name] = Sub</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜ä¸€ä¸ªSuper.optionsçš„å¼•ç”¨ï¼Œåœ¨ä¹‹åå®ä¾‹åŒ–çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ¤æ–­æ˜¯å¦çˆ¶ç±»çš„optionså‘ç”Ÿäº†æ›´æ–°</span></span><br><span class="line">    Sub.superOptions = Super.options</span><br><span class="line">    Sub.extendOptions = extendOptions</span><br><span class="line">    Sub.sealedOptions = extend(&#123;&#125;, Sub.options)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cache constructor ç¼“å­˜</span></span><br><span class="line">    cachedCtors[SuperId] = Sub</span><br><span class="line">    <span class="keyword">return</span> Sub</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">initProps</span> (<span class="params">Comp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> props = Comp.options.props</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">      proxy(Comp.prototype, <span class="string">`_props`</span>, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue-componentsã€Vue-directiveã€Vue-filter"><a href="#Vue-componentsã€Vue-directiveã€Vue-filter" class="headerlink" title="Vue.componentsã€Vue.directiveã€Vue.filter"></a><a href="https://cn.vuejs.org/v2/api/#Vue-component" target="_blank" rel="noopener">Vue.components</a>ã€<a href="https://cn.vuejs.org/v2/api/#Vue-directive" target="_blank" rel="noopener">Vue.directive</a>ã€<a href="https://cn.vuejs.org/v2/api/#Vue-filter" target="_blank" rel="noopener">Vue.filter</a></h2><p><code>Vue.componentsã€Vue.directiveã€Vue.filter</code>ä¸‰ä¸ªæ–¹æ³•çš„å®šä¹‰éƒ½å†™åœ¨äº†<code>initAssetRegisters</code>æ–¹æ³•é‡Œã€‚</p><ul><li>Vue.componentsï¼šæ³¨å†Œæˆ–è·å–å…¨å±€ç»„ä»¶ã€‚æ³¨å†Œè¿˜ä¼šè‡ªåŠ¨ä½¿ç”¨ç»™å®šçš„<code>id</code>è®¾ç½®ç»„ä»¶çš„åç§° å‚è€ƒï¼š<a href="https://cn.vuejs.org/v2/guide/components.html" target="_blank" rel="noopener">ç»„ä»¶</a></li><li>Vue.directive: æ³¨å†Œæˆ–è·å–å…¨å±€æŒ‡ä»¤ã€‚ å‚è€ƒï¼š<a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">è‡ªå®šä¹‰æŒ‡ä»¤</a></li><li>Vue.filter: æ³¨å†Œæˆ–è·å–å…¨å±€è¿‡æ»¤å™¨ã€‚å‚è€ƒï¼š<a href="https://cn.vuejs.org/v2/guide/filters.html" target="_blank" rel="noopener">è¿‡æ»¤å™¨</a></li></ul><p>å®ƒä»¬çš„ç”¨æ³•ç±»ä¼¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œç»„ä»¶ï¼Œä¼ å…¥ä¸€ä¸ªæ‰©å±•è¿‡çš„æ„é€ å™¨</span></span><br><span class="line">Vue.component(<span class="string">'my-component'</span>, Vue.extend(&#123; <span class="comment">/* ... */</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œç»„ä»¶ï¼Œä¼ å…¥ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ (è‡ªåŠ¨è°ƒç”¨ Vue.extend)</span></span><br><span class="line">Vue.component(<span class="string">'my-component'</span>, &#123; <span class="comment">/* ... */</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ³¨å†Œçš„ç»„ä»¶ (å§‹ç»ˆè¿”å›æ„é€ å™¨)</span></span><br><span class="line"><span class="keyword">var</span> MyComponent = Vue.component(<span class="string">'my-component'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// directive</span></span><br><span class="line"><span class="comment">// æ³¨å†Œ</span></span><br><span class="line"><span class="comment">// é’©å­å‡½æ•°</span></span><br><span class="line">Vue.directive(<span class="string">'my-directive'</span>, &#123;</span><br><span class="line">  bind: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, <span class="comment">// åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚åœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®ã€‚</span></span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, <span class="comment">// è¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ (ä»…ä¿è¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šå·²è¢«æ’å…¥æ–‡æ¡£ä¸­)ã€‚</span></span><br><span class="line">  update: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, <span class="comment">// æ‰€åœ¨ç»„ä»¶çš„ VNode æ›´æ–°æ—¶è°ƒç”¨</span></span><br><span class="line">  componentUpdated: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, <span class="comment">// æŒ‡ä»¤æ‰€åœ¨ç»„ä»¶çš„ VNode åŠå…¶å­ VNode å…¨éƒ¨æ›´æ–°åè°ƒç”¨ã€‚</span></span><br><span class="line">  unbind: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125; <span class="comment">// åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨ã€‚</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œ (æŒ‡ä»¤å‡½æ•°)</span></span><br><span class="line">Vue.directive(<span class="string">'my-directive'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œå°†ä¼šè¢« `bind` å’Œ `update` è°ƒç”¨</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// getterï¼Œè¿”å›å·²æ³¨å†Œçš„æŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">var</span> myDirective = Vue.directive(<span class="string">'my-directive'</span>)</span><br></pre></td></tr></table></figure><p>å®šä¹‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// export const ASSET_TYPES = [</span></span><br><span class="line"><span class="comment">//   'component',</span></span><br><span class="line"><span class="comment">//   'directive',</span></span><br><span class="line"><span class="comment">//   'filter'</span></span><br><span class="line"><span class="comment">// ]</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initAssetRegisters</span> (<span class="params">Vue: GlobalAPI</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Create asset registration methods.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  ASSET_TYPES.forEach(<span class="function"><span class="params">type</span> =&gt;</span> &#123;</span><br><span class="line">    Vue[type] = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">      id: string,</span></span></span><br><span class="line"><span class="function"><span class="params">      definition: Function | Object</span></span></span><br><span class="line"><span class="function"><span class="params">    </span>): <span class="title">Function</span> | <span class="title">Object</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æœ‰ä¼ å…¥definition, åˆ™é€šè¿‡idå»è¿”å›ä¹‹å‰æ³¨å†Œè¿‡çš„</span></span><br><span class="line">      <span class="keyword">if</span> (!definition) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.options[type + <span class="string">'s'</span>][id]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; type === <span class="string">'component'</span>) &#123;</span><br><span class="line">          <span class="comment">// æ ¡éªŒcomponentsçš„åå­—</span></span><br><span class="line">          validateComponentName(id)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'component'</span> &amp;&amp; isPlainObject(definition)) &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœæ˜¯component, ä¸”ä¼ å…¥çš„æ˜¯ä¸ªå¯¹è±¡ï¼Œåˆ™ç”¨componentè¢«åˆå§‹åŒ–å‰çš„çŠ¶æ€å»è°ƒç”¨extend</span></span><br><span class="line">          definition.name = definition.name || id</span><br><span class="line">          definition = <span class="keyword">this</span>.options._base.extend(definition)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'directive'</span> &amp;&amp; <span class="keyword">typeof</span> definition === <span class="string">'function'</span>) &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœæ˜¯directiveï¼Œä¸”ä¼ å…¥çš„æ˜¯ä¸ªå‡½æ•°ï¼Œåˆ™ç»™bindå’Œupdateèµ‹å€¼</span></span><br><span class="line">          definition = &#123; <span class="attr">bind</span>: definition, <span class="attr">update</span>: definition &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ³¨å†Œ</span></span><br><span class="line">        <span class="keyword">this</span>.options[type + <span class="string">'s'</span>][id] = definition</span><br><span class="line">        <span class="keyword">return</span> definition</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul><li><a href="http://www.w3school.com.cn/jsref/jsref_splice.asp" target="_blank" rel="noopener">Array.splice()</a></li><li><a href="https://segmentfault.com/p/1210000008826901/read" target="_blank" rel="noopener">å¼‚æ­¥ JavaScript ä¹‹ç†è§£ macrotask å’Œ microtask</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/cky917/vue-source-code-study&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å­¦ä¹ ä»£ç ä»“åº“&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="vueæºç å­¦ä¹ " scheme="http://blog.chenkeyi.com/tags/vue%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>vueæºç å­¦ä¹ ç¬”è®°--åˆå§‹åŒ–æµç¨‹</title>
    <link href="http://blog.chenkeyi.com/2018/03/08/vue-source-code-study-1/"/>
    <id>http://blog.chenkeyi.com/2018/03/08/vue-source-code-study-1/</id>
    <published>2018-03-08T03:48:00.000Z</published>
    <updated>2018-03-08T03:55:06.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/cky917/vue-source-code-study" target="_blank" rel="noopener">å­¦ä¹ ä»£ç ä»“åº“</a></p><a id="more"></a><h1 id="åˆå§‹åŒ–Vueæµç¨‹"><a href="#åˆå§‹åŒ–Vueæµç¨‹" class="headerlink" title="åˆå§‹åŒ–Vueæµç¨‹"></a>åˆå§‹åŒ–Vueæµç¨‹</h1><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/index.js" target="_blank" rel="noopener">å…¥å£</a></p><p><code>./core/instance/index.js</code><br>å®šä¹‰äº†ä¸€ä¸ªæ„é€ å‡½æ•°</p><p>ç„¶åæ‰§è¡Œäº†ä»¥ä¸‹æ–¹æ³•ï¼Œç»™æ„é€ å‡½æ•°çš„åŸå‹åŠ äº†ä¸€äº›å±æ€§å’Œæ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">initMixin(Vue)</span><br><span class="line">stateMixin(Vue)</span><br><span class="line">eventsMixin(Vue)</span><br><span class="line">lifecycleMixin(Vue)</span><br><span class="line">renderMixin(Vue)</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–åŸå‹ï¼ˆå®ä¾‹ï¼‰çš„æ–¹æ³•å’Œå±æ€§"><a href="#åˆå§‹åŒ–åŸå‹ï¼ˆå®ä¾‹ï¼‰çš„æ–¹æ³•å’Œå±æ€§" class="headerlink" title="åˆå§‹åŒ–åŸå‹ï¼ˆå®ä¾‹ï¼‰çš„æ–¹æ³•å’Œå±æ€§"></a>åˆå§‹åŒ–åŸå‹ï¼ˆå®ä¾‹ï¼‰çš„æ–¹æ³•å’Œå±æ€§</h2><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/instance/init.js" target="_blank" rel="noopener">initMixin</a>æ–¹æ³•ç»™åŸå‹å¢åŠ äº†<code>_init</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æ‰§è¡Œ<code>new Vew()</code>çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ã€‚å…·ä½“çš„åé¢å†è¯´ã€‚// TODO</p><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js" target="_blank" rel="noopener">stateMixin</a>ç»™åŸå‹æŒ‚è½½äº†<code>$data</code>ã€<code>$props</code>å±æ€§ï¼Œå¹¶é‡å†™äº†å®ƒä»¬çš„<code>getter</code>,åˆ†åˆ«è¯»å–å®ä¾‹çš„<code>_data</code>å’Œ<code>_props</code>ã€‚<br>ç„¶åæŒ‚è½½äº†<code>$set</code>ã€<code>$del</code>ã€<code>$watch</code>æ–¹æ³•ï¼Œè¿™äº›åé¢å†ç»†çœ‹ã€‚ // TODO</p><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/instance/events.js" target="_blank" rel="noopener">eventMixin</a>ç»™åŸå‹æŒ‚è½½äº†<code>$on</code>ã€<code>$once</code>ã€<code>$off</code>ã€<code>$emit</code>æ–¹æ³•ï¼Œåç»­ç»†çœ‹ã€‚// TODO</p><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/instance/lifecycle.js" target="_blank" rel="noopener">lifecycleMixin</a> æ–¹æ³•ç»™åŸå‹å®šä¹‰äº†<code>_update</code>æ–¹æ³•ã€ä»¥åŠ<code>$forceUpdate</code>ã€<code>$destroy</code>, åç»­ç»†çœ‹ // TODO</p><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/instance/render.js" target="_blank" rel="noopener">renderMixin</a>æ–¹æ³•ç»™åŸå‹å®šä¹‰äº†<code>$nextTick</code>æ–¹æ³•ï¼Œå¹¶ä¸”æ‰§è¡Œäº†<code>installRenderHelpers</code>æ–¹æ³•ç»™åŸå‹å¢åŠ äº†ä¸€ç³»åˆ—ç§æœ‰çš„æ–¹æ³•ï¼Œå’Œ<code>_render</code>æ–¹æ³•,åç»­ç»†çœ‹ //TODO</p><p>æœ€åæŠ›å‡ºVueæ„é€ å‡½æ•°</p><h2 id="åˆå§‹åŒ–å…¨å±€api"><a href="#åˆå§‹åŒ–å…¨å±€api" class="headerlink" title="åˆå§‹åŒ–å…¨å±€api"></a>åˆå§‹åŒ–å…¨å±€api</h2><p>ç„¶åæ‰§è¡Œ<a href="https://github.com/vuejs/vue/blob/dev/src/core/global-api/index.js" target="_blank" rel="noopener">initGlobalApi(Vue)</a>æ–¹æ³•ï¼Œå°†ä¸€äº›æ–¹æ³•å’Œå±æ€§æŒ‚åœ¨æ„é€ å‡½æ•°ä¸Šæˆä¸ºå…¨å±€api<br>å¦‚ï¼š</p><ul><li><code>Vue.config</code>ï¼ˆå…¨å±€é…ç½® <a href="https://cn.vuejs.org/v2/api/#silent" target="_blank" rel="noopener">æ–‡æ¡£</a>)</li><li><code>Vue.util</code>(æš´éœ²å‡ºæ¥çš„æ–¹æ³•ï¼Œä½†ä¸æ˜¯ä½œä¸ºå…¨å±€apiè€ƒè™‘çš„ï¼Œä¸å»ºè®®ä½¿ç”¨)</li><li><code>Vue.set</code> <a href="https://cn.vuejs.org/v2/api/#Vue-set" target="_blank" rel="noopener">æ–‡æ¡£</a></li><li><code>Vue.delete</code> <a href="https://cn.vuejs.org/v2/api/#Vue-delete" target="_blank" rel="noopener">æ–‡æ¡£</a></li><li><code>Vue.nextTick</code> <a href="https://cn.vuejs.org/v2/api/#Vue-nextTick" target="_blank" rel="noopener">æ–‡æ¡£</a></li></ul><p>ç„¶ååˆå§‹åŒ–options<br><code>Vue.options = Object.create(null)</code></p><p><code>Vue.options.components</code>ã€<br><code>Vue.options.directives</code>ã€<br><code>Vue.options.filters</code> éƒ½ä¸ºä¸€ä¸ªç©ºå¯¹è±¡( <code>Object.create(null)</code>)</p><p>å°†è¿™ä¸ªçŠ¶æ€çš„æ„é€ å‡½æ•°ä¿å­˜åˆ°<code>Vue.options._base</code><br>ç„¶åæ‰§è¡Œ<br><code>extend(Vue.options.components, builtInComponents)</code></p><p><a href="https://github.com/vuejs/vue/blob/dev/src/core/components/keep-alive.js" target="_blank" rel="noopener">builtInComponents</a>è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'keep-alive'</span>,</span><br><span class="line">  abstract: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  props: &#123;</span><br><span class="line">    include: patternTypes,</span><br><span class="line">    exclude: patternTypes,</span><br><span class="line">    max: [<span class="built_in">String</span>, <span class="built_in">Number</span>]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="keyword">this</span>.cache = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">this</span>.keys = []</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  destroyed () &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="keyword">this</span>.cache) &#123;</span><br><span class="line">      pruneCacheEntry(<span class="keyword">this</span>.cache, key, <span class="keyword">this</span>.keys)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  watch: &#123;</span><br><span class="line">    include (val: string | <span class="built_in">RegExp</span> | <span class="built_in">Array</span>&lt;string&gt;) &#123;</span><br><span class="line">      pruneCache(<span class="keyword">this</span>, name =&gt; matches(val, name))</span><br><span class="line">    &#125;,</span><br><span class="line">    exclude (val: string | <span class="built_in">RegExp</span> | <span class="built_in">Array</span>&lt;string&gt;) &#123;</span><br><span class="line">      pruneCache(<span class="keyword">this</span>, name =&gt; !matches(val, name))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="comment">// åé¢å†ç»†çœ‹</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>Vue.options.components</code>ä¹‹å‰æ˜¯åˆå§‹åŒ–çš„ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæ‰€ä»¥<code>extend</code>å¤„ç†ä¹‹åï¼Œç°åœ¨å®ƒå˜æˆäº†ä¸Šè¿°ä»£ç </p><p>ç„¶åé¡ºåºè°ƒç”¨</p><ul><li><a href="https://github.com/vuejs/vue/blob/dev/src/core/global-api/use.js" target="_blank" rel="noopener">initUse(Vue)</a></li><li><a href="https://github.com/vuejs/vue/blob/dev/src/core/global-api/mixin.js" target="_blank" rel="noopener">initMixin(Vue)</a></li><li><a href="https://github.com/vuejs/vue/blob/dev/src/core/global-api/extend.js" target="_blank" rel="noopener">initExtend(Vue)</a></li><li><a href="https://github.com/vuejs/vue/blob/dev/src/core/global-api/assets.js" target="_blank" rel="noopener">initAssetRegisters(Vue)</a></li></ul><p>ç„¶åç»™<code>Vue.prototype</code>å¢åŠ äº†<code>$isServer</code>ã€<code>$ssrContext</code><br>ä¸¤ä¸ªå­—æ®µ<br>æœ€å<code>Vue</code>å¢åŠ äº†<code>version</code>å­—æ®µ</p><p>æ‰€ä»¥åœ¨è¿˜æœªè¿›è¡Œä»»ä½•æ“ä½œï¼Œåªæ˜¯å¼•å…¥äº†Vueæ—¶ï¼ŒVueçš„çŠ¶æ€å¦‚ä¸‹</p><p><img src="/images/1.png"></p><p><img src="/images/2.png"></p><p><img src="/images/3.png"></p><p><img src="/images/4.png"></p><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener">Object.defineProperty</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/cky917/vue-source-code-study&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å­¦ä¹ ä»£ç ä»“åº“&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="vueæºç å­¦ä¹ " scheme="http://blog.chenkeyi.com/tags/vue%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>TypeScriptå­¦ä¹ ç¬”è®° - å‡½æ•°</title>
    <link href="http://blog.chenkeyi.com/2018/02/28/typescript3/"/>
    <id>http://blog.chenkeyi.com/2018/02/28/typescript3/</id>
    <published>2018-02-28T06:25:00.000Z</published>
    <updated>2018-03-08T03:46:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>TypeScriptå­¦ä¹ ç¬”è®° - å‡½æ•°<br><a id="more"></a></p><h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><h2 id="å‡½æ•°ç±»å‹"><a href="#å‡½æ•°ç±»å‹" class="headerlink" title="å‡½æ•°ç±»å‹"></a>å‡½æ•°ç±»å‹</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x: number, y: number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myAdd = <span class="function"><span class="keyword">function</span>(<span class="params">x: number, y: number</span>): <span class="title">number</span> </span>&#123; <span class="keyword">return</span> x + y; &#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸ªå‚æ•°æ·»åŠ ç±»å‹ä¹‹åå†ä¸ºå‡½æ•°æœ¬èº«æ·»åŠ è¿”å›å€¼ç±»å‹ã€‚ TypeScriptèƒ½å¤Ÿæ ¹æ®è¿”å›è¯­å¥è‡ªåŠ¨æ¨æ–­å‡ºè¿”å›å€¼ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸çœç•¥å®ƒã€‚</p><h2 id="å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•°"><a href="#å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•°" class="headerlink" title="å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•°"></a>å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•°</h2><p>JavaScripté‡Œï¼Œæ¯ä¸ªå‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œå¯ä¼ å¯ä¸ä¼ ã€‚ æ²¡ä¼ å‚çš„æ—¶å€™ï¼Œå®ƒçš„å€¼å°±æ˜¯<code>undefined</code>ã€‚ åœ¨TypeScripté‡Œæˆ‘ä»¬å¯ä»¥åœ¨å‚æ•°åæ—ä½¿ç”¨ ?å®ç°å¯é€‰å‚æ•°çš„åŠŸèƒ½ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è®©<code>last name</code>æ˜¯å¯é€‰çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildName</span>(<span class="params">firstName: string, lastName?: string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lastName)</span><br><span class="line">        <span class="keyword">return</span> firstName + <span class="string">" "</span> + lastName;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result1 = buildName(<span class="string">"Bob"</span>);  <span class="comment">// works correctly now</span></span><br><span class="line"><span class="keyword">let</span> result2 = buildName(<span class="string">"Bob"</span>, <span class="string">"Adams"</span>, <span class="string">"Sr."</span>);  <span class="comment">// error, too many parameters</span></span><br><span class="line"><span class="keyword">let</span> result3 = buildName(<span class="string">"Bob"</span>, <span class="string">"Adams"</span>);  <span class="comment">// ah, just right</span></span><br></pre></td></tr></table></figure><p>å¯é€‰å‚æ•°å¿…é¡»è·Ÿåœ¨å¿…é¡»å‚æ•°åé¢ã€‚ å¦‚æœä¸Šä¾‹æˆ‘ä»¬æƒ³è®©<code>first name</code>æ˜¯å¯é€‰çš„ï¼Œé‚£ä¹ˆå°±å¿…é¡»è°ƒæ•´å®ƒä»¬çš„ä½ç½®ï¼ŒæŠŠ<code>first name</code>æ”¾åœ¨åé¢ã€‚</p><p>åœ¨TypeScripté‡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºå‚æ•°æä¾›ä¸€ä¸ªé»˜è®¤å€¼å½“ç”¨æˆ·æ²¡æœ‰ä¼ é€’è¿™ä¸ªå‚æ•°æˆ–ä¼ é€’çš„å€¼æ˜¯undefinedæ—¶ã€‚ å®ƒä»¬å«åšæœ‰é»˜è®¤åˆå§‹åŒ–å€¼çš„å‚æ•°ã€‚ è®©æˆ‘ä»¬ä¿®æ”¹ä¸Šä¾‹ï¼ŒæŠŠlast nameçš„é»˜è®¤å€¼è®¾ç½®ä¸ºâ€Smithâ€ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildName</span>(<span class="params">firstName: string, lastName = <span class="string">"Smith"</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> firstName + <span class="string">" "</span> + lastName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result1 = buildName(<span class="string">"Bob"</span>);                  <span class="comment">// works correctly now, returns "Bob Smith"</span></span><br><span class="line"><span class="keyword">let</span> result2 = buildName(<span class="string">"Bob"</span>, <span class="literal">undefined</span>);       <span class="comment">// still works, also returns "Bob Smith"</span></span><br><span class="line"><span class="keyword">let</span> result3 = buildName(<span class="string">"Bob"</span>, <span class="string">"Adams"</span>, <span class="string">"Sr."</span>);  <span class="comment">// error, too many parameters</span></span><br><span class="line"><span class="keyword">let</span> result4 = buildName(<span class="string">"Bob"</span>, <span class="string">"Adams"</span>);         <span class="comment">// ah, just right</span></span><br></pre></td></tr></table></figure><h2 id="å‰©ä½™å‚æ•°"><a href="#å‰©ä½™å‚æ•°" class="headerlink" title="å‰©ä½™å‚æ•°"></a>å‰©ä½™å‚æ•°</h2><p>å¿…è¦å‚æ•°ï¼Œé»˜è®¤å‚æ•°å’Œå¯é€‰å‚æ•°æœ‰ä¸ªå…±åŒç‚¹ï¼šå®ƒä»¬è¡¨ç¤ºæŸä¸€ä¸ªå‚æ•°ã€‚ æœ‰æ—¶ï¼Œä½ æƒ³åŒæ—¶æ“ä½œå¤šä¸ªå‚æ•°ï¼Œæˆ–è€…ä½ å¹¶ä¸çŸ¥é“ä¼šæœ‰å¤šå°‘å‚æ•°ä¼ é€’è¿›æ¥ã€‚ åœ¨JavaScripté‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>arguments</code>æ¥è®¿é—®æ‰€æœ‰ä¼ å…¥çš„å‚æ•°ã€‚</p><p>åœ¨TypeScripté‡Œï¼Œä½ å¯ä»¥æŠŠæ‰€æœ‰å‚æ•°æ”¶é›†åˆ°ä¸€ä¸ªå˜é‡é‡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildName</span>(<span class="params">firstName: string, ...restOfName: string[]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> firstName + <span class="string">" "</span> + restOfName.join(<span class="string">" "</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> employeeName = buildName(<span class="string">"Joseph"</span>, <span class="string">"Samuel"</span>, <span class="string">"Lucas"</span>, <span class="string">"MacKinzie"</span>);</span><br></pre></td></tr></table></figure><p>// TODO</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;TypeScriptå­¦ä¹ ç¬”è®° - å‡½æ•°&lt;br&gt;
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>TypeScriptå­¦ä¹ ç¬”è®° - æ¥å£ã€ç±»</title>
    <link href="http://blog.chenkeyi.com/2018/02/28/typescript2/"/>
    <id>http://blog.chenkeyi.com/2018/02/28/typescript2/</id>
    <published>2018-02-28T03:42:00.000Z</published>
    <updated>2018-02-28T06:49:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>TypeScriptå­¦ä¹ ç¬”è®° - æ¥å£ã€ç±»<br><a id="more"></a></p><h1 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h1><h2 id="åˆæ¢"><a href="#åˆæ¢" class="headerlink" title="åˆæ¢"></a>åˆæ¢</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface LabelledValue &#123;</span><br><span class="line">  label: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printLabel</span>(<span class="params">labelledObj: LabelledValue</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(labelledObj.label);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myObj = &#123;<span class="attr">size</span>: <span class="number">10</span>, <span class="attr">label</span>: <span class="string">"Size 10 Object"</span>&#125;;</span><br><span class="line">printLabel(myObj);</span><br></pre></td></tr></table></figure><p><code>LabelledValue</code>æ¥å£å°±å¥½æ¯”ä¸€ä¸ªåå­—ï¼Œç”¨æ¥æè¿°ä¸Šé¢ä¾‹å­é‡Œçš„è¦æ±‚ã€‚ å®ƒä»£è¡¨äº†æœ‰ä¸€ä¸ª <code>label</code>å±æ€§ä¸”ç±»å‹ä¸º<code>string</code>çš„å¯¹è±¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¹¶ä¸èƒ½åƒåœ¨å…¶å®ƒè¯­è¨€é‡Œä¸€æ ·ï¼Œè¯´ä¼ ç»™ <code>printLabel</code>çš„å¯¹è±¡å®ç°äº†è¿™ä¸ªæ¥å£ã€‚æˆ‘ä»¬åªä¼šå»å…³æ³¨å€¼çš„å¤–å½¢ã€‚ åªè¦ä¼ å…¥çš„å¯¹è±¡æ»¡è¶³ä¸Šé¢æåˆ°çš„å¿…è¦æ¡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯è¢«å…è®¸çš„ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹å€¼å¾—æçš„æ˜¯ï¼Œç±»å‹æ£€æŸ¥å™¨ä¸ä¼šå»æ£€æŸ¥å±æ€§çš„é¡ºåºï¼Œåªè¦ç›¸åº”çš„å±æ€§å­˜åœ¨å¹¶ä¸”ç±»å‹ä¹Ÿæ˜¯å¯¹çš„å°±å¯ä»¥ã€‚</p><h2 id="å¯é€‰å±æ€§"><a href="#å¯é€‰å±æ€§" class="headerlink" title="å¯é€‰å±æ€§"></a>å¯é€‰å±æ€§</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createSquare</span>(<span class="params">config: SquareConfig</span>): </span>&#123;color: string; area: number&#125; &#123;</span><br><span class="line">  <span class="keyword">let</span> newSquare = &#123;<span class="attr">color</span>: <span class="string">"white"</span>, <span class="attr">area</span>: <span class="number">100</span>&#125;;</span><br><span class="line">  <span class="keyword">if</span> (config.color) &#123;</span><br><span class="line">    newSquare.color = config.color;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (config.width) &#123;</span><br><span class="line">    newSquare.area = config.width * config.width;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newSquare;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySquare = createSquare(&#123;<span class="attr">color</span>: <span class="string">"black"</span>&#125;);</span><br></pre></td></tr></table></figure><p>å¸¦æœ‰å¯é€‰å±æ€§çš„æ¥å£ä¸æ™®é€šçš„æ¥å£å®šä¹‰å·®ä¸å¤šï¼Œåªæ˜¯åœ¨å¯é€‰å±æ€§åå­—å®šä¹‰çš„åé¢åŠ ä¸€ä¸ª<code>?</code>ç¬¦å·ã€‚</p><p>å¯é€‰å±æ€§çš„å¥½å¤„ä¹‹ä¸€æ˜¯å¯ä»¥å¯¹å¯èƒ½å­˜åœ¨çš„å±æ€§è¿›è¡Œé¢„å®šä¹‰ï¼Œå¥½å¤„ä¹‹äºŒæ˜¯å¯ä»¥æ•è·å¼•ç”¨äº†ä¸å­˜åœ¨çš„å±æ€§æ—¶çš„é”™è¯¯ã€‚</p><h2 id="åªè¯»å±æ€§"><a href="#åªè¯»å±æ€§" class="headerlink" title="åªè¯»å±æ€§"></a>åªè¯»å±æ€§</h2><p>ä¸€äº›å¯¹è±¡å±æ€§åªèƒ½åœ¨å¯¹è±¡åˆšåˆšåˆ›å»ºçš„æ—¶å€™ä¿®æ”¹å…¶å€¼ã€‚ ä½ å¯ä»¥åœ¨å±æ€§åå‰ç”¨ readonlyæ¥æŒ‡å®šåªè¯»å±æ€§:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Point &#123;</span><br><span class="line">  readonly x: number;</span><br><span class="line">  readonly y: number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥é€šè¿‡èµ‹å€¼ä¸€ä¸ªå¯¹è±¡å­—é¢é‡æ¥æ„é€ ä¸€ä¸ª<code>Point</code>ã€‚ èµ‹å€¼åï¼Œ xå’Œyå†ä¹Ÿä¸èƒ½è¢«æ”¹å˜äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1: Point = &#123; <span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">20</span> &#125;;</span><br><span class="line">p1.x = <span class="number">5</span>; <span class="comment">// error!</span></span><br></pre></td></tr></table></figure><p><code>TypeScript</code>å…·æœ‰<code>ReadonlyArray&lt;T&gt;</code>ç±»å‹ï¼Œå®ƒä¸<code>Array&lt;T&gt;</code>ç›¸ä¼¼ï¼Œåªæ˜¯æŠŠæ‰€æœ‰å¯å˜æ–¹æ³•å»æ‰äº†ï¼Œå› æ­¤å¯ä»¥ç¡®ä¿æ•°ç»„åˆ›å»ºåå†ä¹Ÿä¸èƒ½è¢«ä¿®æ”¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: number[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> ro: ReadonlyArray&lt;number&gt; = a;</span><br><span class="line">ro[<span class="number">0</span>] = <span class="number">12</span>; <span class="comment">// error!</span></span><br><span class="line">ro.push(<span class="number">5</span>); <span class="comment">// error!</span></span><br><span class="line">ro.length = <span class="number">100</span>; <span class="comment">// error!</span></span><br><span class="line">a = ro; <span class="comment">// error!</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„æœ€åä¸€è¡Œï¼Œå¯ä»¥çœ‹åˆ°å°±ç®—æŠŠæ•´ä¸ªReadonlyArrayèµ‹å€¼åˆ°ä¸€ä¸ªæ™®é€šæ•°ç»„ä¹Ÿæ˜¯ä¸å¯ä»¥çš„ã€‚ ä½†æ˜¯ä½ å¯ä»¥ç”¨ç±»å‹æ–­è¨€é‡å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = ro <span class="keyword">as</span> number[];</span><br></pre></td></tr></table></figure><p><strong>readonly vs const</strong></p><p>æœ€ç®€å•åˆ¤æ–­è¯¥ç”¨<code>readonly</code>è¿˜æ˜¯<code>const</code>çš„æ–¹æ³•æ˜¯çœ‹è¦æŠŠå®ƒåšä¸ºå˜é‡ä½¿ç”¨è¿˜æ˜¯åšä¸ºä¸€ä¸ªå±æ€§ã€‚ åšä¸ºå˜é‡ä½¿ç”¨çš„è¯ç”¨ <code>const</code>ï¼Œè‹¥åšä¸ºå±æ€§åˆ™ä½¿ç”¨<code>readonly</code>ã€‚</p><h2 id="é¢å¤–çš„å±æ€§æ£€æŸ¥"><a href="#é¢å¤–çš„å±æ€§æ£€æŸ¥" class="headerlink" title="é¢å¤–çš„å±æ€§æ£€æŸ¥"></a>é¢å¤–çš„å±æ€§æ£€æŸ¥</h2><p>æœ€ä½³çš„æ–¹å¼æ˜¯èƒ½å¤Ÿæ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ç´¢å¼•ç­¾åï¼Œå‰ææ˜¯ä½ èƒ½å¤Ÿç¡®å®šè¿™ä¸ªå¯¹è±¡å¯èƒ½å…·æœ‰æŸäº›åšä¸ºç‰¹æ®Šç”¨é€”ä½¿ç”¨çš„é¢å¤–å±æ€§ã€‚ å¦‚æœ <code>SquareConfig</code>å¸¦æœ‰ä¸Šé¢å®šä¹‰çš„ç±»å‹çš„<code>color</code>å’Œ<code>width</code>å±æ€§ï¼Œå¹¶ä¸”è¿˜ä¼šå¸¦æœ‰ä»»æ„æ•°é‡çš„å…¶å®ƒå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰å®ƒï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface SquareConfig &#123;</span><br><span class="line">  color?: string;</span><br><span class="line">  width?: number;</span><br><span class="line">  [propName: string]: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯ç´¢å¼•çš„ç±»å‹"><a href="#å¯ç´¢å¼•çš„ç±»å‹" class="headerlink" title="å¯ç´¢å¼•çš„ç±»å‹"></a>å¯ç´¢å¼•çš„ç±»å‹</h2><p>ä¸ä½¿ç”¨æ¥å£æè¿°å‡½æ•°ç±»å‹å·®ä¸å¤šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æè¿°é‚£äº›èƒ½å¤Ÿâ€œé€šè¿‡ç´¢å¼•å¾—åˆ°â€çš„ç±»å‹ï¼Œæ¯”å¦‚<code>a[10]æˆ–ageMap[&quot;daniel&quot;]</code>ã€‚ å¯ç´¢å¼•ç±»å‹å…·æœ‰ä¸€ä¸ª <code>ç´¢å¼•ç­¾å</code>ï¼Œå®ƒæè¿°äº†å¯¹è±¡ç´¢å¼•çš„ç±»å‹ï¼Œè¿˜æœ‰ç›¸åº”çš„ç´¢å¼•è¿”å›å€¼ç±»å‹ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface StringArray &#123;</span><br><span class="line">  [index: number]: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myArray: StringArray;</span><br><span class="line">myArray = [<span class="string">"Bob"</span>, <span class="string">"Fred"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myStr: string = myArray[<span class="number">0</span>];</span><br></pre></td></tr></table></figure><h1 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">  greeting: string;</span><br><span class="line">  <span class="keyword">constructor</span>(message: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.greeting = message;</span><br><span class="line">  &#125;</span><br><span class="line">  greet() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello, "</span> + <span class="keyword">this</span>.greeting;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> greeter = <span class="keyword">new</span> Greeter(<span class="string">"world"</span>);</span><br></pre></td></tr></table></figure><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    name: string;</span><br><span class="line">    <span class="keyword">constructor</span>(theName: string) &#123; <span class="keyword">this</span>.name = theName; &#125;</span><br><span class="line">    move(distanceInMeters: number = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> moved <span class="subst">$&#123;distanceInMeters&#125;</span>m.`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name: string) &#123; <span class="keyword">super</span>(name); &#125;</span><br><span class="line">    move(distanceInMeters = <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Slithering..."</span>);</span><br><span class="line">        <span class="keyword">super</span>.move(distanceInMeters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Horse</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name: string) &#123; <span class="keyword">super</span>(name); &#125;</span><br><span class="line">    move(distanceInMeters = <span class="number">45</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Galloping..."</span>);</span><br><span class="line">        <span class="keyword">super</span>.move(distanceInMeters);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sam = <span class="keyword">new</span> Snake(<span class="string">"Sammy the Python"</span>);</span><br><span class="line"><span class="keyword">let</span> tom: Animal = <span class="keyword">new</span> Horse(<span class="string">"Tommy the Palomino"</span>);</span><br><span class="line"></span><br><span class="line">sam.move();</span><br><span class="line">tom.move(<span class="number">34</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ <code>extends</code>å…³é”®å­—åˆ›å»ºäº† <code>Animal</code>çš„ä¸¤ä¸ªå­ç±»ï¼š <code>Horse</code>å’Œ <code>Snake</code>ã€‚</p><p>æ´¾ç”Ÿç±»åŒ…å«äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒ <strong>å¿…é¡»è°ƒç”¨</strong> <code>super()</code>ï¼Œå®ƒä¼šæ‰§è¡ŒåŸºç±»çš„æ„é€ å‡½æ•°ã€‚ è€Œä¸”ï¼Œåœ¨æ„é€ å‡½æ•°é‡Œè®¿é—® <code>this</code>çš„å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬ <strong>ä¸€å®š</strong>è¦è°ƒç”¨ <code>super()</code>ã€‚ è¿™ä¸ªæ˜¯TypeScriptå¼ºåˆ¶æ‰§è¡Œçš„ä¸€æ¡é‡è¦è§„åˆ™ã€‚</p><p>è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•åœ¨å­ç±»é‡Œå¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚ <code>Snake</code>ç±»å’Œ <code>Horse</code>ç±»éƒ½åˆ›å»ºäº† <code>move</code>æ–¹æ³•ï¼Œå®ƒä»¬é‡å†™äº†ä» <code>Animal</code>ç»§æ‰¿æ¥çš„ <code>move</code>æ–¹æ³•ï¼Œä½¿å¾— <code>move</code>æ–¹æ³•æ ¹æ®ä¸åŒçš„ç±»è€Œå…·æœ‰ä¸åŒçš„åŠŸèƒ½ã€‚ æ³¨æ„ï¼Œå³ä½¿ <code>tom</code>è¢«å£°æ˜ä¸º <code>Animal</code>ç±»å‹ï¼Œä½†å› ä¸ºå®ƒçš„å€¼æ˜¯ <code>Horse</code>ï¼Œè°ƒç”¨ <code>tom.move(34)</code>æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ <code>Horse</code>é‡Œé‡å†™çš„æ–¹æ³•ï¼š</p><h2 id="å…¬å…±ï¼Œç§æœ‰ä¸å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦"><a href="#å…¬å…±ï¼Œç§æœ‰ä¸å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦" class="headerlink" title="å…¬å…±ï¼Œç§æœ‰ä¸å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦"></a>å…¬å…±ï¼Œç§æœ‰ä¸å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦</h2><p>åœ¨TypeScripté‡Œï¼Œæˆå‘˜éƒ½é»˜è®¤ä¸º <code>public</code>,ä½ ä¹Ÿå¯ä»¥æ˜ç¡®çš„å°†ä¸€ä¸ªæˆå‘˜æ ‡è®°æˆ <code>public</code></p><p><strong> ç†è§£ <code>private</code> </strong><br>å½“æˆå‘˜è¢«æ ‡è®°æˆ <code>private</code>æ—¶ï¼Œå®ƒå°±ä¸èƒ½åœ¨å£°æ˜å®ƒçš„ç±»çš„å¤–éƒ¨è®¿é—®ï¼Œå¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    private name: string;</span><br><span class="line">    <span class="keyword">constructor</span>(theName: string) &#123; <span class="keyword">this</span>.name = theName; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Animal(<span class="string">"Cat"</span>).name; <span class="comment">// é”™è¯¯: 'name' æ˜¯ç§æœ‰çš„.</span></span><br></pre></td></tr></table></figure><p><strong> ç†è§£ <code>protected</code></strong><br><code>protected</code>ä¿®é¥°ç¬¦ä¸ <code>private</code>ä¿®é¥°ç¬¦çš„è¡Œä¸ºå¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼Œ <code>protected</code>æˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­ä»ç„¶å¯ä»¥è®¿é—®ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    protected name: string;</span><br><span class="line">    <span class="keyword">constructor</span>(name: string) &#123; <span class="keyword">this</span>.name = name; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    private department: string;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(name: string, department: string) &#123;</span><br><span class="line">        <span class="keyword">super</span>(name)</span><br><span class="line">        <span class="keyword">this</span>.department = department;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public getElevatorPitch() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`Hello, my name is <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> and I work in <span class="subst">$&#123;<span class="keyword">this</span>.department&#125;</span>.`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> howard = <span class="keyword">new</span> Employee(<span class="string">"Howard"</span>, <span class="string">"Sales"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(howard.getElevatorPitch());</span><br><span class="line"><span class="built_in">console</span>.log(howard.name); <span class="comment">// é”™è¯¯</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨<code>Person</code>ç±»å¤–ä½¿ç”¨ <code>name</code>ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡ <code>Employee</code>ç±»çš„å®ä¾‹æ–¹æ³•è®¿é—®ï¼Œå› ä¸º <code>Employee</code>æ˜¯ç”± <code>Person</code>æ´¾ç”Ÿè€Œæ¥çš„ã€‚</p><h2 id="å­˜å–å™¨"><a href="#å­˜å–å™¨" class="headerlink" title="å­˜å–å™¨"></a>å­˜å–å™¨</h2><p>TypeScriptæ”¯æŒé€šè¿‡<code>getters/setters</code>æ¥æˆªå–å¯¹å¯¹è±¡æˆå‘˜çš„è®¿é—®ã€‚ å®ƒèƒ½å¸®åŠ©ä½ æœ‰æ•ˆçš„æ§åˆ¶å¯¹å¯¹è±¡æˆå‘˜çš„è®¿é—®ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> passcode = <span class="string">"secret passcode"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    private _fullName: string;</span><br><span class="line"></span><br><span class="line">    get fullName(): string &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._fullName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set fullName(newName: string) &#123;</span><br><span class="line">        <span class="keyword">if</span> (passcode &amp;&amp; passcode == <span class="string">"secret passcode"</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>._fullName = newName;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Error: Unauthorized update of employee!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> employee = <span class="keyword">new</span> Employee();</span><br><span class="line">employee.fullName = <span class="string">"Bob Smith"</span>;</span><br><span class="line"><span class="keyword">if</span> (employee.fullName) &#123;</span><br><span class="line">    alert(employee.fullName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™æ€å±æ€§"><a href="#é™æ€å±æ€§" class="headerlink" title="é™æ€å±æ€§"></a>é™æ€å±æ€§</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè®¨è®ºäº†ç±»çš„å®ä¾‹æˆå‘˜ï¼Œé‚£äº›ä»…å½“ç±»è¢«å®ä¾‹åŒ–çš„æ—¶å€™æ‰ä¼šè¢«åˆå§‹åŒ–çš„å±æ€§ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºç±»çš„é™æ€æˆå‘˜ï¼Œè¿™äº›å±æ€§å­˜åœ¨äºç±»æœ¬èº«ä¸Šé¢è€Œä¸æ˜¯ç±»çš„å®ä¾‹ä¸Šã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grid</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> origin = &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;;</span><br><span class="line">    calculateDistanceFromOrigin(point: &#123;<span class="attr">x</span>: number; y: number;&#125;) &#123;</span><br><span class="line">        <span class="keyword">let</span> xDist = (point.x - Grid.origin.x);</span><br><span class="line">        <span class="keyword">let</span> yDist = (point.y - Grid.origin.y);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(xDist * xDist + yDist * yDist) / <span class="keyword">this</span>.scale;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span> (public scale: number) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> grid1 = <span class="keyword">new</span> Grid(<span class="number">1.0</span>);  <span class="comment">// 1x scale</span></span><br><span class="line"><span class="keyword">let</span> grid2 = <span class="keyword">new</span> Grid(<span class="number">5.0</span>);  <span class="comment">// 5x scale</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(grid1.calculateDistanceFromOrigin(&#123;<span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">10</span>&#125;));</span><br><span class="line"><span class="built_in">console</span>.log(grid2.calculateDistanceFromOrigin(&#123;<span class="attr">x</span>: <span class="number">10</span>, <span class="attr">y</span>: <span class="number">10</span>&#125;));</span><br></pre></td></tr></table></figure><p>æ‘˜æŠ„è‡ª <a href="https://www.tslang.cn/docs/handbook/interfaces.html" target="_blank" rel="noopener">typescrpitä¸­æ–‡æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;TypeScriptå­¦ä¹ ç¬”è®° - æ¥å£ã€ç±»&lt;br&gt;
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>TypeScriptå­¦ä¹ ç¬”è®° - åŸºç¡€ç±»å‹ã€å˜é‡å£°æ˜</title>
    <link href="http://blog.chenkeyi.com/2018/02/28/typescript1/"/>
    <id>http://blog.chenkeyi.com/2018/02/28/typescript1/</id>
    <published>2018-02-28T02:48:00.000Z</published>
    <updated>2018-02-28T06:49:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>TypeScriptå­¦ä¹ ç¬”è®° - åŸºç¡€ç±»å‹ã€å˜é‡å£°æ˜<br><a id="more"></a></p><h2 id="åŸºç¡€ç±»å‹"><a href="#åŸºç¡€ç±»å‹" class="headerlink" title="åŸºç¡€ç±»å‹"></a>åŸºç¡€ç±»å‹</h2><h3 id="å¸ƒå°”å€¼ï¼š"><a href="#å¸ƒå°”å€¼ï¼š" class="headerlink" title="å¸ƒå°”å€¼ï¼š"></a>å¸ƒå°”å€¼ï¼š</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isDone: boolean = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h3 id="æ•°å­—"><a href="#æ•°å­—" class="headerlink" title="æ•°å­—"></a>æ•°å­—</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> decLiteral: number = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">let</span> hexLiteral: number = <span class="number">0xf00d</span>;</span><br><span class="line"><span class="keyword">let</span> binaryLiteral: number = <span class="number">0b1010</span>;</span><br><span class="line"><span class="keyword">let</span> octalLiteral: number = <span class="number">0o744</span>;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: string = <span class="string">`Gene`</span>;</span><br><span class="line"><span class="keyword">let</span> age: number = <span class="number">37</span>;</span><br><span class="line"><span class="keyword">let</span> sentence: string = <span class="string">`Hello, my name is <span class="subst">$&#123; name &#125;</span>.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I'll be <span class="subst">$&#123; age + <span class="number">1</span> &#125;</span> years old next month.`</span>;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list: number[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨æ•°ç»„æ³›å‹ï¼ŒArray&lt;å…ƒç´ ç±»å‹&gt;ï¼š</span></span><br><span class="line"><span class="keyword">let</span> list: <span class="built_in">Array</span>&lt;number&gt; = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure><h3 id="å…ƒç»„-Tuple"><a href="#å…ƒç»„-Tuple" class="headerlink" title="å…ƒç»„ Tuple"></a>å…ƒç»„ Tuple</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declare a tuple type</span></span><br><span class="line"><span class="keyword">let</span> x: [string, number];</span><br><span class="line"><span class="comment">// Initialize it</span></span><br><span class="line">x = [<span class="string">'hello'</span>, <span class="number">10</span>]; <span class="comment">// OK</span></span><br><span class="line"><span class="comment">// Initialize it incorrectly</span></span><br><span class="line">x = [<span class="number">10</span>, <span class="string">'hello'</span>]; <span class="comment">// Error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“è®¿é—®ä¸€ä¸ªå·²çŸ¥ç´¢å¼•çš„å…ƒç´ ï¼Œä¼šå¾—åˆ°æ­£ç¡®çš„ç±»å‹ï¼š</span></span><br><span class="line"><span class="built_in">console</span>.log(x[<span class="number">0</span>].substr(<span class="number">1</span>)); <span class="comment">// OK</span></span><br><span class="line"><span class="built_in">console</span>.log(x[<span class="number">1</span>].substr(<span class="number">1</span>)); <span class="comment">// Error, 'number' does not have 'substr'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“è®¿é—®ä¸€ä¸ªè¶Šç•Œçš„å…ƒç´ ï¼Œä¼šä½¿ç”¨è”åˆç±»å‹æ›¿ä»£ï¼š</span></span><br><span class="line">x[<span class="number">3</span>] = <span class="string">'world'</span>; <span class="comment">// OK, å­—ç¬¦ä¸²å¯ä»¥èµ‹å€¼ç»™(string | number)ç±»å‹</span></span><br><span class="line"><span class="built_in">console</span>.log(x[<span class="number">5</span>].toString()); <span class="comment">// OK, 'string' å’Œ 'number' éƒ½æœ‰ toString</span></span><br><span class="line">x[<span class="number">6</span>] = <span class="literal">true</span>; <span class="comment">// Error, å¸ƒå°”ä¸æ˜¯(string | number)ç±»å‹</span></span><br></pre></td></tr></table></figure><h3 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">enum Color &#123;Red, Green, Blue&#125;</span><br><span class="line"><span class="keyword">let</span> c: Color = Color.Green;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œä»0å¼€å§‹ä¸ºå…ƒç´ ç¼–å·ã€‚ ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„æŒ‡å®šæˆå‘˜çš„æ•°å€¼ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­æ”¹æˆä» 1å¼€å§‹ç¼–å·ï¼š</span></span><br><span class="line">enum Color &#123;Red = <span class="number">1</span>, Green, Blue&#125;</span><br><span class="line"><span class="keyword">let</span> c: Color = Color.Green;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…ï¼Œå…¨éƒ¨éƒ½é‡‡ç”¨æ‰‹åŠ¨èµ‹å€¼ï¼š</span></span><br><span class="line">enum Color &#123;Red = <span class="number">1</span>, Green = <span class="number">2</span>, Blue = <span class="number">4</span>&#125;</span><br><span class="line"><span class="keyword">let</span> c: Color = Color.Green;</span><br></pre></td></tr></table></figure><h3 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæƒ³è¦ä¸ºé‚£äº›åœ¨ç¼–ç¨‹é˜¶æ®µè¿˜ä¸æ¸…æ¥šç±»å‹çš„å˜é‡æŒ‡å®šä¸€ä¸ªç±»å‹ã€‚ è¿™äº›å€¼å¯èƒ½æ¥è‡ªäºåŠ¨æ€çš„å†…å®¹ï¼Œæ¯”å¦‚æ¥è‡ªç”¨æˆ·è¾“å…¥æˆ–ç¬¬ä¸‰æ–¹ä»£ç åº“ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ç±»å‹æ£€æŸ¥å™¨å¯¹è¿™äº›å€¼è¿›è¡Œæ£€æŸ¥è€Œæ˜¯ç›´æ¥è®©å®ƒä»¬é€šè¿‡ç¼–è¯‘é˜¶æ®µçš„æ£€æŸ¥ã€‚ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ anyç±»å‹æ¥æ ‡è®°è¿™äº›å˜é‡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notSure: any = <span class="number">4</span>;</span><br><span class="line">notSure = <span class="string">"maybe a string instead"</span>;</span><br><span class="line">notSure = <span class="literal">false</span>; <span class="comment">// okay, definitely a boolean</span></span><br></pre></td></tr></table></figure><p>åœ¨å¯¹ç°æœ‰ä»£ç è¿›è¡Œæ”¹å†™çš„æ—¶å€™ï¼Œanyç±»å‹æ˜¯ååˆ†æœ‰ç”¨çš„ï¼Œå®ƒå…è®¸ä½ åœ¨ç¼–è¯‘æ—¶å¯é€‰æ‹©åœ°åŒ…å«æˆ–ç§»é™¤ç±»å‹æ£€æŸ¥ã€‚ ä½ å¯èƒ½è®¤ä¸º<code>Object</code>æœ‰ç›¸ä¼¼çš„ä½œç”¨ï¼Œå°±åƒå®ƒåœ¨å…¶å®ƒè¯­è¨€ä¸­é‚£æ ·ã€‚ ä½†æ˜¯<code>Object</code>ç±»å‹çš„å˜é‡åªæ˜¯å…è®¸ä½ ç»™å®ƒèµ‹ä»»æ„å€¼ - ä½†æ˜¯å´ä¸èƒ½å¤Ÿåœ¨å®ƒä¸Šé¢è°ƒç”¨ä»»æ„çš„æ–¹æ³•ï¼Œå³ä¾¿å®ƒçœŸçš„æœ‰è¿™äº›æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notSure: any = <span class="number">4</span>;</span><br><span class="line">notSure.ifItExists(); <span class="comment">// okay, ifItExists might exist at runtime</span></span><br><span class="line">notSure.toFixed(); <span class="comment">// okay, toFixed exists (but the compiler doesn't check)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> prettySure: <span class="built_in">Object</span> = <span class="number">4</span>;</span><br><span class="line">prettySure.toFixed(); <span class="comment">// Error: Property 'toFixed' doesn't exist on type 'Object'.</span></span><br></pre></td></tr></table></figure><p>å½“ä½ åªçŸ¥é“ä¸€éƒ¨åˆ†æ•°æ®çš„ç±»å‹æ—¶ï¼Œanyç±»å‹ä¹Ÿæ˜¯æœ‰ç”¨çš„ã€‚ æ¯”å¦‚ï¼Œä½ æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒåŒ…å«äº†ä¸åŒçš„ç±»å‹çš„æ•°æ®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list: any[] = [<span class="number">1</span>, <span class="literal">true</span>, <span class="string">"free"</span>];</span><br><span class="line">list[<span class="number">1</span>] = <span class="number">100</span>;</span><br></pre></td></tr></table></figure><h3 id="Void"><a href="#Void" class="headerlink" title="Void"></a>Void</h3><p>æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œvoidç±»å‹åƒæ˜¯ä¸anyç±»å‹ç›¸åï¼Œå®ƒè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹ã€‚ å½“ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œä½ é€šå¸¸ä¼šè§åˆ°å…¶è¿”å›å€¼ç±»å‹æ˜¯ voidï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">warnUser</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    alert(<span class="string">"This is my warning message"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å£°æ˜ä¸€ä¸ªvoidç±»å‹çš„å˜é‡æ²¡æœ‰ä»€ä¹ˆå¤§ç”¨ï¼Œå› ä¸ºä½ åªèƒ½ä¸ºå®ƒèµ‹äºˆundefinedå’Œnullï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> unusable: <span class="keyword">void</span> = <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure><h3 id="Null-å’Œ-Undefined"><a href="#Null-å’Œ-Undefined" class="headerlink" title="Null å’Œ Undefined"></a>Null å’Œ Undefined</h3><p>TypeScripté‡Œï¼Œundefinedå’Œnullä¸¤è€…å„è‡ªæœ‰è‡ªå·±çš„ç±»å‹åˆ†åˆ«å«åšundefinedå’Œnullã€‚ å’Œ voidç›¸ä¼¼ï¼Œå®ƒä»¬çš„æœ¬èº«çš„ç±»å‹ç”¨å¤„ä¸æ˜¯å¾ˆå¤§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Not much else we can assign to these variables!</span></span><br><span class="line"><span class="keyword">let</span> u: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> n: <span class="literal">null</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹nullå’Œundefinedæ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚ å°±æ˜¯è¯´ä½ å¯ä»¥æŠŠ nullå’Œundefinedèµ‹å€¼ç»™numberç±»å‹çš„å˜é‡ã€‚</p><p>ç„¶è€Œï¼Œå½“ä½ æŒ‡å®šäº†<code>--strictNullChecks</code>æ ‡è®°ï¼Œnullå’Œundefinedåªèƒ½èµ‹å€¼ç»™voidå’Œå®ƒä»¬å„è‡ªã€‚ è¿™èƒ½é¿å… å¾ˆå¤šå¸¸è§çš„é—®é¢˜ã€‚ ä¹Ÿè®¸åœ¨æŸå¤„ä½ æƒ³ä¼ å…¥ä¸€ä¸ª <code>stringæˆ–nullæˆ–undefined</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨è”åˆç±»å‹<code>string | null | undefined</code>ã€‚</p><blockquote><p>æ³¨æ„ï¼šæˆ‘ä»¬é¼“åŠ±å°½å¯èƒ½åœ°ä½¿ç”¨â€“strictNullChecks</p></blockquote><h3 id="Never"><a href="#Never" class="headerlink" title="Never"></a>Never</h3><p><code>never</code>ç±»å‹è¡¨ç¤ºçš„æ˜¯é‚£äº›æ°¸ä¸å­˜åœ¨çš„å€¼çš„ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œ <code>never</code>ç±»å‹æ˜¯é‚£äº›æ€»æ˜¯ä¼šæŠ›å‡ºå¼‚å¸¸æˆ–æ ¹æœ¬å°±ä¸ä¼šæœ‰è¿”å›å€¼çš„å‡½æ•°è¡¨è¾¾å¼æˆ–ç®­å¤´å‡½æ•°è¡¨è¾¾å¼çš„è¿”å›å€¼ç±»å‹ï¼› å˜é‡ä¹Ÿå¯èƒ½æ˜¯ <code>never</code>ç±»å‹ï¼Œå½“å®ƒä»¬è¢«æ°¸ä¸ä¸ºçœŸçš„ç±»å‹ä¿æŠ¤æ‰€çº¦æŸæ—¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›neverçš„å‡½æ•°å¿…é¡»å­˜åœ¨æ— æ³•è¾¾åˆ°çš„ç»ˆç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params">message: string</span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨æ–­çš„è¿”å›å€¼ç±»å‹ä¸ºnever</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> error(<span class="string">"Something failed"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›neverçš„å‡½æ•°å¿…é¡»å­˜åœ¨æ— æ³•è¾¾åˆ°çš„ç»ˆç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">infiniteLoop</span>(<span class="params"></span>): <span class="title">never</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h3><p>æœ‰æ—¶å€™ä½ ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œä½ ä¼šæ¯”TypeScriptæ›´äº†è§£æŸä¸ªå€¼çš„è¯¦ç»†ä¿¡æ¯ã€‚ é€šå¸¸è¿™ä¼šå‘ç”Ÿåœ¨ä½ æ¸…æ¥šåœ°çŸ¥é“ä¸€ä¸ªå®ä½“å…·æœ‰æ¯”å®ƒç°æœ‰ç±»å‹æ›´ç¡®åˆ‡çš„ç±»å‹ã€‚</p><p>ç±»å‹æ–­è¨€æœ‰ä¸¤ç§å½¢å¼ã€‚ å…¶ä¸€æ˜¯â€œå°–æ‹¬å·â€è¯­æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue: any = <span class="string">"this is a string"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> strLength: number = (<span class="xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>someValue).length;</span></span><br></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªä¸ºasè¯­æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someValue: any = <span class="string">"this is a string"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> strLength: number = (someValue <span class="keyword">as</span> string).length;</span><br></pre></td></tr></table></figure><p>ä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„ã€‚ è‡³äºä½¿ç”¨å“ªä¸ªå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å‡­ä¸ªäººå–œå¥½ï¼›ç„¶è€Œï¼Œå½“ä½ åœ¨TypeScripté‡Œä½¿ç”¨JSXæ—¶ï¼Œåªæœ‰ <code>as</code>è¯­æ³•æ–­è¨€æ˜¯è¢«å…è®¸çš„ã€‚</p><h2 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h2><h3 id="å˜é‡ä¸ä½œç”¨åŸŸ"><a href="#å˜é‡ä¸ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡ä¸ä½œç”¨åŸŸ"></a>å˜é‡ä¸ä½œç”¨åŸŸ</h3><p>æ¨èä½¿ç”¨<code>let</code>å’Œ<code>const</code>ï¼ŒåŸºæœ¬ç”¨æ³•åŒjavascript</p><h3 id="è§£æ„"><a href="#è§£æ„" class="headerlink" title="è§£æ„"></a>è§£æ„</h3><h4 id="æ•°ç»„è§£æ„"><a href="#æ•°ç»„è§£æ„" class="headerlink" title="æ•°ç»„è§£æ„"></a>æ•°ç»„è§£æ„</h4><p>åŸºæœ¬ç”¨æ³•åŒjavascript<br>ä½œç”¨åŸŸå‡½æ•°å‚æ•°ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">[first, second]: [number, number]</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(first);</span><br><span class="line">    <span class="built_in">console</span>.log(second);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> input = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">f(input);</span><br></pre></td></tr></table></figure></p><p>ä½ å¯ä»¥åœ¨æ•°ç»„é‡Œä½¿ç”¨<code>...</code>è¯­æ³•åˆ›å»ºå‰©ä½™å˜é‡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [first, ...rest] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">console</span>.log(first); <span class="comment">// outputs 1</span></span><br><span class="line"><span class="built_in">console</span>.log(rest); <span class="comment">// outputs [ 2, 3, 4 ]</span></span><br></pre></td></tr></table></figure><h4 id="å¯¹è±¡è§£æ„"><a href="#å¯¹è±¡è§£æ„" class="headerlink" title="å¯¹è±¡è§£æ„"></a>å¯¹è±¡è§£æ„</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;a, b&#125;: &#123;<span class="attr">a</span>: string, <span class="attr">b</span>: number&#125; = o;</span><br></pre></td></tr></table></figure><p>é»˜è®¤å€¼å¯ä»¥è®©ä½ åœ¨å±æ€§ä¸º undefined æ—¶ä½¿ç”¨ç¼ºçœå€¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keepWholeObject</span>(<span class="params">wholeObject: &#123; a: string, b?: number &#125;</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; a, b = <span class="number">1001</span> &#125; = wholeObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å±•å¼€"><a href="#å±•å¼€" class="headerlink" title="å±•å¼€"></a>å±•å¼€</h3><p>åŸºæœ¬ç”¨æ³•åŒjavascript</p><p>å¯¹è±¡å±•å¼€è¿˜æœ‰å…¶å®ƒä¸€äº›æ„æƒ³ä¸åˆ°çš„é™åˆ¶ã€‚ é¦–å…ˆï¼Œå®ƒä»…åŒ…å«å¯¹è±¡ è‡ªèº«çš„å¯æšä¸¾å±æ€§ã€‚ å¤§ä½“ä¸Šæ˜¯è¯´å½“ä½ å±•å¼€ä¸€ä¸ªå¯¹è±¡å®ä¾‹æ—¶ï¼Œä½ ä¼šä¸¢å¤±å…¶æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">  p = <span class="number">12</span>;</span><br><span class="line">  m() &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> C();</span><br><span class="line"><span class="keyword">let</span> clone = &#123; ...c &#125;;</span><br><span class="line">clone.p; <span class="comment">// ok</span></span><br><span class="line">clone.m(); <span class="comment">// error!</span></span><br></pre></td></tr></table></figure><p>æ‘˜æŠ„è‡ª <a href="https://www.tslang.cn/docs/handbook/basic-types.html" target="_blank" rel="noopener">typescrpitä¸­æ–‡æ–‡æ¡£</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;TypeScriptå­¦ä¹ ç¬”è®° - åŸºç¡€ç±»å‹ã€å˜é‡å£°æ˜&lt;br&gt;
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å†™å¥½å‰ç«¯ä¸šåŠ¡ä»£ç </title>
    <link href="http://blog.chenkeyi.com/2017/10/17/businessCode/"/>
    <id>http://blog.chenkeyi.com/2017/10/17/businessCode/</id>
    <published>2017-10-17T13:25:00.000Z</published>
    <updated>2017-10-17T17:27:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h2><p>æƒ³æƒ³ä»15å¹´11æœˆåˆ°ç°åœ¨ï¼Œä»zbjä»¥å‰çš„äº¤æ˜“å–ç»å›¢ï¼Œåˆ°ç°åœ¨çš„é¡¾é—®å¹³å°ï¼Œå¤§å¤§å°å°åšäº†ä¸å°‘ä¸šåŠ¡éœ€æ±‚ï¼Œä¹Ÿæ˜¯ä¸€è¾¹è¸©å‘ï¼ˆä¸€è¾¹æŒ–å‘ï¼‰ä¸€è¾¹æˆé•¿ã€‚ä»¥å‰ç»´æŠ¤10å¹´ç´¯è®¡ä¸‹æ¥çš„è€ä»£ç ï¼Œç¼ç¼è¡¥è¡¥ï¼Œä¸»ç«™æ‰€æœ‰é¡¹ç›®å…¨éƒ¨åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œä¹Ÿæ˜¯ç»ƒå°±äº†ä¸€èº«ä»å®šä½ä»£ç çš„æœ¬äº‹ã€‚åˆ°åæ¥æ–°é¡¹ç›®ç”¨äº†æ–°æ¡†æ¶ï¼Œnodeä½œä¸ºcontrollerå±‚ï¼Œåå°ä¸éœ€è¦å…¼å®¹ieçš„é¡¹ç›®ä¹Ÿå¼•å…¥äº†vueã€‚åˆšå¼€å§‹çš„æ—¶å€™å¼€å¿ƒå¾—ä¸è¡Œï¼Œç»ˆäºä¸ç”¨è‹¦é€¼åœ°æ­phpé‚£ä¸€å¥—è€å¼€å‘ç¯å¢ƒï¼Œå‰åç«¯å½»åº•åˆ†ç¦»ï¼Œä¹Ÿä¸ç”¨ç»´æŠ¤é‚£äº›â€œé™ˆå¹´ä½³é…¿â€ã€‚åæ¥æ‰æ…¢æ…¢å‘ç°ï¼Œå…¶å®å¹¶ä¸æ˜¯é‚£ä¹ˆè½»æ¾ã€‚javaå†™çš„æœåŠ¡åŒ–æ¥å£ï¼ŒåŸºæœ¬æ˜¯åŸå­æ€§çš„æ¥å£ï¼Œä¸€ä¸ªæ¥å£åªåšä¸€ä»¶äº‹ï¼Œæ‰€ä»¥å‰ç«¯é™¤äº†å®Œæˆä»¥å‰çš„å·¥ä½œå¤–ï¼Œnodeç«¯å¿…é¡»å»å¤„ç†ä¹‹å‰å‡ ä¹æ²¡æœ‰æ¶‰åŠåˆ°çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿæ‰¿æ‹…äº†æ›´é‡è¦çš„è´£ä»»ã€‚ç»è¿‡äº†ä¸€å¹´å·¦å³ï¼Œå‡ ä¸ªé¡¹ç›®çš„æ‘¸ç´¢ï¼Œæˆ‘ä¹Ÿæ€»ç»“å‡ºäº†ä¸€äº›ä¸šåŠ¡ç»éªŒã€‚</p><h2 id="äºŒã€æ’æœŸ"><a href="#äºŒã€æ’æœŸ" class="headerlink" title="äºŒã€æ’æœŸ"></a>äºŒã€æ’æœŸ</h2><p>è¿™æ˜¯å¾ˆé‡è¦å´æœ€å®¹æ˜“è¢«å¿½ç•¥çš„ä¸€ä¸ªç¯èŠ‚ã€‚é¡¹ç›®åšåˆ°åé¢åšå¾—å¾ˆç´¯ï¼Œæ„Ÿè§‰è‡ªå·±æ€ä¹ˆä¹Ÿå®Œä¸æˆï¼Œå¾€å¾€æ˜¯å› ä¸ºæ’æœŸæ²¡æœ‰åšå¥½ã€‚ </p><h3 id="éœ€æ±‚åˆ†æ-åŠŸèƒ½æ¨¡å—ç»†åˆ†"><a href="#éœ€æ±‚åˆ†æ-åŠŸèƒ½æ¨¡å—ç»†åˆ†" class="headerlink" title="éœ€æ±‚åˆ†æ,åŠŸèƒ½æ¨¡å—ç»†åˆ†"></a>éœ€æ±‚åˆ†æ,åŠŸèƒ½æ¨¡å—ç»†åˆ†</h3><p>ä¸€ä¸ªéœ€æ±‚æˆ‘ä»¬æ‹¿åˆ°çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯å…ˆåšéœ€æ±‚åˆ†æã€‚æ’æœŸä¹Ÿæ˜¯åœ¨å®Œæˆéœ€æ±‚åˆ†æçš„åŸºç¡€ä¸Šè¿›è¡Œçš„ï¼Œéœ€æ±‚åˆ†æçš„æ—¶å€™éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ã€‚</p><h4 id="æ˜ç¡®éœ€æ±‚"><a href="#æ˜ç¡®éœ€æ±‚" class="headerlink" title="æ˜ç¡®éœ€æ±‚"></a>æ˜ç¡®éœ€æ±‚</h4><p>æ ¹æ®äº§å“åŸå‹å’Œäº§å“çš„éœ€æ±‚å®£è®²ï¼Œæ¢³ç†ä¸€ééœ€æ±‚ï¼Œå¦‚æœæœ‰è‡ªå·±ä¸æ‡‚æˆ–è€…ä¸ç†è§£çš„åœ°æ–¹ä¸€å®šè¦åœ¨è¿™ä¸ªé˜¶æ®µäº§å“æ˜ç¡®ã€‚</p><h4 id="æ¨¡å—ã€åŠŸèƒ½åˆ’åˆ†"><a href="#æ¨¡å—ã€åŠŸèƒ½åˆ’åˆ†" class="headerlink" title="æ¨¡å—ã€åŠŸèƒ½åˆ’åˆ†"></a>æ¨¡å—ã€åŠŸèƒ½åˆ’åˆ†</h4><p>å•é¡µé¢æ’æœŸä¸€èˆ¬å°±æ˜¯ä»ä¸Šåˆ°ä¸‹æŒ‰ç…§åŠŸèƒ½ä¸åŒåˆ†æ¨¡å—ï¼Œæ¯”å¦‚é¡¶éƒ¨å¯¼èˆªã€ä¿¡æ¯å±•ç¤ºã€è¯„ä»·åˆ—è¡¨ç­‰ç­‰ã€‚</p><p>ä¸€èˆ¬ä¸€ä¸ªå¤šé¡µé¢çš„é¡¹ç›®ï¼Œäº§å“ä»¬ä¼šåœ¨äº§å“åŸå‹ä¸Šæ ¹æ®ä»–ä»¬çš„ç†è§£ï¼Œåˆ†å‡ ä¸ªæ¿å—ã€‚ä½†æ˜¯æˆ‘ä»¬åˆ†æéœ€æ±‚çš„æ—¶å€™ä¸èƒ½ç”¨ä»–ä»¬çš„æ€è·¯å»åˆ†ç‰ˆå—ï¼Œè€Œæ˜¯è¦ä»å¼€å‘å’Œç¨‹åºè®¾è®¡çš„è§’åº¦å»åˆ’åˆ†ã€‚æ¯”å¦‚åœ¨é¦–é¡µã€æŸæŸæœç´¢ç»“æœé¡µã€æŸæŸé¡µæœ‰ä¸‰ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œè™½ç„¶æ ·å¼ä¸åŒã€é€»è¾‘ä¸å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ä»–ä»¬éƒ½åœ¨æŸæ­¥éª¤ä¸Šæ¶‰åŠåŒä¸€ä¸ªä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚ç‚¹å‡»æŸä¸ªåœ°æ–¹ï¼Œåˆ¤æ–­ç”¨æˆ·åœ¨çº¿ï¼Œä¸åœ¨çº¿è°ƒå‡ºç™»å½•æ¡†ï¼Œåœ¨çº¿çš„è¯åˆ›å»ºè®¢å•ï¼Œç„¶åè·³è½¬æ”¯ä»˜é¡µé¢ã€‚balabalaï¼Œè¿™ä¸ªé€»è¾‘æ˜¯ä¸æ˜¯æœ€å¥½è®©åŒä¸€ä¸ªäººå»å®Œæˆï¼Œè€Œä¸”æœ€å¥½å†™æˆä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æˆ–è€…ç»„ä»¶å‘¢ã€‚</p><h3 id="ä¾èµ–å…³ç³»æ•´ç†ï¼Œæ—¶é—´çº¿æ•´ç†"><a href="#ä¾èµ–å…³ç³»æ•´ç†ï¼Œæ—¶é—´çº¿æ•´ç†" class="headerlink" title="ä¾èµ–å…³ç³»æ•´ç†ï¼Œæ—¶é—´çº¿æ•´ç†"></a>ä¾èµ–å…³ç³»æ•´ç†ï¼Œæ—¶é—´çº¿æ•´ç†</h3><p>åˆ’åˆ†å¥½æ¨¡å—åï¼Œå°±æ˜¯è¿›è¡Œå·¥æœŸé¢„ä¼°äº†ã€‚è¿™ä¹Ÿæ˜¯ä¸€é¡¹å¾ˆé‡è¦çš„å·¥ä½œï¼Œä¸ä»…æ˜¯è®©å›¢é˜Ÿçš„å¼€å‘ã€æµ‹è¯•ã€ä¸Šçº¿è®¡åˆ’èƒ½å¤Ÿé¡ºåˆ©å¼€å±•ï¼Œè€Œä¸”ä¹Ÿèƒ½å¸®æˆ‘ä»¬è¿›è¡Œå‰æœŸå·¥ä½œä¼˜å…ˆçº§å®‰æ’ã€‚</p><p>éœ€è¦ä¾èµ–çš„ä¸œè¥¿åŒ…æ‹¬è®¾è®¡ç¨¿ã€åç«¯æ¥å£ã€å…¶ä»–å‰ç«¯ç»„ä»¶ã€äººå‘˜åˆ°ä½æ—¶é—´ç­‰ç­‰ï¼Œæ’æœŸæ—¶é—´éœ€è¦æ ¹æ®è¿™äº›ä¾èµ–é¡¹äº§å‡ºçš„æ—¶é—´è¿›è¡Œæ—¶é—´çº¿çš„æ•´ç†ã€‚</p><h3 id="é£é™©ç‚¹é¢„æµ‹"><a href="#é£é™©ç‚¹é¢„æµ‹" class="headerlink" title="é£é™©ç‚¹é¢„æµ‹"></a>é£é™©ç‚¹é¢„æµ‹</h3><p>å®¹æ˜“äº§ç”Ÿé£é™©çš„ç‚¹éœ€è¦æå‡ºæ¥ï¼Œæ’æœŸä¸­ç•™å‡ºé€‚å½“çš„ç¼“å’Œæ—¶é—´ã€‚å½“ç„¶åœ¨å¼€å‘ä¸­é‡åˆ°é˜»ç¢ä¹Ÿè¦åŠæ—¶æŠ›å‡ºï¼Œè®©PMOæˆ–è€…é¡¹ç›®è´Ÿè´£äººåŠæ—¶è·Ÿè¿›è§£å†³ã€‚</p><h3 id="æ¯å¤©è·Ÿè¿›æˆ–è€…æ€»ç»“"><a href="#æ¯å¤©è·Ÿè¿›æˆ–è€…æ€»ç»“" class="headerlink" title="æ¯å¤©è·Ÿè¿›æˆ–è€…æ€»ç»“"></a>æ¯å¤©è·Ÿè¿›æˆ–è€…æ€»ç»“</h3><p>æ ¹æ®æ’æœŸæœ€å¥½åšä¸€ä¸ªä»»åŠ¡æ¸…å•ï¼Œæ¯å¤©æ€»ç»“å®Œæˆçš„é¡¹ç›®ï¼Œæƒ³å¥½æ˜å¤©çš„å¼€å‘è®¡åˆ’ã€‚</p><h2 id="å¦‚ä½•é¢å¯¹å¿«é€Ÿçš„ä¸šåŠ¡éœ€æ±‚è¿­ä»£"><a href="#å¦‚ä½•é¢å¯¹å¿«é€Ÿçš„ä¸šåŠ¡éœ€æ±‚è¿­ä»£" class="headerlink" title="å¦‚ä½•é¢å¯¹å¿«é€Ÿçš„ä¸šåŠ¡éœ€æ±‚è¿­ä»£"></a>å¦‚ä½•é¢å¯¹å¿«é€Ÿçš„ä¸šåŠ¡éœ€æ±‚è¿­ä»£</h2><p>æœ€è¿‘åšçš„ä¸€ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªä»0å¼€å§‹çš„æ–°é¡¹ç›®ï¼Œäº§å“å‘å±•æ–¹å‘å…¶å®ä¹Ÿä¸æ˜¯éå¸¸æ˜ç¡®ï¼Œéœ€è¦ä¸Šçº¿è¯•é”™ï¼Œç»è¿‡ç”¨æˆ·åé¦ˆå’Œæ•°æ®æ”¶é›†åä¸æ–­æ”¹è¿›ã€‚ä¸€æœŸäº§å“ä¸ºäº†å¿«é€Ÿä¸Šçº¿å¾€å¾€å¾ˆå¤šéœ€æ±‚åšäº†ç®€åŒ–ï¼Œè¿™æ—¶å€™å¦‚æœåœ¨ä¸€æœŸçš„å¼€å‘ä¸Šä¸æ³¨é‡é¡¹ç›®çš„æ‰©å±•æ€§ï¼Œåé¢çš„æ¯ä¸€æ¬¡è¿­ä»£éƒ½æ˜¯ä¼¤ç­‹åŠ¨éª¨ã€‚</p><h3 id="åŠŸèƒ½ç»†åˆ†ã€ä»£ç æ¨¡å—åŒ–"><a href="#åŠŸèƒ½ç»†åˆ†ã€ä»£ç æ¨¡å—åŒ–" class="headerlink" title="åŠŸèƒ½ç»†åˆ†ã€ä»£ç æ¨¡å—åŒ–"></a>åŠŸèƒ½ç»†åˆ†ã€ä»£ç æ¨¡å—åŒ–</h3><p>å°½é‡è®©åŠŸèƒ½å˜æˆç§¯æœ¨ä¸€æ ·çš„ï¼Œæ¯ä¸ªéƒ¨åˆ†å†™æˆä¸€ä¸ªæ¨¡å—ï¼Œæ–¹ä¾¿åæœŸç»´æŠ¤å’Œæ‹“å±•ã€‚ä»£ç æ¨¡å—åŒ–ï¼Œä¸€ä¸ªå‡ åƒè¡Œçš„æ–‡ä»¶ï¼Œå‡ ç™¾è¡Œçš„æ–¹æ³•çœŸçš„éš¾ä»¥ç»´æŠ¤ï¼Œå…¶å®å°±æ˜¯ä¸€å¥è¯ï¼Œå½“ä½ è§‰å¾—è¿™éƒ¨åˆ†ä»£ç å¥½é•¿ï¼Œé‚£å°±æ˜¯éœ€è¦æ‹†åˆ†æ¨¡å—äº†ã€‚</p><h3 id="é€šç”¨æ¥å£å¤šæ ·åŒ–"><a href="#é€šç”¨æ¥å£å¤šæ ·åŒ–" class="headerlink" title="é€šç”¨æ¥å£å¤šæ ·åŒ–"></a>é€šç”¨æ¥å£å¤šæ ·åŒ–</h3><p>è¿™ä¹Ÿç®—æ˜¯æˆ‘æŒ–çš„ä¸€ä¸ªå‘ã€‚åœ¨ä¸€æœŸçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæœç´¢æ¥å£ï¼Œå½“æ—¶çš„éœ€æ±‚åªéœ€è¦é€šè¿‡ä¸€ä¸ªidè¿›è¡ŒæŸ¥è¯¢ï¼Œæˆ‘è®¾è®¡çš„æ¥å£å‚æ•°å°±æ˜¯ä¼ ä¸€ä¸ªidã€‚å½“1.2.4çš„è¿­ä»£ç‰ˆæœ¬çš„æ—¶å€™ï¼Œäº§å“è¯´éœ€è¦æ”¯æŒå¤šä¸ªidæŸ¥è¯¢ï¼ŒjavaæŠŠå‚æ•°æ”¹æˆäº†æ•°ç»„ç±»å‹ã€‚æˆ‘å‡†å¤‡æ”¹çš„æ—¶å€™ï¼Œå‘ç°å·²ç»æœ‰å‡ ä¸ªå…¶ä»–ä¸šåŠ¡æ–¹è°ƒç”¨æˆ‘è¿™ä¸ªæ¥å£ï¼Œä¼ çš„æ˜¯å•ä¸ªidï¼Œæˆ‘ä¸ºäº†ä¸å»æ”¹æ›´å¤šåœ°æ–¹ï¼Œåªèƒ½åœ¨æ¥å£å±‚é¢åšäº†å•ä¸ªå’Œå¤šä¸ªçš„å…¼å®¹ã€‚</p><p>æ‰€ä»¥åœ¨æ¥å£è®¾è®¡çš„æ—¶å€™ï¼Œå°±è¦å°½å¯èƒ½è€ƒè™‘å¤šç§è°ƒç”¨åœºæ™¯ï¼Œå¯æ‹“å±•åœ°è®¾è®¡æ¥å£å…¥å‚å’Œå‡ºå‚ã€‚</p><h3 id="å…¬ç”¨é€»è¾‘æå–"><a href="#å…¬ç”¨é€»è¾‘æå–" class="headerlink" title="å…¬ç”¨é€»è¾‘æå–"></a>å…¬ç”¨é€»è¾‘æå–</h3><p>ä¹‹å‰ä¹Ÿæåˆ°äº†ï¼Œåœ¨ä¸€æœŸçš„æ—¶å€™å¯èƒ½æˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç°è¿™ä¸ªé€»è¾‘å…¶ä»–åœ°æ–¹ä¹Ÿå¯èƒ½ä¼šç”¨ï¼Œæ‰€ä»¥å†™åˆ°äº†è‡ªå·±çš„æ¨¡å—æ–‡ä»¶é‡Œã€‚å½“åé¢ä¸šåŠ¡å‘å±•ï¼Œè¿™ä¸ªé€»è¾‘å…¶ä»–ä¸šåŠ¡æ–¹ä¹Ÿè¦æ¥å…¥ï¼Œè€Œä¸”ä»…ä»…æ˜¯æ¥å¤åˆ¶ç²˜è´´ä½ çš„ä»£ç çš„æ—¶å€™ï¼Œå°±åº”è¯¥è¦é©¬ä¸Šåšå‡ºåˆ¤æ–­ï¼Œè¿™éƒ¨åˆ†é€»è¾‘æ˜¯å¦éœ€è¦ææˆä¸€ä¸ªå…¬ç”¨æ¥å£ï¼Œå¦‚æœæ˜¯åŒ…å«äº†å‰ç«¯å„ç§é€»è¾‘æ¯”å¦‚å¼¹çª—ã€è°ƒç”¨å…¶ä»–å‰ç«¯ç»„ä»¶ç­‰ï¼Œè¿™ä¸ªé€»è¾‘å°±è¦ææˆä¸€ä¸ªç»„ä»¶ã€‚<br>ä¸€æ˜¯å‡å°‘äº†åç»­çš„å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ï¼ŒäºŒæ˜¯è®©è¿™éƒ¨åˆ†é€»è¾‘æ›´åŠ å¯æ§ã€‚ä¿è¯åç»­ä¿®æ”¹é€»è¾‘çš„æ—¶å€™ï¼Œæ²¡æœ‰é—æ¼åˆ°æŸä¸ªåœ°æ–¹ã€‚é™¤äº†ä¿è¯ç»„ä»¶çš„ä¸€è‡´æ€§ï¼Œå¯æ‹“å±•æ€§ä¹Ÿå¾ˆé‡è¦ï¼Œå¯¹äºç»„ä»¶çš„è®¾è®¡ï¼Œåˆæ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜äº†ã€‚</p><h3 id="å†…å®¹é…ç½®åŒ–ï¼Œä¸šåŠ¡é€»è¾‘ä¸è¦å†™æ­»"><a href="#å†…å®¹é…ç½®åŒ–ï¼Œä¸šåŠ¡é€»è¾‘ä¸è¦å†™æ­»" class="headerlink" title="å†…å®¹é…ç½®åŒ–ï¼Œä¸šåŠ¡é€»è¾‘ä¸è¦å†™æ­»"></a>å†…å®¹é…ç½®åŒ–ï¼Œä¸šåŠ¡é€»è¾‘ä¸è¦å†™æ­»</h3><p>é™¤äº†äº§å“æå‡ºéœ€æ±‚è¦å¼€å‘é…ç½®åŠŸèƒ½å¤–ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿè¦ä¸»åŠ¨å»æ‹†åˆ†å¯é…ç½®çš„å†…å®¹ã€‚<br>ä¸€äº›ä¸šåŠ¡ä¸Šç»å¸¸æ”¹åŠ¨çš„éƒ¨åˆ†ï¼Œéœ€è¦äº§å“å’Œè¿è¥å»ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚æ¨èä½idåˆ—è¡¨ï¼Œæ¨èä½å›¾ç‰‡ç­‰ï¼Œèµ°cmsé…ç½®ã€‚<br>ä¸€äº›é™æ€æ•°æ®ï¼Œä¸ç»å¸¸æ”¹ä½†æ˜¯å¯èƒ½æ”¹åŠ¨ï¼Œæ¯”å¦‚ç½‘å€ç­‰å¯ä»¥å†™åˆ°é…ç½®ä¸­å¿ƒæˆ–è€…é…ç½®æ–‡ä»¶ã€‚<br>å¦‚æœå®åœ¨æ²¡å¿…è¦èµ°é…ç½®çš„ï¼Œä¹Ÿè¦å†™æˆä¸€ä¸ªå¸¸é‡ï¼Œè¿™å°±è®©æˆ‘æƒ³èµ·äº†ä»¥å‰æ¥çš„ä¸€ä¸ªéœ€æ±‚ï¼ŒæŠŠæŸæŸå‘å¸ƒæœ€ä½é‡‘é¢é™åˆ¶çš„åˆ¤æ–­ä»<code>3000</code>æ”¹åˆ°<code>1000</code>ï¼Œæˆ‘åœ¨è€ä»£ç é‡Œ<code>ctrl+f</code>äº†å¾ˆå¤šåœ°æ–¹ï¼Œæ‰æŠŠé‚£äº›<code>3000</code>å…¨éƒ¨æ”¹æˆä¸€ä¸ªç»Ÿä¸€çš„å¸¸é‡ã€‚</p><p>é™æ€å†…å®¹å’Œä»£ç åˆ†ç¦»æ˜¯æœ€å¥½çš„ï¼Œå†…å®¹æ”¹åŠ¨ï¼Œä»…ä»…æ”¹ä¸€ä¸‹é…ç½®å°±è¡Œï¼Œä¸éœ€è¦èµ°ä¸Šçº¿æµç¨‹ï¼Œè¿™æ ·æ‰èƒ½çœŸæ­£åšåˆ°ä»¥ä¸å˜åº”ä¸‡å˜ã€‚</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>è¿˜æœ‰å…¶ä»–éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œæˆ‘ä¹Ÿå°±ä¸ä¸€ä¸€è¯´æ˜äº†ã€‚</p><ul><li>å‘ç°ä¸å¯¹åŠ²ï¼Œä¸€å®šè¦åœä¸‹æ¥å’Œäº§å“æ²Ÿé€šã€‚</li><li>ä»»ä½•æ˜¾ç¤ºç»™ç”¨æˆ·çš„å­—ç¬¦ä¸²ï¼Œéƒ½åº”è¯¥æŠ½å–æˆå¸¸é‡ï¼Œæ–¹ä¾¿å›½é™…åŒ–ï¼Œè¿™ç‚¹ä¹Ÿæ˜¯æˆ‘åšäº†ä¸€ä¸ªé¡¹ç›®è½¬å›½é™…åŒ–çš„éœ€æ±‚å¾—å‡ºçš„æ„Ÿæƒ³ã€‚ä½†æ˜¯åœ¨åç»­å¼€å‘ä¸­å…¶å®è¿˜æ˜¯æ²¡æœ‰å®æ–½ï¼Œå¦‚æœé¡¹ç›®æœ‰å›½é™…åŒ–çš„éœ€æ±‚ï¼Œéœ€è¦è€ƒè™‘è¿™ä¸€ç‚¹ã€‚</li></ul><h2 id="ä¸‰ã€ä¸šåŠ¡å®‰å…¨é—®é¢˜"><a href="#ä¸‰ã€ä¸šåŠ¡å®‰å…¨é—®é¢˜" class="headerlink" title="ä¸‰ã€ä¸šåŠ¡å®‰å…¨é—®é¢˜"></a>ä¸‰ã€ä¸šåŠ¡å®‰å…¨é—®é¢˜</h2><p>å› ä¸ºåšäº†Nodeå±‚ï¼Œå¾ˆå¤šå‚æ•°æ ¡éªŒéƒ½æ˜¯æˆ‘ä»¬åšäº†ï¼Œä¹Ÿå°±ç§¯ç´¯äº†ä¸€äº›å’Œä¸šåŠ¡å®‰å…¨ç›¸å…³çš„ç»éªŒï¼ˆå®‰å…¨æµ‹è¯•ç¯èŠ‚è¢«æŸ¥æ°´è¡¨ï¼‰ã€‚è¿™é‡Œæåˆ°çš„å°±ä¸ä»…ä»…æ˜¯xsså’Œcsrfäº†ï¼Œæ›´å¤šçš„æ˜¯ä¸šåŠ¡å±‚é¢çš„å®‰å…¨é—®é¢˜</p><ul><li>xss</li><li>csrf</li><li>è¡¨å•æäº¤çš„å†…å®¹ï¼Œå¦‚æœç½‘ç«™æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œéœ€è¦åšè¿è§„è¿æ³•å­—è¿‡æ»¤</li><li>æ¨é€çº¢åŒ…ã€ç«™å†…ä¿¡ã€é€šçŸ¥ã€å‘å¸ƒè®¢å•ã€å‘é€æ‰‹æœºéªŒè¯ç ç­‰httpæ¥å£ï¼Œéœ€è¦åšé˜²åˆ·å¤„ç†ï¼Œé™åˆ¶æ¬¡æ•°</li><li>ç”¨æˆ·idç”¨tokenåŠ å¯†è§£å¯†è·å–ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨cookieé‡Œçš„userid</li><li>æ³¨æ„åˆ¤æ–­ç”¨æˆ·çš„èº«ä»½å’Œæƒé™ï¼Œé˜²æ­¢è¶Šæƒ</li></ul><h2 id="å››ã€å®šä½é—®é¢˜"><a href="#å››ã€å®šä½é—®é¢˜" class="headerlink" title="å››ã€å®šä½é—®é¢˜"></a>å››ã€å®šä½é—®é¢˜</h2><ol><li>å°½é‡åœ¨æ‰€æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼Œæ•è·å¹¶æŠ›å‡ºé—®é¢˜ï¼ŒæŠ¥é”™å†…å®¹æ¸…æ™°æŒ‡æ˜ä»€ä¹ˆæ¥å£æŠ¥é”™ï¼Œæ–¹ä¾¿å®šä½ã€‚æ¯”å¦‚ä¸€å¤§å †çš„æŠ¥é”™éƒ½æ˜¯<code>&#39;ç³»ç»Ÿå¼‚å¸¸ï¼&#39;</code>å’Œ<code>åˆ›å»ºæ”¯ä»˜è®¢å•å¤±è´¥ï¼šxxxx</code>ï¼Œå“ªä¸ªæ›´å®¹æ˜“å®šä½é”™è¯¯å‘¢ï¼Ÿ</li><li>æ–¹æ³•æ–‡æ¡£æ¸…æ™°ã€‚</li><li>ä½¿ç”¨charlesã€findlerç­‰å·¥å…·è°ƒè¯•éæœ¬åœ°ç¯å¢ƒä»£ç </li></ol><p>æš‚æ—¶æƒ³åˆ°äº†è¿™äº›ï¼Œå¦‚æœåç»­è¿˜æœ‰æ–°çš„ä½“ä¼šä¼šæ¥è¡¥å……ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸€ã€èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#ä¸€ã€èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€èƒŒæ™¯&quot;&gt;&lt;/a&gt;ä¸€ã€èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æƒ³æƒ³ä»15å¹´11æœˆåˆ°ç°åœ¨ï¼Œä»zbjä»¥å‰çš„äº¤æ˜“å–ç»å›¢ï¼Œåˆ°ç°åœ¨çš„é¡¾é—®å¹³å°ï¼Œå¤§å¤§å°å°åšäº†ä¸å°‘ä¸šåŠ¡éœ€æ±‚ï¼Œä¹Ÿæ˜¯ä¸€è¾¹è¸©å‘ï¼ˆä¸€è¾¹æŒ–å‘ï¼‰ä¸€è¾¹
      
    
    </summary>
    
    
      <category term="ä½“ä¼šæ„Ÿæ‚Ÿ" scheme="http://blog.chenkeyi.com/tags/%E4%BD%93%E4%BC%9A%E6%84%9F%E6%82%9F/"/>
    
  </entry>
  
  <entry>
    <title>webpackå­¦ä¹ ç¬”è®°</title>
    <link href="http://blog.chenkeyi.com/2017/09/05/webpack/"/>
    <id>http://blog.chenkeyi.com/2017/09/05/webpack/</id>
    <published>2017-09-05T08:31:00.000Z</published>
    <updated>2017-10-17T20:06:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>webpackå­¦ä¹ ç¬”è®°<br><a id="more"></a></p><blockquote><p><a href="https://doc.webpack-china.org/guides/getting-started/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p></blockquote><h2 id="webpackçš„ç‰¹ç‚¹"><a href="#webpackçš„ç‰¹ç‚¹" class="headerlink" title="webpackçš„ç‰¹ç‚¹"></a>webpackçš„ç‰¹ç‚¹</h2><h3 id="ä»£ç æ‹†åˆ†"><a href="#ä»£ç æ‹†åˆ†" class="headerlink" title="ä»£ç æ‹†åˆ†"></a>ä»£ç æ‹†åˆ†</h3><p><code>Webpack</code> æœ‰ä¸¤ç§ç»„ç»‡æ¨¡å—ä¾èµ–çš„æ–¹å¼ï¼ŒåŒæ­¥å’Œå¼‚æ­¥ã€‚å¼‚æ­¥ä¾èµ–ä½œä¸ºåˆ†å‰²ç‚¹ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„å—ã€‚åœ¨ä¼˜åŒ–äº†ä¾èµ–æ ‘åï¼Œæ¯ä¸€ä¸ªå¼‚æ­¥åŒºå—éƒ½ä½œä¸ºä¸€ä¸ªæ–‡ä»¶è¢«æ‰“åŒ…ã€‚</p><h3 id="Loader"><a href="#Loader" class="headerlink" title="Loader"></a>Loader</h3><p><code>Webpack</code> æœ¬èº«åªèƒ½å¤„ç†åŸç”Ÿçš„ <code>JavaScript</code> æ¨¡å—ï¼Œä½†æ˜¯ <code>loader</code> è½¬æ¢å™¨å¯ä»¥å°†å„ç§ç±»å‹çš„èµ„æºè½¬æ¢æˆ <code>JavaScript</code> æ¨¡å—ã€‚è¿™æ ·ï¼Œä»»ä½•èµ„æºéƒ½å¯ä»¥æˆä¸º <code>Webpack</code> å¯ä»¥å¤„ç†çš„æ¨¡å—ã€‚</p><h3 id="æ™ºèƒ½è§£æ"><a href="#æ™ºèƒ½è§£æ" class="headerlink" title="æ™ºèƒ½è§£æ"></a>æ™ºèƒ½è§£æ</h3><p><code>Webpack</code> æœ‰ä¸€ä¸ªæ™ºèƒ½è§£æå™¨ï¼Œå‡ ä¹å¯ä»¥å¤„ç†ä»»ä½•ç¬¬ä¸‰æ–¹åº“ï¼Œæ— è®ºå®ƒä»¬çš„æ¨¡å—å½¢å¼æ˜¯ <code>CommonJS</code>ã€ <code>AMD</code> è¿˜æ˜¯æ™®é€šçš„ <code>JS</code> æ–‡ä»¶ã€‚ç”šè‡³åœ¨åŠ è½½ä¾èµ–çš„æ—¶å€™ï¼Œå…è®¸ä½¿ç”¨åŠ¨æ€è¡¨è¾¾å¼ <code>require(&quot;./templates/&quot; + name + &quot;.jade&quot;)</code>ã€‚</p><h3 id="æ’ä»¶ç³»ç»Ÿ"><a href="#æ’ä»¶ç³»ç»Ÿ" class="headerlink" title="æ’ä»¶ç³»ç»Ÿ"></a>æ’ä»¶ç³»ç»Ÿ</h3><p><code>Webpack</code> è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„æ’ä»¶ç³»ç»Ÿã€‚å¤§å¤šæ•°å†…å®¹åŠŸèƒ½éƒ½æ˜¯åŸºäºè¿™ä¸ªæ’ä»¶ç³»ç»Ÿè¿è¡Œçš„ï¼Œè¿˜å¯ä»¥å¼€å‘å’Œä½¿ç”¨å¼€æºçš„ Webpack æ’ä»¶ï¼Œæ¥æ»¡è¶³å„å¼å„æ ·çš„éœ€æ±‚ã€‚</p><h3 id="å¿«é€Ÿè¿è¡Œ"><a href="#å¿«é€Ÿè¿è¡Œ" class="headerlink" title="å¿«é€Ÿè¿è¡Œ"></a>å¿«é€Ÿè¿è¡Œ</h3><p><code>Webpack</code> ä½¿ç”¨å¼‚æ­¥ <code>I/O</code> å’Œå¤šçº§ç¼“å­˜æé«˜è¿è¡Œæ•ˆç‡ï¼Œè¿™ä½¿å¾— <code>Webpack</code> èƒ½å¤Ÿä»¥ä»¤äººéš¾ä»¥ç½®ä¿¡çš„é€Ÿåº¦å¿«é€Ÿå¢é‡ç¼–è¯‘ã€‚</p><h2 id="é…ç½®ï¼š"><a href="#é…ç½®ï¼š" class="headerlink" title="é…ç½®ï¼š"></a>é…ç½®ï¼š</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//å…¥å£æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// entry: './src/script/main.js',</span></span><br><span class="line">    <span class="comment">// entry:["./src/script/main.js","./src/script/a.js"],//æŠŠ2ä¸ªæ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·</span></span><br><span class="line">    entry:&#123;</span><br><span class="line">        main:<span class="string">'./src/script/main.js'</span>,</span><br><span class="line">        a:<span class="string">"./src/script/a.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//è¾“å‡º</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        filename: <span class="string">'js/[name]-[chunkhash].js'</span>,</span><br><span class="line">        publicPath: <span class="string">'http://cdn.com'</span> <span class="comment">//ç¼–è¯‘çš„æ–‡ä»¶åŸŸå</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                <span class="string">'style-loader'</span>,</span><br><span class="line">                <span class="string">'css-loader'</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//source-map ä»…å¼€å‘ç¯å¢ƒä½¿ç”¨</span></span><br><span class="line">    devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="comment">//https://www.npmjs.com/package/html-webpack-plugin</span></span><br><span class="line">        <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            filename:<span class="string">'index.html'</span>,</span><br><span class="line">            template: <span class="string">'index.html'</span>,</span><br><span class="line">            inject:<span class="string">'body'</span>, <span class="comment">//scriptæ ‡ç­¾æ”¾çš„ä½ç½®</span></span><br><span class="line">            title:<span class="string">'webpack is index'</span>,</span><br><span class="line">            minify: &#123;</span><br><span class="line">                removeComments:<span class="literal">true</span>,<span class="comment">//åˆ é™¤æ³¨é‡Š</span></span><br><span class="line">                collapseWhitespace:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// chunks: ['main','a'] //æŒ‡å®šå½“å‰htmlåŒ…å«çš„chunk</span></span><br><span class="line">            excludeChunks:[<span class="string">'a'</span>]<span class="comment">//æŒ‡å®šæ’é™¤çš„chunk</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> htmlWebpackPlugin(&#123;</span><br><span class="line">            filename:<span class="string">'a.html'</span>,</span><br><span class="line">            template: <span class="string">'index.html'</span>,</span><br><span class="line">            inject:<span class="string">'body'</span>, <span class="comment">//scriptæ ‡ç­¾æ”¾çš„ä½ç½®</span></span><br><span class="line">            title:<span class="string">'webpack is a'</span>,</span><br><span class="line">            minify: &#123;</span><br><span class="line">                removeComments:<span class="literal">true</span>,<span class="comment">//åˆ é™¤æ³¨é‡Š</span></span><br><span class="line">                collapseWhitespace:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// chunks: ['a'] //æŒ‡å®šå½“å‰htmlåŒ…å«çš„chunk</span></span><br><span class="line">            excludeChunks:[<span class="string">'main'</span>]<span class="comment">//æŒ‡å®šæ’é™¤çš„chunk</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;webpackå­¦ä¹ ç¬”è®°&lt;br&gt;
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>postMessageè§£å†³è·¨åŸŸã€è·¨çª—å£æ¶ˆæ¯ä¼ é€’</title>
    <link href="http://blog.chenkeyi.com/2017/08/27/postMessage-api/"/>
    <id>http://blog.chenkeyi.com/2017/08/27/postMessage-api/</id>
    <published>2017-08-27T06:06:50.000Z</published>
    <updated>2017-10-17T20:07:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œé¡µé¢åµŒå…¥äº†iframeæ¡†ï¼Œiframeæ¡†é‡Œæ˜¯ä¸€ä¸ªImåœ¨çº¿èŠå¤©å¯¹è¯æ¡†ã€‚åœ¨ç”¨æˆ·åˆ‡æ¢èŠå¤©å¯¹è±¡æ—¶ï¼Œå¤–å±‚é¡µé¢ä¹Ÿéœ€è¦è·å–å½“å‰ç”¨æˆ·æ­£åœ¨èŠå¤©çš„å¯¹æ–¹çš„useridã€‚ä½†æ˜¯ç”±äºimé¡µé¢æ˜¯åµŒå…¥çš„iframeï¼Œå¤–å±‚çˆ¶é¡µé¢æ—¢æ— æ³•ç›‘å¬åˆ‡æ¢èŠå¤©å¯¹è±¡çš„äº‹ä»¶ï¼Œä¹Ÿæ— æ³•è·å–é‡Œé¢çš„domå…ƒç´ ï¼Œä¼šæŠ¥è·¨åŸŸçš„é”™è¯¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨html5çš„API<code>postMessage</code>.</p><a id="more"></a><h2 id="postMessageç®€å•ä»‹ç»"><a href="#postMessageç®€å•ä»‹ç»" class="headerlink" title="postMessageç®€å•ä»‹ç»"></a>postMessageç®€å•ä»‹ç»</h2><p><code>postMessage()</code>æ–¹æ³•å…è®¸æ¥è‡ªä¸åŒæºçš„è„šæœ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œæœ‰é™çš„é€šä¿¡ï¼Œå¯ä»¥å®ç°è·¨æ–‡æœ¬æ¡£ã€å¤šçª—å£ã€è·¨åŸŸæ¶ˆæ¯ä¼ é€’ã€‚</p><p><code>postMessage(data,origin)</code>æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°</p><p> 1.data:è¦ä¼ é€’çš„æ•°æ®ï¼Œhtml5è§„èŒƒä¸­æåˆ°è¯¥å‚æ•°å¯ä»¥æ˜¯JavaScriptçš„ä»»æ„åŸºæœ¬ç±»å‹æˆ–å¯å¤åˆ¶çš„å¯¹è±¡ï¼Œç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½åšåˆ°äº†è¿™ç‚¹å„¿ï¼Œéƒ¨åˆ†æµè§ˆå™¨åªèƒ½å¤„ç†å­—ç¬¦ä¸²å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¼ é€’å‚æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨JSON.stringify()æ–¹æ³•å¯¹å¯¹è±¡å‚æ•°åºåˆ—åŒ–ï¼Œåœ¨ä½ç‰ˆæœ¬IEä¸­å¼•ç”¨json2.jså¯ä»¥å®ç°ç±»ä¼¼æ•ˆæœã€‚</p><p>2.originï¼šå­—ç¬¦ä¸²å‚æ•°ï¼ŒæŒ‡æ˜ç›®æ ‡çª—å£çš„æºï¼Œåè®®+ä¸»æœº+ç«¯å£å·[+URL]ï¼ŒURLä¼šè¢«å¿½ç•¥ï¼Œæ‰€ä»¥å¯ä»¥ä¸å†™ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼ŒpostMessage()æ–¹æ³•åªä¼šå°†messageä¼ é€’ç»™æŒ‡å®šçª—å£ï¼Œå½“ç„¶å¦‚æœæ„¿æ„ä¹Ÿå¯ä»¥å»ºå‚æ•°è®¾ç½®ä¸ºâ€*â€ï¼Œè¿™æ ·å¯ä»¥ä¼ é€’ç»™ä»»æ„çª—å£ï¼Œå¦‚æœè¦æŒ‡å®šå’Œå½“å‰çª—å£åŒæºçš„è¯è®¾ç½®ä¸ºâ€/â€œã€‚</p><h2 id="å­é¡µé¢å’Œçˆ¶é¡µé¢äº’ç›¸å‘é€æ¶ˆæ¯"><a href="#å­é¡µé¢å’Œçˆ¶é¡µé¢äº’ç›¸å‘é€æ¶ˆæ¯" class="headerlink" title="å­é¡µé¢å’Œçˆ¶é¡µé¢äº’ç›¸å‘é€æ¶ˆæ¯"></a>å­é¡µé¢å’Œçˆ¶é¡µé¢äº’ç›¸å‘é€æ¶ˆæ¯</h2><p>ä¸ºäº†å…¼å®¹IEå’ŒéIEçš„äº‹ä»¶ç»‘å®šï¼Œä¸‹é¢çš„ä¾‹å­ç›´æ¥ç”¨äº†jQueryç›‘å¬äº‹ä»¶ï¼Œå¦‚æœç”¨åŸç”Ÿjsï¼Œæ³¨æ„<code>function(e)</code>ä¸­çš„<code>e</code>æ²¡æœ‰åŒ…è£…åœ¨<code>e.originalEvent</code>ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè·å–ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨imé¡µé¢ï¼Œç›‘å¬åˆ‡æ¢ç”¨æˆ·äº‹ä»¶ï¼Œç„¶åç»™åˆ«äººå‘é€å¯¹æ–¹çš„ç”¨æˆ·idã€‚</span></span><br><span class="line">$(<span class="string">'#im'</span>).on(<span class="string">'click'</span>,<span class="string">'.person-item'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = &#123;<span class="attr">key</span>:<span class="string">'getUserId'</span>,<span class="attr">val</span>:<span class="string">'18'</span>&#125;;</span><br><span class="line">    <span class="built_in">window</span>.parent.postMessage(<span class="built_in">JSON</span>.stringify(data),<span class="string">'https://coolmogu.com'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//ç›‘å¬æ¥è‡ªçˆ¶é¡µé¢çš„å›æ‰§</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> original = e.originalEvent;</span><br><span class="line">    <span class="keyword">if</span>(original.source != <span class="built_in">window</span>.parent) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'çˆ¶çª—å£è¯´ä»–æ”¶åˆ°äº†'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨çˆ¶é¡µé¢ï¼Œç›‘å¬äº‹ä»¶ï¼Œ</span></span><br><span class="line">$(<span class="built_in">window</span>).on(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> original = e.originalEvent;</span><br><span class="line">    <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(original.data);</span><br><span class="line">    <span class="keyword">if</span>(original.origin != <span class="string">'https://im.com'</span> ||  data.key != <span class="string">'getUserId'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'å½“å‰imå¯¹è¯çš„å¯¹è±¡æ˜¯'</span> + data.val);</span><br><span class="line">    <span class="comment">//çˆ¶é¡µé¢ç»™iframeé¡µé¢å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="built_in">window</span>.frames[<span class="number">0</span>].postMessage(<span class="string">'æˆ‘æ”¶åˆ°äº†'</span>,<span class="string">'http://im.com'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œé¡µé¢åµŒå…¥äº†iframeæ¡†ï¼Œiframeæ¡†é‡Œæ˜¯ä¸€ä¸ªImåœ¨çº¿èŠå¤©å¯¹è¯æ¡†ã€‚åœ¨ç”¨æˆ·åˆ‡æ¢èŠå¤©å¯¹è±¡æ—¶ï¼Œå¤–å±‚é¡µé¢ä¹Ÿéœ€è¦è·å–å½“å‰ç”¨æˆ·æ­£åœ¨èŠå¤©çš„å¯¹æ–¹çš„useridã€‚ä½†æ˜¯ç”±äºimé¡µé¢æ˜¯åµŒå…¥çš„iframeï¼Œå¤–å±‚çˆ¶é¡µé¢æ—¢æ— æ³•ç›‘å¬åˆ‡æ¢èŠå¤©å¯¹è±¡çš„äº‹ä»¶ï¼Œä¹Ÿæ— æ³•è·å–é‡Œé¢çš„domå…ƒç´ ï¼Œä¼šæŠ¥è·¨åŸŸçš„é”™è¯¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨html5çš„API&lt;code&gt;postMessage&lt;/code&gt;.&lt;/p&gt;
    
    </summary>
    
    
      <category term="Javascriptå­¦ä¹ ç¬”è®°" scheme="http://blog.chenkeyi.com/tags/Javascript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>å¾®ä¿¡å…¬ä¼—å·çˆ¬è™«</title>
    <link href="http://blog.chenkeyi.com/2017/06/27/wxPachong/"/>
    <id>http://blog.chenkeyi.com/2017/06/27/wxPachong/</id>
    <published>2017-06-27T06:06:50.000Z</published>
    <updated>2017-10-17T20:10:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æäº†ä¸€ä¸ªåŸºäºnodejs+vueçš„å¾®ä¿¡å…¬ä¼—å·æ–‡ç« çˆ¬è™«ï¼Œäº¤äº’ä»€ä¹ˆçš„ä¹ŸåŸºæœ¬æ²¡æœ‰ä¼˜åŒ–ï¼Œå…ˆå ä¸ªå‘ï¼Œä¹‹åæå¥½äº†æ¥å†™å†™æ•™ç¨‹ã€‚<br>åœ°å€ï¼š<a href="http://read.chenkeyi.com" target="_blank" rel="noopener">http://read.chenkeyi.com</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘æäº†ä¸€ä¸ªåŸºäºnodejs+vueçš„å¾®ä¿¡å…¬ä¼—å·æ–‡ç« çˆ¬è™«ï¼Œäº¤äº’ä»€ä¹ˆçš„ä¹ŸåŸºæœ¬æ²¡æœ‰ä¼˜åŒ–ï¼Œå…ˆå ä¸ªå‘ï¼Œä¹‹åæå¥½äº†æ¥å†™å†™æ•™ç¨‹ã€‚&lt;br&gt;åœ°å€ï¼š&lt;a href=&quot;http://read.chenkeyi.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http:/
      
    
    </summary>
    
    
      <category term="node.jså­¦ä¹ ç¬”è®°" scheme="http://blog.chenkeyi.com/tags/node-js%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>å‡½æ•°é˜²æŠ–å’ŒèŠ‚æµ</title>
    <link href="http://blog.chenkeyi.com/2017/04/27/debounce-and-throttle/"/>
    <id>http://blog.chenkeyi.com/2017/04/27/debounce-and-throttle/</id>
    <published>2017-04-27T06:06:50.000Z</published>
    <updated>2017-10-17T20:06:52.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‡½æ•°é˜²æŠ–"><a href="#å‡½æ•°é˜²æŠ–" class="headerlink" title="å‡½æ•°é˜²æŠ–"></a>å‡½æ•°é˜²æŠ–</h3><p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šéœ€è¦æˆ‘ä»¬ç›‘å¬ç”¨æˆ·çš„è¾“å…¥å‘åç«¯å‘é€è¯·æ±‚ï¼Œæ¯”å¦‚æœç´¢æ¨èï¼Œæˆ‘ä»¬ä¼šç›‘å¬inputæ¡†çš„changeäº‹ä»¶ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·æ¯æ¬¡æŒ‰ä¸‹é”®ç›˜éƒ½å‘é€è¯·æ±‚ï¼Œä¼šå‘é€å¾ˆå¤šè¯·æ±‚ã€å¡é¡¿ç­‰ã€‚ä¸ºäº†ä¼˜åŒ–è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°å‡½æ•°é˜²æŠ–ã€‚</p><blockquote><p>å‡½æ•°é˜²æŠ–å°±æ˜¯è®©æŸä¸ªå‡½æ•°åœ¨ä¸Šä¸€æ¬¡æ‰§è¡Œåï¼Œæ»¡è¶³ç­‰å¾…æŸä¸ªæ—¶é—´å†…ä¸å†è§¦å‘æ­¤å‡½æ•°åå†æ‰§è¡Œï¼Œè€Œåœ¨è¿™ä¸ªç­‰å¾…æ—¶é—´å†…å†æ¬¡è§¦å‘æ­¤å‡½æ•°ï¼Œç­‰å¾…æ—¶é—´ä¼šé‡æ–°è®¡ç®—ã€‚</p></blockquote><p>ä½¿ç”¨å‡½æ•°é˜²æŠ–åï¼Œå‡è®¾æˆ‘ä»¬inputæ¡†çš„changeäº‹ä»¶ï¼Œå½“è¾“å…¥å®Œæˆå300msæˆ‘ä»¬æ‰å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œå¦‚æœåœ¨300mså†…ï¼Œç”¨æˆ·åˆå¼€å§‹è¾“å…¥äº†ï¼Œé‚£æˆ‘ä»¬å°±é‡æ–°è®¡æ—¶ç­‰å¾…300msã€‚ç›´åˆ°ç”¨æˆ·åœæ­¢è¾“å…¥ï¼Œ300mså†…éƒ½æ²¡æœ‰å†æ¬¡è¾“å…¥ï¼Œæˆ‘ä»¬å°±å‘å‡ºè¯·æ±‚ã€‚è¿™æ ·å°±å¯ä»¥è®©ç”¨æˆ·çœŸçš„è¾“å…¥å®Œæ¯•åæ‰å¼€å§‹ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯åœ¨æ‰“æ¯ä¸€ä¸ªå­—æ¯çš„æ—¶å€™ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹underscore.jsé‡Œç›¸å…³å‡½æ•°çš„å®šä¹‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns a function, that, as long as it continues to be invoked, will not</span></span><br><span class="line"><span class="comment">// be triggered. The function will be called after it stops being called for</span></span><br><span class="line"><span class="comment">// N milliseconds. If `immediate` is passed, trigger the function on the</span></span><br><span class="line"><span class="comment">// leading edge, instead of the trailing.</span></span><br><span class="line">_.debounce = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, immediate</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> timeout, args, context, timestamp, result;</span><br><span class="line">  <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> last = _.now() - timestamp;</span><br><span class="line">    <span class="keyword">if</span> (last &lt; wait &amp;&amp; last &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      timeout = setTimeout(later, wait - last);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timeout = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (!immediate) &#123;</span><br><span class="line">        result = func.apply(context, args);</span><br><span class="line">        <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    context = <span class="keyword">this</span>;</span><br><span class="line">    args = <span class="built_in">arguments</span>;</span><br><span class="line">    timestamp = _.now();</span><br><span class="line">    <span class="keyword">var</span> callNow = immediate &amp;&amp; !timeout;</span><br><span class="line">    <span class="keyword">if</span> (!timeout) timeout = setTimeout(later, wait);</span><br><span class="line">    <span class="keyword">if</span> (callNow) &#123;</span><br><span class="line">      result = func.apply(context, args);</span><br><span class="line">      context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å‚æ•°functionæ˜¯éœ€è¦è¿›è¡Œå‡½æ•°é˜²æŠ–çš„å‡½æ•°ï¼›å‚æ•°waitåˆ™æ˜¯éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼›immediateå‚æ•°å¦‚æœä¸ºtrueï¼Œåˆ™debounceå‡½æ•°ä¼šåœ¨è°ƒç”¨æ—¶ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡functionï¼Œè€Œä¸éœ€è¦ç­‰åˆ°waitè¿™ä¸ªæ—¶é—´åï¼Œä¾‹å¦‚é˜²æ­¢ç‚¹å‡»æäº¤æŒ‰é’®æ—¶çš„å¤šæ¬¡ç‚¹å‡»å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°ã€‚</p><p>å¯ä»¥ä»ä¸‹é¢æˆ‘å†™çš„ä¾‹å­é‡Œçœ‹åˆ°2è€…çš„åŒºåˆ«ï¼Œæ˜æ˜¾çœ‹å‡ºä½¿ç”¨äº†é˜²æŠ–çš„æ˜æ˜¾é¿å…äº†æ²¡å¿…è¦çš„å¤šæ¬¡è¯·æ±‚ã€‚<br><a class="jsbin-embed" href="http://jsbin.com/fuxowejolo/1/embed?js,output" target="_blank" rel="noopener">JS Bin on jsbin.com</a><script src="http://static.jsbin.com/js/embed.min.js?3.41.6"></script></p><h3 id="å‡½æ•°èŠ‚æµ"><a href="#å‡½æ•°èŠ‚æµ" class="headerlink" title="å‡½æ•°èŠ‚æµ"></a>å‡½æ•°èŠ‚æµ</h3><p>è¿˜æœ‰ä¸€äº›éœ€æ±‚ï¼Œåœ¨æ»šåŠ¨é¡µé¢çš„æ—¶å€™ç›‘å¬æ»šåŠ¨çš„ä½ç½®åšå‡ºç›¸åº”çš„äº¤äº’ï¼Œæ¯”å¦‚æœ¬ç«™æ–‡ç« é¡µå³ä¾§çš„ç›®å½•å¯¼èˆªæ»šåŠ¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç›‘å¬é¡µé¢çš„æ»šåŠ¨äº‹ä»¶ï¼Œåœ¨æ»šåŠ¨äº‹ä»¶ç›‘å¬çš„å›è°ƒé‡Œæ‰§è¡Œä½ çš„æ–¹æ³•ã€‚å¦‚æœç”¨æˆ·æ»šåŠ¨å¾ˆå¿«ï¼Œä¸€ç§’å†…å¯èƒ½æ‰§è¡Œä¸Šç™¾æ¬¡ï¼Œå¯¼è‡´é¡µé¢æ€§èƒ½å˜å¾—å¾ˆæ…¢ã€‚<br>ä½†æ˜¯è¿™æ¬¡çš„æƒ…å†µè·Ÿä¸Šé¢çš„æœ‰æ‰€ä¸åŒï¼Œæˆ‘ä»¬ä¸æ˜¯è¦åœ¨æ¯å®Œæˆç­‰å¾…æŸä¸ªæ—¶é—´åå»æ‰§è¡ŒæŸå‡½æ•°ï¼Œè€Œæ˜¯è¦æ¯é—´éš”æŸä¸ªæ—¶é—´å»æ‰§è¡ŒæŸå‡½æ•°ï¼Œé¿å…å‡½æ•°çš„è¿‡å¤šæ‰§è¡Œï¼Œè¿™ä¸ªæ–¹å¼å°±å«å‡½æ•°èŠ‚æµã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€ä¸‹underscore.jsé‡Œç›¸å…³å‡½æ•°çš„å®šä¹‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns a function, that, when invoked, will only be triggered at most once</span></span><br><span class="line"><span class="comment">// during a given window of time. Normally, the throttled function will run</span></span><br><span class="line"><span class="comment">// as much as it can, without ever going more than once per `wait` duration;</span></span><br><span class="line"><span class="comment">// but if you'd like to disable the execution on the leading edge, pass</span></span><br><span class="line"><span class="comment">// `&#123;leading: false&#125;`. To disable execution on the trailing edge, ditto.</span></span><br><span class="line"></span><br><span class="line">_.throttle = <span class="function"><span class="keyword">function</span>(<span class="params">func, wait, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context, args, result;</span><br><span class="line">  <span class="keyword">var</span> timeout = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> previous = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (!options) options = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> later = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    previous = options.leading === <span class="literal">false</span> ? <span class="number">0</span> : _.now();</span><br><span class="line">    timeout = <span class="literal">null</span>;</span><br><span class="line">    result = func.apply(context, args);</span><br><span class="line">    <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> now = _.now();</span><br><span class="line">    <span class="keyword">if</span> (!previous &amp;&amp; options.leading === <span class="literal">false</span>) previous = now;</span><br><span class="line">    <span class="keyword">var</span> remaining = wait - (now - previous);</span><br><span class="line">    context = <span class="keyword">this</span>;</span><br><span class="line">    args = <span class="built_in">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (remaining &lt;= <span class="number">0</span> || remaining &gt; wait) &#123;</span><br><span class="line">      <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">        clearTimeout(timeout);</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      previous = now;</span><br><span class="line">      result = func.apply(context, args);</span><br><span class="line">      <span class="keyword">if</span> (!timeout) context = args = <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!timeout &amp;&amp; options.trailing !== <span class="literal">false</span>) &#123;</span><br><span class="line">      timeout = setTimeout(later, remaining);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å‚æ•°functionæ˜¯éœ€è¦è¿›è¡Œå‡½æ•°èŠ‚æµçš„å‡½æ•°ï¼›å‚æ•°waitåˆ™æ˜¯å‡½æ•°æ‰§è¡Œçš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚optionæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œthrottleç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶é»˜è®¤ä¼šç«‹åˆ»æ‰§è¡Œä¸€æ¬¡functionï¼Œå¦‚æœä¼ å…¥{leading: false}ï¼Œåˆ™ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ä¸æ‰§è¡Œfunctionã€‚{trailing: false}å‚æ•°åˆ™è¡¨ç¤ºç¦æ­¢æœ€åé‚£ä¸€æ¬¡å»¶è¿Ÿçš„è°ƒç”¨ã€‚<br>è¿›è¡Œæ»šåŠ¨2ä¸ªDIVå†…éƒ¨ï¼Œå¯ä»¥çœ‹åˆ°å‡½æ•°èŠ‚æµçš„æ•ˆæœï¼Œæ˜æ˜¾çœ‹å‡ºï¼Œå¿«é€Ÿæ»šåŠ¨ï¼Œå‡½æ•°èŠ‚æµçš„æƒ…å†µä¸‹å‡å°‘äº†å¤šæ¬¡å›è°ƒçš„è°ƒç”¨ã€‚<br><a class="jsbin-embed" href="http://jsbin.com/havuximowu/1/embed?js,output" target="_blank" rel="noopener">JS Bin on jsbin.com</a><script src="http://static.jsbin.com/js/embed.min.js?3.41.6"></script></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å‡½æ•°é˜²æŠ–&quot;&gt;&lt;a href=&quot;#å‡½æ•°é˜²æŠ–&quot; class=&quot;headerlink&quot; title=&quot;å‡½æ•°é˜²æŠ–&quot;&gt;&lt;/a&gt;å‡½æ•°é˜²æŠ–&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šéœ€è¦æˆ‘ä»¬ç›‘å¬ç”¨æˆ·çš„è¾“å…¥å‘åç«¯å‘é€è¯·æ±‚ï¼Œæ¯”å¦‚æœç´¢æ¨èï¼Œæˆ‘ä»¬ä¼šç›‘å¬inputæ¡†çš„changeäº‹ä»¶ï¼Œä½†æ˜¯
      
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠECMAScript 6 å…¥é—¨ã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="http://blog.chenkeyi.com/2017/03/27/reading-notes-Of-ECMAScript6/"/>
    <id>http://blog.chenkeyi.com/2017/03/27/reading-notes-Of-ECMAScript6/</id>
    <published>2017-03-27T06:06:50.000Z</published>
    <updated>2017-10-17T20:08:43.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="letä¸const"><a href="#letä¸const" class="headerlink" title="letä¸const"></a>letä¸const</h3><h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><ul><li>å—çº§ä½œç”¨åŸŸ</li><li>ä¸å­˜åœ¨å˜é‡æå‡</li><li>æš‚æ—¶æ€§æ­»åŒº</li><li>ä¸å…è®¸é‡å¤å£°æ˜</li></ul><h4 id="const"><a href="#const" class="headerlink" title="const"></a>const</h4><ul><li>constå£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ã€‚ä¸€æ—¦å£°æ˜ï¼Œå¸¸é‡çš„å€¼å°±ä¸èƒ½æ”¹å˜ã€‚</li><li>constä¸€æ—¦å£°æ˜å˜é‡ï¼Œå°±å¿…é¡»ç«‹å³åˆå§‹åŒ–ï¼Œä¸èƒ½ç•™åˆ°ä»¥åèµ‹å€¼ã€‚</li><li>æš‚æ—¶æ€§æ­»åŒº</li><li>ä¸å…è®¸é‡å¤å£°æ˜</li><li>å°†ä¸€ä¸ªå¯¹è±¡å£°æ˜ä¸ºå¸¸é‡å¿…é¡»éå¸¸å°å¿ƒï¼Œåªæ˜¯ä¿æŒäº†æŒ‡å‘çš„åœ°å€ä¸å˜ï¼Œä¸ä¿è¯æŒ‡å‘çš„æ•°æ®ä¸å˜ã€‚</li></ul><h3 id="å˜é‡çš„è§£æ„èµ‹å€¼"><a href="#å˜é‡çš„è§£æ„èµ‹å€¼" class="headerlink" title="å˜é‡çš„è§£æ„èµ‹å€¼"></a>å˜é‡çš„è§£æ„èµ‹å€¼</h3><p><strong>ç”¨å¤„</strong>:</p><ol><li>å¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†ç°æœ‰å¯¹è±¡çš„æ–¹æ³•ï¼Œèµ‹å€¼åˆ°æŸä¸ªå˜é‡ã€‚<br><code>let { log, sin, cos } = Math;</code></li><li>äº¤æ¢å˜é‡çš„å€¼ã€‚<code>[x,y] = [y,x]</code></li><li>ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼ã€‚å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚æœè¦è¿”å›å¤šä¸ªå€¼ï¼Œåªèƒ½å°†å®ƒä»¬æ”¾åœ¨æ•°ç»„æˆ–å¯¹è±¡é‡Œè¿”å›ã€‚æœ‰äº†è§£æ„èµ‹å€¼ï¼Œå–å‡ºè¿™äº›å€¼å°±éå¸¸æ–¹ä¾¿ã€‚</li><li><p>å‡½æ•°å‚æ•°çš„å®šä¹‰ï¼Œè§£æ„èµ‹å€¼å¯ä»¥æ–¹ä¾¿åœ°å°†ä¸€ç»„å‚æ•°ä¸å˜é‡åå¯¹åº”èµ·æ¥ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°æ˜¯ä¸€ç»„æœ‰æ¬¡åºçš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">[x, y, z]</span>) </span>&#123; ... &#125;</span><br><span class="line">f([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">// å‚æ•°æ˜¯ä¸€ç»„æ— æ¬¡åºçš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">&#123;x, y, z&#125;</span>) </span>&#123; ... &#125;</span><br><span class="line">f(&#123;<span class="attr">z</span>: <span class="number">3</span>, <span class="attr">y</span>: <span class="number">2</span>, <span class="attr">x</span>: <span class="number">1</span>&#125;);</span><br></pre></td></tr></table></figure></li><li><p>æå–JSONæ•°æ®ã€‚è§£æ„èµ‹å€¼å¯¹æå–JSONå¯¹è±¡ä¸­çš„æ•°æ®ï¼Œå°¤å…¶æœ‰ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonData = &#123;</span><br><span class="line">    id: <span class="number">42</span>,</span><br><span class="line">    status: <span class="string">"OK"</span>,</span><br><span class="line">    data: [<span class="number">867</span>, <span class="number">5309</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> &#123; id, status, <span class="attr">data</span>: number &#125; = jsonData;</span><br><span class="line"><span class="built_in">console</span>.log(id, status, number);</span><br><span class="line"><span class="comment">// 42, "OK", [867, 5309]</span></span><br></pre></td></tr></table></figure></li><li><p>è¾“å…¥æ¨¡å—çš„æŒ‡å®šæ–¹æ³•,åŠ è½½æ¨¡å—æ—¶ï¼Œå¾€å¾€éœ€è¦æŒ‡å®šè¾“å…¥é‚£äº›æ–¹æ³•ã€‚è§£æ„èµ‹å€¼ä½¿å¾—è¾“å…¥è¯­å¥éå¸¸æ¸…æ™°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; SourceMapConsumer, SourceNode &#125; = <span class="built_in">require</span>(<span class="string">"source-map"</span>);</span><br></pre></td></tr></table></figure></li></ol><h3 id="å­—ç¬¦ä¸²æ‰©å±•"><a href="#å­—ç¬¦ä¸²æ‰©å±•" class="headerlink" title="å­—ç¬¦ä¸²æ‰©å±•"></a>å­—ç¬¦ä¸²æ‰©å±•</h3><p>ä¼ ç»Ÿä¸Šï¼ŒJavaScriptåªæœ‰indexOfæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥ç¡®å®šä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚ES6åˆæä¾›äº†ä¸‰ç§æ–°æ–¹æ³•ã€‚</p><ul><li>includes()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°äº†å‚æ•°å­—ç¬¦ä¸²ã€‚</li><li>startsWith()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨æºå­—ç¬¦ä¸²çš„å¤´éƒ¨ã€‚</li><li>endsWith()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨æºå­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚</li></ul><p>è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå¼€å§‹æœç´¢çš„ä½ç½®ã€‚<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var s = <span class="string">'Hello world!'</span>;</span><br><span class="line">s.<span class="keyword">startsWith</span>(<span class="string">'world'</span>, <span class="number">6</span>) <span class="comment">// true</span></span><br><span class="line">s.<span class="keyword">endsWith</span>(<span class="string">'Hello'</span>, <span class="number">5</span>) <span class="comment">// true</span></span><br><span class="line">s.includes(<span class="string">'Hello'</span>, <span class="number">6</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°næ—¶ï¼ŒendsWithçš„è¡Œä¸ºä¸å…¶ä»–ä¸¤ä¸ªæ–¹æ³•æœ‰æ‰€ä¸åŒã€‚å®ƒé’ˆå¯¹å‰nä¸ªå­—ç¬¦ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªæ–¹æ³•é’ˆå¯¹ä»ç¬¬nä¸ªä½ç½®ç›´åˆ°å­—ç¬¦ä¸²ç»“æŸã€‚</p><h3 id="æ•°å€¼çš„æ‹“å±•"><a href="#æ•°å€¼çš„æ‹“å±•" class="headerlink" title="æ•°å€¼çš„æ‹“å±•"></a>æ•°å€¼çš„æ‹“å±•</h3><p><code>Number.isFinite()</code>ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªæ•°å€¼æ˜¯å¦ä¸ºæœ‰é™çš„ï¼ˆfiniteï¼‰ã€‚<br><code>Number.isNaN()</code>ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºNaNã€‚<br>å®ƒä»¬ä¸ä¼ ç»Ÿçš„å…¨å±€æ–¹æ³•isFinite()å’ŒisNaN()çš„åŒºåˆ«åœ¨äºï¼Œä¼ ç»Ÿæ–¹æ³•å…ˆè°ƒç”¨Number()å°†éæ•°å€¼çš„å€¼è½¬ä¸ºæ•°å€¼ï¼Œå†è¿›è¡Œåˆ¤æ–­ï¼Œè€Œè¿™ä¸¤ä¸ªæ–°æ–¹æ³•åªå¯¹æ•°å€¼æœ‰æ•ˆï¼Œéæ•°å€¼ä¸€å¾‹è¿”å›falseã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">isFinite</span>(<span class="number">25</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isFinite</span>(<span class="string">"25"</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="number">25</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isFinite(<span class="string">"25"</span>) <span class="comment">// false</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">isNaN</span>(<span class="string">"NaN"</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="string">"NaN"</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p><h3 id="æ•°ç»„çš„æ‹“å±•"><a href="#æ•°ç»„çš„æ‹“å±•" class="headerlink" title="æ•°ç»„çš„æ‹“å±•"></a>æ•°ç»„çš„æ‹“å±•</h3><p><code>Array.from</code>æ–¹æ³•ç”¨äºå°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼šç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆarray-like objectï¼‰å’Œå¯éå†ï¼ˆiterableï¼‰çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ES6æ–°å¢çš„æ•°æ®ç»“æ„Setå’ŒMapï¼‰ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayLike = &#123;</span><br><span class="line">    <span class="string">'0'</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="string">'1'</span>: <span class="string">'b'</span>,</span><br><span class="line">    <span class="string">'2'</span>: <span class="string">'c'</span>,</span><br><span class="line">    length: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ES6çš„å†™æ³•</span></span><br><span class="line"><span class="keyword">let</span> arr2 = <span class="built_in">Array</span>.from(arrayLike); <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line"><span class="built_in">Array</span>.from(<span class="string">'hello'</span>);<span class="comment">// ['h', 'e', 'l', 'l', 'o'];</span></span><br><span class="line"><span class="built_in">Array</span>.from(&#123; <span class="attr">length</span>: <span class="number">3</span> &#125;);<span class="comment">// [ undefined, undefined, undefined ]</span></span><br></pre></td></tr></table></figure></p><p>Array.fromè¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œç”¨ç±»ä¼¼äºæ•°ç»„çš„mapæ–¹æ³•ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åçš„å€¼æ”¾å…¥è¿”å›çš„æ•°ç»„ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from(arrayLike, x =&gt; x * x);</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="built_in">Array</span>.from(arrayLike).map(<span class="function"><span class="params">x</span> =&gt;</span> x * x);</span><br><span class="line"><span class="built_in">Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], (x) =&gt; x * x)<span class="comment">// [1, 4, 9]</span></span><br></pre></td></tr></table></figure></p><p><code>Array.of</code>æ€»æ˜¯è¿”å›å‚æ•°å€¼ç»„æˆçš„æ•°ç»„ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚<code>Array.of</code>åŸºæœ¬ä¸Šå¯ä»¥ç”¨æ¥æ›¿ä»£Array()æˆ–new Array()ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ç”±äºå‚æ•°ä¸åŒè€Œå¯¼è‡´çš„é‡è½½ã€‚å®ƒçš„è¡Œä¸ºéå¸¸ç»Ÿä¸€ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.of() <span class="comment">// []</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="literal">undefined</span>) <span class="comment">// [undefined]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>) <span class="comment">// [1]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure></p><h3 id="å¯¹è±¡çš„æ‹“å±•"><a href="#å¯¹è±¡çš„æ‹“å±•" class="headerlink" title="å¯¹è±¡çš„æ‹“å±•"></a>å¯¹è±¡çš„æ‹“å±•</h3><p><strong>å±æ€§çš„ç®€æ´è¡¨ç¤ºæ³•</strong><br>ES6å…è®¸ç›´æ¥å†™å…¥å˜é‡å’Œå‡½æ•°ï¼Œä½œä¸ºå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚è¿™æ ·çš„ä¹¦å†™æ›´åŠ ç®€æ´ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="string">'bar'</span>;</span><br><span class="line"><span class="keyword">var</span> baz = &#123;foo&#125;;</span><br><span class="line">baz <span class="comment">// &#123;foo: "bar"&#125;</span></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="keyword">var</span> baz = &#123;<span class="attr">foo</span>: foo&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;x, y&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;<span class="attr">x</span>: x, <span class="attr">y</span>: y&#125;;</span><br><span class="line">&#125;</span><br><span class="line">f(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// Object &#123;x: 1, y: 2&#125;</span></span><br></pre></td></tr></table></figure></p><p><strong>Object.keys()</strong><br>ES5 å¼•å…¥äº†Object.keysæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®åã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">baz</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.keys(obj);<span class="comment">// ["foo", "baz"]</span></span><br></pre></td></tr></table></figure></p><p><strong>Object.values()</strong><br>Object.valuesæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å€¼ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">baz</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.values(obj)<span class="comment">// ["bar", 42]</span></span><br></pre></td></tr></table></figure></p><p><strong>Object.entries</strong><br><code>Object.entries</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å‚æ•°å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å€¼å¯¹æ•°ç»„ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">baz</span>: <span class="number">42</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.entries(obj)<span class="comment">// [ ["foo", "bar"], ["baz", 42] ]</span></span><br></pre></td></tr></table></figure></p><h3 id="symbol"><a href="#symbol" class="headerlink" title="symbol"></a>symbol</h3><p>ES6å¼•å…¥äº†ä¸€ç§æ–°çš„åŸå§‹æ•°æ®ç±»å‹Symbolï¼Œ<strong>è¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼</strong>ã€‚å®ƒæ˜¯JavaScriptè¯­è¨€çš„ç¬¬ä¸ƒç§æ•°æ®ç±»å‹ï¼Œå‰å…­ç§æ˜¯ï¼šUndefinedã€Nullã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€å­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€æ•°å€¼ï¼ˆNumberï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ã€‚<br><a href="http://es6.ruanyifeng.com/#docs/symbol" target="_blank" rel="noopener">è¯¦è§æ–‡æ¡£</a></p><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>ES6æä¾›äº†æ–°çš„æ•°æ®ç»“æ„Setã€‚å®ƒç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚<br>Setæœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”ŸæˆSetæ•°æ®ç»“æ„ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>].map(<span class="function"><span class="params">x</span> =&gt;</span> s.add(x));</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> s) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);<span class="comment">// 2 3 5 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥setå¯ç”¨æ¥å»é™¤æ•°ç»„é‡å¤æˆå‘˜<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»é™¤æ•°ç»„çš„é‡å¤æˆå‘˜</span></span><br><span class="line">[...new <span class="built_in">Set</span>(array)]</span><br><span class="line">[...new <span class="built_in">Set</span>([<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>])] <span class="comment">//2,3</span></span><br></pre></td></tr></table></figure></p><p>Setç»“æ„çš„å®ä¾‹æœ‰ä»¥ä¸‹å±æ€§ã€‚</p><ul><li><code>Set.prototype.constructor</code>ï¼šæ„é€ å‡½æ•°ï¼Œé»˜è®¤å°±æ˜¯Setå‡½æ•°ã€‚</li><li><code>Set.prototype.size</code>ï¼šè¿”å›Setå®ä¾‹çš„æˆå‘˜æ€»æ•°ã€‚</li></ul><p>Setå®ä¾‹çš„æ–¹æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ“ä½œæ–¹æ³•ï¼ˆç”¨äºæ“ä½œæ•°æ®ï¼‰å’Œéå†æ–¹æ³•ï¼ˆç”¨äºéå†æˆå‘˜ï¼‰ã€‚ä¸‹é¢å…ˆä»‹ç»å››ä¸ªæ“ä½œæ–¹æ³•ã€‚</p><ul><li><code>add(value)</code>ï¼šæ·»åŠ æŸä¸ªå€¼ï¼Œè¿”å›Setç»“æ„æœ¬èº«ã€‚</li><li><code>delete(value)</code>ï¼šåˆ é™¤æŸä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ é™¤æ˜¯å¦æˆåŠŸã€‚</li><li><code>has(value)</code>ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥å€¼æ˜¯å¦ä¸ºSetçš„æˆå‘˜ã€‚</li><li><code>clear()</code>ï¼šæ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</li></ul><p>éå†æ–¹æ³•ï¼š</p><ul><li><code>keys()</code>ï¼šè¿”å›é”®åçš„éå†å™¨</li><li><code>values()</code>ï¼šè¿”å›é”®å€¼çš„éå†å™¨</li><li><code>entries()</code>ï¼šè¿”å›é”®å€¼å¯¹çš„éå†å™¨</li><li><code>forEach()</code>ï¼šä½¿ç”¨å›è°ƒå‡½æ•°éå†æ¯ä¸ªæˆå‘˜</li></ul><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>JavaScriptçš„å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œæœ¬è´¨ä¸Šæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼ˆHashç»“æ„ï¼‰ï¼Œä½†æ˜¯ä¼ ç»Ÿä¸Šåªèƒ½ç”¨å­—ç¬¦ä¸²å½“ä½œé”®ã€‚è¿™ç»™å®ƒçš„ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„é™åˆ¶ã€‚Mapç»“æ„æä¾›äº†â€œå€¼â€”å€¼â€çš„å¯¹åº”ï¼Œæ˜¯ä¸€ç§æ›´å®Œå–„çš„Hashç»“æ„å®ç°ã€‚å¦‚æœä½ éœ€è¦â€œé”®å€¼å¯¹â€çš„æ•°æ®ç»“æ„ï¼ŒMapæ¯”Objectæ›´åˆé€‚ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">'name'</span>, <span class="string">'å¼ ä¸‰'</span>],</span><br><span class="line">  [<span class="string">'title'</span>, <span class="string">'Author'</span>]</span><br><span class="line">]);</span><br><span class="line">map.size <span class="comment">// 2</span></span><br><span class="line">map.has(<span class="string">'name'</span>) <span class="comment">// true</span></span><br><span class="line">map.get(<span class="string">'name'</span>) <span class="comment">// "å¼ ä¸‰"</span></span><br><span class="line">map.has(<span class="string">'title'</span>) <span class="comment">// true</span></span><br><span class="line">map.get(<span class="string">'title'</span>) <span class="comment">// "Author"</span></span><br></pre></td></tr></table></figure><p>å®ä¾‹çš„å±æ€§å’Œæ“ä½œæ–¹æ³•:</p><ul><li><code>size</code>å±æ€§è¿”å›Mapç»“æ„çš„æˆå‘˜æ€»æ•°ã€‚</li><li><code>set(key, value)</code>æ–¹æ³•è®¾ç½®keyæ‰€å¯¹åº”çš„é”®å€¼ï¼Œç„¶åè¿”å›æ•´ä¸ªMapç»“æ„ã€‚å¦‚æœkeyå·²ç»æœ‰å€¼ï¼Œåˆ™é”®å€¼ä¼šè¢«æ›´æ–°ï¼Œå¦åˆ™å°±æ–°ç”Ÿæˆè¯¥é”®ã€‚setæ–¹æ³•è¿”å›çš„æ˜¯Mapæœ¬èº«ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ã€‚</li><li><code>get(key)</code>æ–¹æ³•è¯»å–keyå¯¹åº”çš„é”®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°keyï¼Œè¿”å›undefinedã€‚</li><li><code>has(key)</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªé”®æ˜¯å¦åœ¨Mapæ•°æ®ç»“æ„ä¸­ã€‚</li><li><code>delete(key)</code>æ–¹æ³•åˆ é™¤æŸä¸ªé”®ï¼Œè¿”å›trueã€‚å¦‚æœåˆ é™¤å¤±è´¥ï¼Œè¿”å›falseã€‚</li><li><code>clear()</code>æ–¹æ³•æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</li></ul><p>éå†æ–¹æ³•</p><ul><li><code>keys()</code>ï¼šè¿”å›é”®åçš„éå†å™¨ã€‚</li><li><code>values()</code>ï¼šè¿”å›é”®å€¼çš„éå†å™¨ã€‚</li><li><code>entries()</code>ï¼šè¿”å›æ‰€æœ‰æˆå‘˜çš„éå†å™¨ã€‚</li><li><code>forEach()</code>ï¼šéå†Mapçš„æ‰€æœ‰æˆå‘˜ã€‚</li></ul><h3 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h3><p><a href="http://es6.ruanyifeng.com/#docs/proxy" target="_blank" rel="noopener">proxy</a>ï¼Œæ–‡æ¡£å†æ­¤ï¼Œåç»­æ€»ç»“</p><h3 id="reflect"><a href="#reflect" class="headerlink" title="reflect"></a>reflect</h3><p><a href="http://es6.ruanyifeng.com/#docs/reflect" target="_blank" rel="noopener">reflect</a>ï¼Œæ–‡æ¡£å†æ­¤ï¼Œåç»­æ€»ç»“</p><h3 id="Iteratorå’Œforâ€¦ofå¾ªç¯"><a href="#Iteratorå’Œforâ€¦ofå¾ªç¯" class="headerlink" title="Iteratorå’Œforâ€¦ofå¾ªç¯"></a>Iteratorå’Œforâ€¦ofå¾ªç¯</h3><p>éå†å™¨ï¼ˆIteratorï¼‰å°±æ˜¯è¿™æ ·ä¸€ç§æœºåˆ¶ã€‚å®ƒæ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½²Iteratoræ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚<br>Iteratorçš„éå†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéå†å™¨å¯¹è±¡æœ¬è´¨ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ã€‚</li><li>ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„<code>next</code>æ–¹æ³•ï¼Œå¯ä»¥å°†æŒ‡é’ˆæŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚</li><li>ç¬¬äºŒæ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„<code>next</code>æ–¹æ³•ï¼ŒæŒ‡é’ˆå°±æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬äºŒä¸ªæˆå‘˜ã€‚</li><li>ä¸æ–­è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„<code>next</code>æ–¹æ³•ï¼Œç›´åˆ°å®ƒæŒ‡å‘æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®ã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿnextæ–¹æ³•è¿”å›å€¼çš„ä¾‹å­ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> it = makeIterator([<span class="string">'a'</span>, <span class="string">'b'</span>]);</span><br><span class="line">it.next() <span class="comment">// &#123; value: "a", done: false &#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: "b", done: false &#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeIterator</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nextIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> nextIndex &lt; array.length ?</span><br><span class="line">        &#123;<span class="attr">value</span>: array[nextIndex++], <span class="attr">done</span>: <span class="literal">false</span>&#125; :</span><br><span class="line">        &#123;<span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¯ä¸€æ¬¡è°ƒç”¨<code>next</code>æ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›æ•°æ®ç»“æ„çš„å½“å‰æˆå‘˜çš„ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯è¿”å›ä¸€ä¸ªåŒ…å«valueå’Œdoneä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚å…¶ä¸­ï¼Œvalueå±æ€§æ˜¯å½“å‰æˆå‘˜çš„å€¼ï¼Œdoneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸã€‚</p><p>å‡¡æ˜¯éƒ¨ç½²äº†<code>Symbol.iterator</code>å±æ€§çš„æ•°æ®ç»“æ„ï¼Œå°±ç§°ä¸ºéƒ¨ç½²äº†éå†å™¨æ¥å£ã€‚è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚<br>å½“ä½¿ç”¨<code>for...of</code>å¾ªç¯éå†æŸç§æ•°æ®ç»“æ„æ—¶ï¼Œè¯¥å¾ªç¯ä¼šè‡ªåŠ¨å»å¯»æ‰¾Iteratoræ¥å£ã€‚<br>åœ¨ES6ä¸­ï¼Œæœ‰ä¸‰ç±»æ•°æ®ç»“æ„åŸç”Ÿå…·å¤‡Iteratoræ¥å£ï¼šæ•°ç»„ã€æŸäº›ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€Setå’ŒMapç»“æ„ã€‚<br>æœ‰ä¸€äº›åœºåˆä¼šé»˜è®¤è°ƒç”¨Iteratoræ¥å£ï¼ˆå³Symbol.iteratoræ–¹æ³•ï¼‰ï¼š</p><ol><li><p>è§£æ„èµ‹å€¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>().add(<span class="string">'a'</span>).add(<span class="string">'b'</span>).add(<span class="string">'c'</span>);</span><br><span class="line"><span class="keyword">let</span> [x,y] = set;<span class="comment">// x='a'; y='b'</span></span><br><span class="line"><span class="keyword">let</span> [first, ...rest] = set;<span class="comment">// first='a'; rest=['b','c'];</span></span><br></pre></td></tr></table></figure></li><li><p>æ‰©å±•è¿ç®—ç¬¦</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾‹ä¸€</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">'hello'</span>;</span><br><span class="line">[...str] <span class="comment">//  ['h','e','l','l','o']</span></span><br><span class="line"><span class="comment">// ä¾‹äºŒ</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line">[<span class="string">'a'</span>, ...arr, <span class="string">'d'</span>]</span><br></pre></td></tr></table></figure></li><li><p>yield*<br>yield*åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå¯éå†çš„ç»“æ„ï¼Œå®ƒä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> generator = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span>* [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> iterator = generator();</span><br><span class="line">iterator.next() <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line">iterator.next() <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line">iterator.next() <span class="comment">// &#123; value: 3, done: false &#125;</span></span><br><span class="line">iterator.next() <span class="comment">// &#123; value: 4, done: false &#125;</span></span><br><span class="line">iterator.next() <span class="comment">// &#123; value: 5, done: false &#125;</span></span><br><span class="line">iterator.next() <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure></li><li><p>å…¶ä»–åœºåˆ<br>ç”±äºæ•°ç»„çš„éå†ä¼šè°ƒç”¨éå†å™¨æ¥å£ï¼Œæ‰€ä»¥ä»»ä½•æ¥å—æ•°ç»„ä½œä¸ºå‚æ•°çš„åœºåˆï¼Œå…¶å®éƒ½è°ƒç”¨äº†éå†å™¨æ¥å£ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ã€‚</p></li></ol><ul><li><code>for...of</code></li><li><code>Array.from()</code></li><li><code>Map()</code>, <code>Set()</code>, <code>WeakMap()</code>, <code>WeakSet()</code>ï¼ˆæ¯”å¦‚new Map([[â€˜aâ€™,1],[â€˜bâ€™,2]])ï¼‰</li><li><code>Promise.all()</code></li><li><code>Promise.race()</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> a <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// 0 1 2 3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> a <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// a b c d</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç è¡¨æ˜ï¼Œ<code>for...in</code>å¾ªç¯è¯»å–é”®åï¼Œ<code>for...of</code>å¾ªç¯è¯»å–é”®å€¼ã€‚å¦‚æœè¦é€šè¿‡<code>for...of</code>å¾ªç¯ï¼Œè·å–æ•°ç»„çš„ç´¢å¼•ï¼Œå¯ä»¥å€ŸåŠ©æ•°ç»„å®ä¾‹çš„entriesæ–¹æ³•å’Œkeysæ–¹æ³•ï¼Œå‚è§ã€Šæ•°ç»„çš„æ‰©å±•ã€‹ç« èŠ‚ã€‚<br><code>for...of</code>å¾ªç¯è°ƒç”¨éå†å™¨æ¥å£ï¼Œæ•°ç»„çš„éå†å™¨æ¥å£åªè¿”å›å…·æœ‰æ•°å­—ç´¢å¼•çš„å±æ€§ã€‚è¿™ä¸€ç‚¹è·Ÿ<code>for...in</code>å¾ªç¯ä¹Ÿä¸ä¸€æ ·ã€‚</p><h3 id="Generator-å‡½æ•°"><a href="#Generator-å‡½æ•°" class="headerlink" title="Generator å‡½æ•°"></a>Generator å‡½æ•°</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>Generatorå‡½æ•°æ˜¯ES6æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚æœ¬ç« è¯¦ç»†ä»‹ç»Generatorå‡½æ•°çš„è¯­æ³•å’ŒAPIï¼Œå®ƒçš„å¼‚æ­¥ç¼–ç¨‹åº”ç”¨è¯·çœ‹ã€Šå¼‚æ­¥æ“ä½œã€‹ä¸€ç« ã€‚è¯­æ³•ä¸Šï¼Œé¦–å…ˆå¯ä»¥æŠŠå®ƒç†è§£æˆï¼ŒGeneratorå‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚æ‰§è¡ŒGeneratorå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGeneratorå‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ã€‚è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†Generatorå‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚å½¢å¼ä¸Šï¼ŒGeneratorå‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾ã€‚ä¸€æ˜¯ï¼Œfunctionå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›äºŒæ˜¯ï¼Œå‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨yieldè¯­å¥ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ï¼ˆyieldè¯­å¥åœ¨è‹±è¯­é‡Œçš„æ„æ€å°±æ˜¯â€œäº§å‡ºâ€ï¼‰ã€‚</p><p>Generatorå‡½æ•°çš„è°ƒç”¨æ–¹æ³•ä¸æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨å‡½æ•°ååé¢åŠ ä¸Šä¸€å¯¹åœ†æ‹¬å·ã€‚ä¸åŒçš„æ˜¯ï¼Œè°ƒç”¨Generatorå‡½æ•°åï¼Œè¯¥å‡½æ•°å¹¶ä¸æ‰§è¡Œï¼Œè¿”å›çš„ä¹Ÿä¸æ˜¯å‡½æ•°è¿è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€ç« ä»‹ç»çš„éå†å™¨å¯¹è±¡ï¼ˆIterator Objectï¼‰ã€‚<br>ä¸‹ä¸€æ­¥ï¼Œå¿…é¡»è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œä½¿å¾—æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œå†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªyieldè¯­å¥ï¼ˆæˆ–returnè¯­å¥ï¼‰ä¸ºæ­¢ã€‚æ¢è¨€ä¹‹ï¼ŒGeneratorå‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„ï¼Œyieldè¯­å¥æ˜¯æš‚åœæ‰§è¡Œçš„æ ‡è®°ï¼Œè€Œnextæ–¹æ³•å¯ä»¥æ¢å¤æ‰§è¡Œã€‚</p><h4 id="yieldè¯­å¥"><a href="#yieldè¯­å¥" class="headerlink" title="yieldè¯­å¥"></a>yieldè¯­å¥</h4><p>ç”±äºGeneratorå‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œåªæœ‰è°ƒç”¨nextæ–¹æ³•æ‰ä¼šéå†ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥å…¶å®æä¾›äº†ä¸€ç§å¯ä»¥æš‚åœæ‰§è¡Œçš„å‡½æ•°ã€‚yieldè¯­å¥å°±æ˜¯æš‚åœæ ‡å¿—ã€‚<br><code>yield</code>è¯­å¥åé¢çš„è¡¨è¾¾å¼ï¼Œåªæœ‰å½“è°ƒç”¨nextæ–¹æ³•ã€å†…éƒ¨æŒ‡é’ˆæŒ‡å‘è¯¥è¯­å¥æ—¶æ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤ç­‰äºä¸ºJavaScriptæä¾›äº†æ‰‹åŠ¨çš„â€œæƒ°æ€§æ±‚å€¼â€ï¼ˆLazy Evaluationï¼‰çš„è¯­æ³•åŠŸèƒ½ã€‚<br>yieldè¯­å¥ä¸returnè¯­å¥æ—¢æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä¹Ÿæœ‰åŒºåˆ«ã€‚ç›¸ä¼¼ä¹‹å¤„åœ¨äºï¼Œéƒ½èƒ½è¿”å›ç´§è·Ÿåœ¨è¯­å¥åé¢çš„é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚åŒºåˆ«åœ¨äºæ¯æ¬¡é‡åˆ°yieldï¼Œå‡½æ•°æš‚åœæ‰§è¡Œï¼Œä¸‹ä¸€æ¬¡å†ä»è¯¥ä½ç½®ç»§ç»­å‘åæ‰§è¡Œï¼Œè€Œreturnè¯­å¥ä¸å…·å¤‡ä½ç½®è®°å¿†çš„åŠŸèƒ½ã€‚ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œåªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼ˆæˆ–è€…è¯´ä¸€ä¸ªï¼‰returnè¯­å¥ï¼Œä½†æ˜¯å¯ä»¥æ‰§è¡Œå¤šæ¬¡ï¼ˆæˆ–è€…è¯´å¤šä¸ªï¼‰yieldè¯­å¥ã€‚</p><p><code>for...of</code>å¾ªç¯å¯ä»¥è‡ªåŠ¨éå†Generatorå‡½æ•°æ—¶ç”Ÿæˆçš„Iteratorå¯¹è±¡ï¼Œä¸”æ­¤æ—¶ä¸å†éœ€è¦è°ƒç”¨nextæ–¹æ³•ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> foo()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1 2 3 4 5</span></span><br></pre></td></tr></table></figure></p><p>â€¦å¾…è¡¥å……</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;letä¸const&quot;&gt;&lt;a href=&quot;#letä¸const&quot; class=&quot;headerlink&quot; title=&quot;letä¸const&quot;&gt;&lt;/a&gt;letä¸const&lt;/h3&gt;&lt;h4 id=&quot;let&quot;&gt;&lt;a href=&quot;#let&quot; class=&quot;headerlink
      
    
    </summary>
    
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="http://blog.chenkeyi.com/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>å•å…ƒæµ‹è¯• &amp; mochaæ¡†æ¶</title>
    <link href="http://blog.chenkeyi.com/2017/01/06/mocha/"/>
    <id>http://blog.chenkeyi.com/2017/01/06/mocha/</id>
    <published>2017-01-06T04:08:00.000Z</published>
    <updated>2017-10-17T20:12:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•"></a>ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•</h2><blockquote><p>å•å…ƒæµ‹è¯•ï¼ˆunit testingï¼‰ï¼Œæ˜¯æŒ‡å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯ã€‚å¯¹äºå•å…ƒæµ‹è¯•ä¸­å•å…ƒçš„å«ä¹‰ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¦æ ¹æ®å®é™…æƒ…å†µå»åˆ¤å®šå…¶å…·ä½“å«ä¹‰ï¼Œå¦‚Cè¯­è¨€ä¸­å•å…ƒæŒ‡ä¸€ä¸ªå‡½æ•°ï¼ŒJavaé‡Œå•å…ƒæŒ‡ä¸€ä¸ªç±»ï¼Œå›¾å½¢åŒ–çš„è½¯ä»¶ä¸­å¯ä»¥æŒ‡ä¸€ä¸ªçª—å£æˆ–ä¸€ä¸ªèœå•ç­‰ã€‚æ€»çš„æ¥è¯´ï¼Œå•å…ƒå°±æ˜¯äººä¸ºè§„å®šçš„æœ€å°çš„è¢«æµ‹åŠŸèƒ½æ¨¡å—ã€‚å•å…ƒæµ‹è¯•æ˜¯åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­è¦è¿›è¡Œçš„æœ€ä½çº§åˆ«çš„æµ‹è¯•æ´»åŠ¨ï¼Œè½¯ä»¶çš„ç‹¬ç«‹å•å…ƒå°†åœ¨ä¸ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ç›¸éš”ç¦»çš„æƒ…å†µä¸‹è¿›è¡Œæµ‹è¯•ã€‚</p></blockquote><p>å•å…ƒæµ‹è¯•åœ¨å‰ç«¯é¢†åŸŸå¹¶ä¸è¢«é‡è§†ï¼Œå‰ç«¯ç¨‹åºå‘˜ä¹Ÿæ²¡æœ‰å†™å•å…ƒæµ‹è¯•çš„ä¹ æƒ¯ã€‚ä½†æ˜¯ï¼Œéšç€å‰ç«¯æŠ€æœ¯çš„å‘å±•ï¼Œéšç€nodeçš„å‘å±•ï¼Œè¶Šæ¥è¶Šå¤šâ€œéUIâ€çš„å‰ç«¯ä»£ç å‡ºç°ï¼Œå‰ç«¯å¼€å‘ä»¬ä¹Ÿéœ€è¦äº†è§£æŒæ¡å•å…ƒæµ‹è¯•çŸ¥è¯†ã€‚<br>å•å…ƒæµ‹è¯•æ˜¯ä¿è¯ä»£ç è´¨é‡çš„é‡è¦ç¯èŠ‚ä¹‹ä¸€ï¼Œç‰¹åˆ«æ˜¯è¿™äº›ä»£ç æ˜¯ä¼šæä¾›ç»™å…¶ä»–äººä½¿ç”¨çš„æ—¶å€™ï¼Œæ¯”å¦‚nodeæ’ä»¶ï¼Œgruntæ’ä»¶ç­‰ç­‰<br>å•å…ƒæµ‹è¯•çš„ä½œç”¨æœ‰è®¸å¤šï¼Œä¸‹é¢åˆ—ä¸¾ä¸€äº›ï¼š</p><ul><li>ä¿è¯ä»£ç å¯ç”¨</li><li>å¦ä¸€ç§çº¬åº¦çš„æ–‡æ¡£</li><li>æ–¹ä¾¿è¿­ä»£å›å½’</li><li>é©±åŠ¨å¼€å‘</li></ul><h3 id="TDDä¸BDD"><a href="#TDDä¸BDD" class="headerlink" title="TDDä¸BDD"></a>TDDä¸BDD</h3><p><strong>TDD</strong>,å…¨ç§°æ˜¯Test Driver Developmentï¼Œæµ‹è¯•é©±åŠ¨å¼€å‘ã€‚å…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆæ²¡æœ‰ä»£ç ä¹‹å‰è¿™äº›æµ‹è¯•ç”¨ä¾‹ä¸€ä¸ªä¹Ÿé€šä¸è¿‡ï¼‰ï¼Œç„¶åå†å†™ä»£ç è®©è¿™äº›æµ‹è¯•ç”¨ä¾‹é€šè¿‡ã€‚æ›´è¿›ä¸€å±‚çš„è®²å°±æ˜¯ï¼šç¼–å†™è¶³å¤Ÿçš„æµ‹è¯•ç”¨ä¾‹ä½¿æµ‹è¯•å¤±è´¥ï¼Œç¼–å†™è¶³å¤Ÿçš„ä»£ç æ˜¯æµ‹è¯•æˆåŠŸã€‚æˆ‘ä»¬ç¼–ç çš„ç›®çš„æ›´åŠ æ˜ç¡®çš„ã€‚<br><strong>TDDçš„ä¼˜ç‚¹</strong>ï¼š</p><ol><li>ç«™åœ¨ç”¨æˆ·çš„è§’åº¦æ€è€ƒï¼Œä»ç”¨æˆ·çš„è§’åº¦å°½å¯èƒ½åœ°æƒ³ä¼šè¿›è¡Œçš„æ“ä½œï¼Œè€Œä¸æ˜¯ä»ä¸€ä¸ªå¼€å‘çš„è§’åº¦ã€‚</li><li>å…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå†è¿›è¡Œå¼€å‘ï¼Œä¸ºå¼€å‘è¿›è¡ŒæŒ‡å¯¼æ€§çš„å‚è€ƒï¼Œé˜²æ­¢é—æ¼æŸäº›åŠŸèƒ½ã€‚</li><li>é¦–å…ˆç”±äº†ä¸€å¥—å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¾¿å¯ä»¥è®©ä»£ç é‡æ„æ›´å®‰å…¨ï¼Œå› ä¸ºé‡æ„åªæ˜¯æ”¹å˜å†…éƒ¨ç»“æ„ï¼Œä¸åº”æ”¹å˜å¤–éƒ¨åŠŸèƒ½ï¼Œè€ŒTDDæ˜¯å…³æ³¨å¤–éƒ¨æ¥å£ï¼Œæ‰€ä»¥åœ¨é‡æ„æ—¶ï¼Œåªè¦ä¿è¯æµ‹è¯•ç”¨ä¾‹é€šè¿‡å³å¯æ”¾å¿ƒæ›´æ”¹å†…éƒ¨ä»£ç ã€‚</li><li>å¦‚æœæ›´æ”¹äº†æŸéƒ¨åˆ†ä»£ç ä½¿æµ‹è¯•ç”¨ä¾‹ä¸é€šè¿‡äº†ï¼Œæˆ‘ä»¬å¯ä»¥é©¬ä¸Šå®šä½åˆ°åˆšæ‰å†™çš„ä»£ç ï¼Œä¿®æ”¹é”™è¯¯ã€‚</li></ol><p>TDDæŠŠå·¥ä½œé‡å‰ç½®ï¼Œå‰æœŸçš„å‡†å¤‡å·¥ä½œé‡è¾ƒå¤§ï¼Œä¸è¿‡åæœŸå°±ä¼šå¾ˆè½»æ¾ã€‚<br>å…³äºTDDçš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://blog.csdn.net/m13666368773/article/details/7006912" target="_blank" rel="noopener">å­¦ä¹ TDDï¼šTDDçš„å¥½å¤„</a></p><p><strong>BDD</strong>,å…¨ç§°æ˜¯Behavior Driven Developmentï¼Œè¡Œä¸ºé©±åŠ¨å¼€å‘ã€‚ç›¸æ¯”äºTDDï¼ŒBDDæ›´åŠ ä¾§é‡è®¾è®¡ï¼Œå…¶è¦æ±‚åœ¨è®¾è®¡æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™å¯¹ç³»ç»Ÿè¿›è¡Œå®šä¹‰ï¼Œå€¡å¯¼ä½¿ç”¨é€šç”¨çš„è¯­è¨€å°†ç³»ç»Ÿçš„è¡Œä¸ºæè¿°å‡ºæ¥ï¼Œå°†ç³»ç»Ÿè®¾è®¡å’Œæµ‹è¯•ç”¨ä¾‹ç»“åˆèµ·æ¥ï¼Œä»è€Œä»¥æ­¤ä¸ºé©±åŠ¨è¿›è¡Œå¼€å‘å·¥ä½œã€‚<br>BDDçš„é€šç”¨è¯­è¨€æ˜¯ä¸€ç§è¿‘ä¹è‡ªç„¶è¯­è¨€çš„æè¿°è½¯ä»¶çš„å½¢å¼ã€‚ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ä¸­ï¼Œå¼€å‘äººå‘˜å¾ˆéš¾ä»ä¸šåŠ¡éœ€æ±‚è€ƒè™‘é—®é¢˜ï¼ŒåŸºäºè¿™ç§é€šç”¨è¯­è¨€å½¢å¼å¯ä»¥å°½å¯èƒ½é¿å…äº†å› ä¸ºç†è§£éœ€æ±‚ä¸å……åˆ†è€Œå¸¦æ¥çš„ä¸å¿…è¦çš„å·¥ä½œé‡ã€‚<br>BDDæè¿°çš„è¡Œä¸ºå°±åƒä¸€ä¸ªä¸ªçš„æ•…äº‹(Story)ï¼Œéœ€æ±‚æ–¹ã€å¼€å‘è€…ã€æµ‹è¯•äººå‘˜ä¸€èµ·åˆä½œï¼Œåˆ†æè½¯ä»¶çš„éœ€æ±‚ï¼Œç„¶åå°†è¿™äº›éœ€æ±‚å†™æˆä¸€ä¸ªä¸ªçš„æ•…äº‹ã€‚å¼€å‘è€…è´Ÿè´£å¡«å……è¿™äº›æ•…äº‹çš„å†…å®¹ï¼Œæµ‹è¯•è€…è´Ÿè´£æ£€éªŒè¿™äº›æ•…äº‹çš„ç»“æœã€‚</p><h2 id="äºŒã€mocha"><a href="#äºŒã€mocha" class="headerlink" title="äºŒã€mocha"></a>äºŒã€mocha</h2><p><a href="https://mochajs.org/" target="_blank" rel="noopener">Mocha</a>æ˜¯å…·æœ‰ä¸°å¯Œç‰¹æ€§çš„ JavaScript æµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥è¿è¡Œåœ¨ Node.js å’Œæµè§ˆå™¨ä¸­ï¼Œä½¿å¾—å¼‚æ­¥æµ‹è¯•æ›´ç®€å•æ›´æœ‰è¶£ã€‚Mocha å¯ä»¥æŒç»­è¿è¡Œæµ‹è¯•ï¼Œæ”¯æŒçµæ´»åˆå‡†ç¡®çš„æŠ¥å‘Šï¼Œå½“æ˜ å°„åˆ°æœªæ•è·å¼‚å¸¸æ—¶è½¬åˆ°æ­£ç¡®çš„æµ‹è¯•ç¤ºä¾‹ã€‚<br>å®ƒæ”¯æŒTDD/BDDç­‰å¤šç§æµè¡Œçš„æ¥å£ï¼Œä¹Ÿæ¥å—å¤šç§Assertionsï¼ˆæ–­è¨€ï¼‰ï¼Œå¦‚should.js/expect/chai/better-assertï¼ˆæ–­è¨€æ¡†æ¶ï¼‰ç­‰ï¼Œé€šè¿‡è¿™äº›å³å¯æ„å»ºå„ç§é£æ ¼çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p><h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1. å®‰è£…"></a>1. å®‰è£…</h3><p>è¦å¼€å§‹æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä¹‹è·¯ï¼Œé¦–å…ˆè¦å®‰è£…mochaã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mocha --save</span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬é€‰æ‹©äº†æ–­è¨€åº“ï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯<a href="http://chaijs.com/" target="_blank" rel="noopener">chai</a>ã€‚chaiæ˜¯ä¸€ä¸ªæ–­è¨€åº“ï¼Œnodeæœ¬èº«ä¹Ÿæœ‰ä¸ªæ–­è¨€æ¨¡å—ï¼Œä½†æ˜¯åŠŸèƒ½æ¯”è¾ƒå¼±ï¼Œè¯­æ³•ä¹Ÿæ¯”è¾ƒè´«ä¹ã€‚<br>chaiæä¾›äº†ä¸‰ç§æ–­è¨€é£æ ¼æ¥åˆ†åˆ«é€‚ç”¨äºBDDå’ŒTDDã€‚<strong>expect/should</strong> API å¯¹åº”BDDé£æ ¼<strong>ï¼Œ</strong>Assert__ API å¯¹åº”TDDé£æ ¼ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install chai --save</span><br></pre></td></tr></table></figure></p><h3 id="2-èµ·æ­¥"><a href="#2-èµ·æ­¥" class="headerlink" title="2. èµ·æ­¥"></a>2. èµ·æ­¥</h3><p>ä¿®æ”¹package.json é…ç½®ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> .....</span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"mocha"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  .....</span><br></pre></td></tr></table></figure></p><p>mochaé»˜è®¤æ‰§è¡Œtestæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸€èˆ¬æµ‹è¯•æ–‡ä»¶éƒ½æ”¾åœ¨/testæ–‡ä»¶å¤¹ä¸‹é¢ã€‚å¹¶ä¸”å‘½åä¸ºxxx.test.js<br>/api/add.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = add;</span><br></pre></td></tr></table></figure></p><p>/api/checkUser.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkUser</span>(<span class="params">userName</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(userName == <span class="string">'cky'</span>)&#123;</span><br><span class="line">                resolve(&#123;<span class="attr">data</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                resolve(&#123;<span class="attr">data</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">300</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = checkUser;</span><br></pre></td></tr></table></figure></p><p>/test/add.test.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mocha  = <span class="built_in">require</span>(<span class="string">'mocha'</span>);</span><br><span class="line"><span class="keyword">var</span> chai   = <span class="built_in">require</span>(<span class="string">"chai"</span>);</span><br><span class="line"><span class="keyword">var</span> expect = chai.expect;</span><br><span class="line"><span class="keyword">var</span> add    = <span class="built_in">require</span>(<span class="string">'../api/add'</span>);</span><br><span class="line">describe(<span class="string">'apiæ–‡ä»¶æµ‹è¯•'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">'add()å‡½æ•°æµ‹è¯•'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'1+2åº”è¯¥ç­‰äº3'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      expect(add(<span class="number">1</span>,<span class="number">2</span>)).to.be.equal(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>/test/userCheck.test.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mocha     = <span class="built_in">require</span>(<span class="string">'mocha'</span>);</span><br><span class="line"><span class="keyword">var</span> chai      = <span class="built_in">require</span>(<span class="string">"chai"</span>);</span><br><span class="line"><span class="keyword">var</span> expect    = chai.expect;</span><br><span class="line"><span class="keyword">var</span> checkUser = <span class="built_in">require</span>(<span class="string">'../api/checkUser'</span>);</span><br><span class="line">describe(<span class="string">'apiæ–‡ä»¶æµ‹è¯•'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">'checkUser()å¼‚æ­¥å‡½æ•°æµ‹è¯•'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'ckyè¿”å›true'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> checkUser(<span class="string">'cky'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</span><br><span class="line">        expect(rs.data).to.be.ok;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    it(<span class="string">'xxxè¿”å›false'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> checkUser(<span class="string">'xxx'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</span><br><span class="line">        expect(rs.data).to.be.not.ok;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â–¶ npm test</span><br><span class="line">&gt; mochatest@<span class="number">0.0</span>.<span class="number">1</span> test /Users/chenkeyi/cky/myDemo/test</span><br><span class="line">&gt; mocha</span><br><span class="line">  apiæ–‡ä»¶æµ‹è¯•</span><br><span class="line">    add()å‡½æ•°æµ‹è¯•</span><br><span class="line">      âœ“ <span class="number">1</span>+<span class="number">1</span>åº”è¯¥ç­‰äº<span class="number">2</span></span><br><span class="line">    checkUser()å¼‚æ­¥å‡½æ•°æµ‹è¯•</span><br><span class="line">      âœ“ ckyè¿”å›true (<span class="number">304</span>ms)</span><br><span class="line">      âœ“ xxxè¿”å›false (<span class="number">303</span>ms)</span><br><span class="line">  <span class="number">3</span> passing (<span class="number">627</span>ms)</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œå°±æ˜¯æµ‹è¯•è„šæœ¬ï¼Œå®ƒå¯ä»¥ç‹¬ç«‹æ‰§è¡Œã€‚æµ‹è¯•è„šæœ¬é‡Œé¢åº”è¯¥åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªdescribeå—ï¼Œæ¯ä¸ªdescribeå—åº”è¯¥åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªitå—ã€‚<br>describeå—ç§°ä¸ºâ€æµ‹è¯•å¥—ä»¶â€ï¼ˆtest suiteï¼‰ï¼Œè¡¨ç¤ºä¸€ç»„ç›¸å…³çš„æµ‹è¯•ã€‚å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•å¥—ä»¶çš„åç§°ï¼ˆâ€apiæ–‡ä»¶æµ‹è¯•â€ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®é™…æ‰§è¡Œçš„å‡½æ•°ã€‚<br>itå—ç§°ä¸ºâ€æµ‹è¯•ç”¨ä¾‹â€ï¼ˆtest caseï¼‰ï¼Œè¡¨ç¤ºä¸€ä¸ªå•ç‹¬çš„æµ‹è¯•ï¼Œæ˜¯æµ‹è¯•çš„æœ€å°å•ä½ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•ç”¨ä¾‹çš„åç§°ï¼ˆâ€1+2åº”è¯¥ç­‰äº3â€ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®é™…æ‰§è¡Œçš„å‡½æ•°ã€‚</p><p>ä»<code>checkUser</code>æ–¹æ³•æµ‹è¯•ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæ˜¯æ”¯æŒpromiseé£æ ¼å†™æ³•çš„ã€‚</p><h3 id="3-æ–­è¨€"><a href="#3-æ–­è¨€" class="headerlink" title="3. æ–­è¨€"></a>3. æ–­è¨€</h3><p>æ‰€è°“â€æ–­è¨€â€ï¼Œå°±æ˜¯åˆ¤æ–­æºç çš„å®é™…æ‰§è¡Œç»“æœä¸é¢„æœŸç»“æœæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆitå—ï¼‰éƒ½åº”è¯¥å«æœ‰ä¸€å¥æˆ–å¤šå¥çš„æ–­è¨€ã€‚å®ƒæ˜¯ç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„å…³é”®ã€‚æ–­è¨€åŠŸèƒ½ç”±æ–­è¨€åº“æ¥å®ç°ï¼ŒMochaæœ¬èº«ä¸å¸¦æ–­è¨€åº“ï¼Œæ‰€ä»¥å¿…é¡»å…ˆå¼•å…¥æ–­è¨€åº“ã€‚</p><p>ä¸Šé¢ä¹Ÿæåˆ°äº†æ–­è¨€åº“chaiï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªAPI expect/should/assertï¼Œ<br>è¯¦ç»†çš„æ–‡æ¡£å¯ä»¥æŸ¥çœ‹<a href="http://chaijs.com/api/" target="_blank" rel="noopener">chai</a>ã€‚</p><p><code>expect(rs.data).to.be.ok;</code>è¿™å¥è¯ï¼Œå°±æ˜¯ä¸€ä¸ªæ–­è¨€ã€‚</p><p>è¦ä½¿ç”¨æ–­è¨€ï¼Œé¦–å…ˆè¦<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chai      = <span class="built_in">require</span>(<span class="string">"chai"</span>);</span><br><span class="line"><span class="keyword">var</span> expect    = chai.expect;</span><br></pre></td></tr></table></figure></p><p>ç¡®è®¤å¼•å…¥æ–­è¨€åº“ï¼Œè¿™é‡Œä»‹ç»æ¯”è¾ƒå¸¸ç”¨çš„expecté£æ ¼apiã€‚<br>æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š<code>expect(4+5).equal(9);</code><br>Chaiæ·»åŠ äº†ä¸‹é¢çš„é“¾å¼getterï¼Œå®ƒä»¬ä¸ä¼šåšä»»ä½•äº‹ï¼Œä½†æ˜¯ä½ å¯ä»¥å°†å®ƒä»¬æ·»åŠ è¿›å…¥æ–­è¨€ä¸­æ˜¯çš„å¥å­å˜å¾—å•°å—¦ä½†æ˜¯å¢åŠ äº†æ˜“è¯»æ€§ã€‚</p><ul><li>to</li><li>be</li><li>been</li><li>is</li><li>that</li><li>and</li><li>have</li><li>with</li><li>at</li><li>of</li><li>same</li><li>a</li><li>an</li></ul><p>é‡å†™ä¸Šé¢çš„æ–¹æ³•ï¼š<br><code>expect(4+5).to.equal(5)</code><br>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨æ–­è¨€ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›¸ç­‰æˆ–ä¸ç›¸ç­‰</span></span><br><span class="line">expect(<span class="number">4</span> + <span class="number">5</span>).to.be.equal(<span class="number">9</span>);</span><br><span class="line">expect(<span class="number">4</span> + <span class="number">5</span>).to.be.not.equal(<span class="number">10</span>);</span><br><span class="line">expect(foo).to.be.deep.equal(&#123; <span class="attr">bar</span>: <span class="string">'baz'</span> &#125;);</span><br><span class="line"><span class="comment">// å¸ƒå°”å€¼ä¸ºtrue</span></span><br><span class="line">expect(<span class="string">'everthing'</span>).to.be.ok;</span><br><span class="line">expect(<span class="literal">false</span>).to.not.be.ok;</span><br><span class="line"><span class="comment">// typeof</span></span><br><span class="line">expect(<span class="string">'test'</span>).to.be.a(<span class="string">'string'</span>);</span><br><span class="line">expect(&#123; <span class="attr">foo</span>: <span class="string">'bar'</span> &#125;).to.be.an(<span class="string">'object'</span>);</span><br><span class="line">expect(foo).to.be.an.instanceof(Foo);</span><br><span class="line"><span class="comment">// include</span></span><br><span class="line">expect([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).to.include(<span class="number">2</span>);</span><br><span class="line">expect(<span class="string">'foobar'</span>).to.contain(<span class="string">'foo'</span>);</span><br><span class="line">expect(&#123; <span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">hello</span>: <span class="string">'universe'</span> &#125;).to.include.keys(<span class="string">'foo'</span>);</span><br><span class="line"><span class="comment">// empty</span></span><br><span class="line">expect([]).to.be.empty;</span><br><span class="line">expect(<span class="string">''</span>).to.be.empty;</span><br><span class="line">expect(&#123;&#125;).to.be.empty;</span><br><span class="line"><span class="comment">// match</span></span><br><span class="line">expect(<span class="string">'foobar'</span>).to.match(<span class="regexp">/^foo/</span>);</span><br></pre></td></tr></table></figure><h3 id="4-å‘½ä»¤è¡Œå‚æ•°"><a href="#4-å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="4. å‘½ä»¤è¡Œå‚æ•°"></a>4. å‘½ä»¤è¡Œå‚æ•°</h3><p><code>--recursive</code> æ‰§è¡Œ/testæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æµ‹è¯•æ–‡ä»¶<br><code>--reporter,-R</code> å‚æ•°ç”¨æ¥æŒ‡å®šæµ‹è¯•æŠ¥å‘Šçš„æ ¼å¼ï¼Œé»˜è®¤æ˜¯specæ ¼å¼<br><code>--watch,-w</code> å‚æ•°ç”¨æ¥ç›‘è§†æŒ‡å®šçš„æµ‹è¯•è„šæœ¬ã€‚åªè¦æµ‹è¯•è„šæœ¬æœ‰å˜åŒ–ï¼Œå°±ä¼šè‡ªåŠ¨è¿è¡ŒMochaã€‚<br><code>--bail,-b</code> å‚æ•°æŒ‡å®šåªè¦æœ‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ²¡æœ‰é€šè¿‡ï¼Œå°±åœæ­¢æ‰§è¡Œåé¢çš„æµ‹è¯•ç”¨ä¾‹ã€‚è¿™å¯¹æŒç»­é›†æˆå¾ˆæœ‰ç”¨ã€‚<br><code>--grep,-g</code> å‚æ•°ç”¨äºæœç´¢æµ‹è¯•ç”¨ä¾‹çš„åç§°ï¼ˆå³itå—çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œç„¶ååªæ‰§è¡ŒåŒ¹é…çš„æµ‹è¯•ç”¨ä¾‹ã€‚<br><code>--invert,-i</code> å‚æ•°è¡¨ç¤ºåªè¿è¡Œä¸ç¬¦åˆæ¡ä»¶çš„æµ‹è¯•è„šæœ¬ï¼Œå¿…é¡»ä¸â€“grepå‚æ•°é…åˆä½¿ç”¨ã€‚</p><p>è¿™äº›å‘½ä»¤è¡Œå‚æ•°å¯ä»¥å†™åœ¨mocha.optsæ–‡ä»¶ä¸­é…ç½®ï¼Œè¿™æ ·å‘½ä»¤è¡Œè¾“å…¥<code>mocha</code>ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥äº†<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mocha.opts</span></span><br><span class="line">--reporter tap</span><br><span class="line">--recursive</span><br><span class="line">--growl</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä¸æ˜¯åœ¨testæ–‡ä»¶å¤¹ä¸‹å­˜æ”¾æµ‹è¯•æ–‡ä»¶ï¼Œå¯ä»¥åœ¨mocha.optsé…ç½®æ–‡ä»¶ä¸­é…ç½®<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡å®šè¿è¡Œserver-testsæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</span></span><br><span class="line">server-tests</span><br><span class="line">--recursive</span><br></pre></td></tr></table></figure></p><h3 id="5-å¼‚æ­¥æµ‹è¯•"><a href="#5-å¼‚æ­¥æµ‹è¯•" class="headerlink" title="5. å¼‚æ­¥æµ‹è¯•"></a>5. å¼‚æ­¥æµ‹è¯•</h3><p>Mochaé»˜è®¤æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æœ€å¤šæ‰§è¡Œ2000æ¯«ç§’ï¼Œå¦‚æœåˆ°æ—¶æ²¡æœ‰å¾—åˆ°ç»“æœï¼Œå°±æŠ¥é”™ã€‚å¯¹äºæ¶‰åŠå¼‚æ­¥æ“ä½œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™ä¸ªæ—¶é—´å¾€å¾€æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦ç”¨-tæˆ–â€“timeoutå‚æ•°æŒ‡å®šè¶…æ—¶é—¨æ§›ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//timeout.js</span></span><br><span class="line"><span class="keyword">var</span> mocha     = <span class="built_in">require</span>(<span class="string">'mocha'</span>);</span><br><span class="line"><span class="keyword">var</span> chai      = <span class="built_in">require</span>(<span class="string">"chai"</span>);</span><br><span class="line"><span class="keyword">var</span> expect    = chai.expect;</span><br><span class="line"><span class="keyword">var</span> checkUser = <span class="built_in">require</span>(<span class="string">'../api/checkUser'</span>);</span><br><span class="line">describe(<span class="string">'apiæ–‡ä»¶æµ‹è¯•'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">'timeoutè¶…æ—¶æµ‹è¯•'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'æµ‹è¯•åº”è¯¥4000æ¯«ç§’åç»“æŸ'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">done</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> x = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        x = <span class="literal">false</span>;</span><br><span class="line">        expect(x).to.be.not.ok;</span><br><span class="line">        done(); <span class="comment">// é€šçŸ¥Mochaæµ‹è¯•ç»“æŸ</span></span><br><span class="line">      &#125;;</span><br><span class="line">      setTimeout(f, <span class="number">4000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>åœ¨ä¸è®¾ç½® -tæ—¶ï¼Œæ‰§è¡ŒæŠ¥é”™<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) apiæ–‡ä»¶æµ‹è¯• timeoutè¶…æ—¶æµ‹è¯• æµ‹è¯•åº”è¯¥<span class="number">4000</span>æ¯«ç§’åç»“æŸ:</span><br><span class="line">     <span class="built_in">Error</span>: Timeout <span class="keyword">of</span> <span class="number">2000</span>ms exceeded. For <span class="keyword">async</span> tests and hooks, ensure <span class="string">"done()"</span> is called; <span class="keyword">if</span> returning a <span class="built_in">Promise</span>, ensure it resolves.</span><br></pre></td></tr></table></figure></p><p>è®¾ç½®è¶…æ—¶5000m<code>mocha -t 5000</code>åæ­£å¸¸æ‰§è¡Œ</p><p>å¦å¤–ï¼Œä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªdoneå‡½æ•°ã€‚itå—æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼ å…¥ä¸€ä¸ªdoneå‚æ•°ï¼Œå½“æµ‹è¯•ç»“æŸçš„æ—¶å€™ï¼Œå¿…é¡»æ˜¾å¼è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå‘Šè¯‰Mochaæµ‹è¯•ç»“æŸäº†ã€‚å¦åˆ™ï¼ŒMochaå°±æ— æ³•çŸ¥é“ï¼Œæµ‹è¯•æ˜¯å¦ç»“æŸï¼Œä¼šä¸€ç›´ç­‰åˆ°è¶…æ—¶æŠ¥é”™ã€‚</p><p>å¦å¤–ï¼ŒMochaå†…ç½®å¯¹Promiseçš„æ”¯æŒï¼Œå…è®¸ç›´æ¥è¿”å›Promiseï¼Œç­‰åˆ°å®ƒçš„çŠ¶æ€æ”¹å˜ï¼Œå†æ‰§è¡Œæ–­è¨€ï¼Œè€Œä¸ç”¨æ˜¾å¼è°ƒç”¨doneï¼Œè§/test/userCheck.test.jsã€‚</p><h3 id="6-æµ‹è¯•ç”¨ä¾‹çš„é’©å­"><a href="#6-æµ‹è¯•ç”¨ä¾‹çš„é’©å­" class="headerlink" title="6. æµ‹è¯•ç”¨ä¾‹çš„é’©å­"></a>6. æµ‹è¯•ç”¨ä¾‹çš„é’©å­</h3><p>Mochaåœ¨describeå—ä¹‹ä¸­ï¼Œæä¾›æµ‹è¯•ç”¨ä¾‹çš„å››ä¸ªé’©å­ï¼š<code>before()</code>ã€<code>after()</code>ã€<code>beforeEach()</code>å’Œ<code>afterEach()</code>ã€‚å®ƒä»¬ä¼šåœ¨æŒ‡å®šæ—¶é—´æ‰§è¡Œã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'hooks'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åœ¨æœ¬åŒºå—çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">  after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åœ¨æœ¬åŒºå—çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä¹‹åæ‰§è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åœ¨æœ¬åŒºå—çš„æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">  afterEach(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åœ¨æœ¬åŒºå—çš„æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä¹‹åæ‰§è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// test cases</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h2 id="ä¸‰ã€å‚è€ƒæ–‡æ¡£"><a href="#ä¸‰ã€å‚è€ƒæ–‡æ¡£" class="headerlink" title="ä¸‰ã€å‚è€ƒæ–‡æ¡£"></a>ä¸‰ã€å‚è€ƒæ–‡æ¡£</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html" target="_blank" rel="noopener">æµ‹è¯•æ¡†æ¶ Mocha å®ä¾‹æ•™ç¨‹</a></li><li><a href="http://imweb.io/topic/5634c91109e01a534b461eaa?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noopener">å•å…ƒæµ‹è¯• &amp; mocha ç®€è¿°</a></li><li><a href="http://blog.csdn.net/m13666368773/article/details/7006912" target="_blank" rel="noopener">å­¦ä¹ TDDï¼šTDDçš„å¥½å¤„</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•&quot;&gt;&lt;a href=&quot;#ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•&quot;&gt;&lt;/a&gt;ä¸€ã€ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;å•å…ƒæµ‹è¯•ï¼ˆunit testingï¼‰ï¼Œæ˜¯æŒ‡å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯
      
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
      <category term="node.jså­¦ä¹ ç¬”è®°" scheme="http://blog.chenkeyi.com/tags/node-js%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>2016å¹´æ€»ç»“å’Œ2017å¹´ç›®æ ‡</title>
    <link href="http://blog.chenkeyi.com/2017/01/05/my2016and2017/"/>
    <id>http://blog.chenkeyi.com/2017/01/05/my2016and2017/</id>
    <published>2017-01-05T08:31:00.000Z</published>
    <updated>2017-10-17T20:12:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œä¸Šä¸€æ¬¡çš„åšå®¢éƒ½è¦è¿½æº¯åˆ°4æœˆä»½äº†ï¼ŒçœŸæ˜¯æƒ­æ„§ã€‚<br>ä»Šå¤©å·¥ä½œéœ€æ±‚æµ‹è¯•é˜¶æ®µåŸºæœ¬å¿«å‘Šä¸€æ®µè½ï¼Œè€Œä¸”ä»Šå¤©æ­£å¥½éƒ¨é—¨å‰ç«¯å¼€äº†ä¸ªæ€»ç»“ä¼šï¼Œæƒ³æƒ³2016å¹´è¿‡å»äº†ï¼Œè¶ç€ç°åœ¨æœ‰æ—¶é—´ï¼Œä¹Ÿè¯¥æ¥å†™ä¸€ä¸‹2016å¹´çš„æ€»ç»“å’Œè§„åˆ’è§„åˆ’2017å¹´çš„ç›®æ ‡äº†ã€‚<br><a id="more"></a></p><h2 id="2016å›é¡¾"><a href="#2016å›é¡¾" class="headerlink" title="2016å›é¡¾"></a>2016å›é¡¾</h2><p>åœ¨2016å¹´å¼€å¹´çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿå†™è¿‡ä¸€ç¯‡2016å¹´çš„ç›®æ ‡ï¼Œç°åœ¨æ¥å›é¡¾ä¸€ä¸‹å§ã€‚</p><blockquote><p>1.æ— ç‰¹æ®Šæƒ…å†µï¼Œæ¯å¤©æ™šä¸Šç¡å‰åšåŠä¸ªå°æ—¶ä»¥ä¸Šè¿åŠ¨ã€‚<br>2.æ— ç‰¹æ®Šæƒ…å†µï¼Œæ¯å¤©æ™šä¸Šç¡å‰çœ‹åŠä¸ªå°æ—¶ä»¥ä¸Šä¹¦ï¼Œçœ‹å®Œä¹¦å•ä¸Šçš„ä¹¦ã€‚</p></blockquote><p>è¿™ä¸¤æ¡ç›®æ ‡ï¼Œæœç„¶å¯¹æˆ‘æ¥è¯´è¿˜æ˜¯å¤ªéš¾äº†- - ç¡å‰è¿åŠ¨é—´æ­‡æ€§åšæŒäº†2ä¸ªæœˆï¼Œ7æœˆæ­£å¼å·¥ä½œåä¹ŸåšæŒäº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯è‡ªä»å¼€å§‹å…»çŒ«ä¹‹åï¼Œæ¯å¤©æ™šä¸Šå›å®¶çš„å¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨äº†æ’¸çŒ«ä¸Šã€‚è¿åŠ¨ä»€ä¹ˆçš„ä¹Ÿè’åºŸäº†ã€‚çœ‹ä¹¦ä¹Ÿæ˜¯ï¼Œè™½ç„¶2016å¹´çœ‹äº†å‡ æœ¬ä¹¦ï¼Œä½†æ˜¯æ¯å¤©ç¡å‰çœ‹ä¹¦è¿˜æ˜¯æ²¡æœ‰åšæŒã€‚</p><blockquote><p>æ‹¿é©¾ç…§ (å·²å®Œæˆ)<br>å®Œæˆæ¯•ä¸šè®¾è®¡æœŸé—´å­¦ä¹ ï¼Œè¾¾æˆå­¦ä¹ ç›®æ ‡ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰<br>å­˜é’±æ¯•ä¸šæ—…è¡Œ (å·²å®Œæˆ)<br>å­˜é’±ä¹°mac pro (å·²å®Œæˆ)</p></blockquote><p>é©¾ç…§æ‹¿çš„å¾ˆè½»æ¾å•Šï¼Œä¸è¿‡æ²¡è½¦ä¹Ÿæ²¡å•¥ç”¨- -ã€‚<br>æ¯•ä¸šè®¾è®¡æœŸé—´ç”¨node+express+leancloudå†™äº†ä¸€ä¸ªç¤¾å›¢ç®¡ç†ç³»ç»Ÿï¼Œå¯¹äºnodeå†™webç³»ç»Ÿç®—æ˜¯æœ‰äº†ä¸€ä¸ªç»éªŒï¼Œå¯¹äºä¹‹åå·¥ä½œä¹Ÿæœ‰äº†å¸®åŠ©ã€‚<br>æ¯•ä¸šæ—…è¡Œå»äº†ä¸‰äºšï¼Œä¹Ÿç®—æ˜¯è¾¾æˆäº†æˆ‘ä¸€ä¸ªå†…é™†äººå£«çš„çœ‹æµ·æˆå°±ã€‚<br>mac proå·²ä¹°ï¼Œåœ¨9æœˆä»½ç”Ÿæ—¥çš„æ—¶å€™ä¹°ç»™è‡ªå·±å½“ç”Ÿæ—¥ç¤¼ç‰©ï¼Œå¯¹äºå†™ä»£ç çš„å¹¸ç¦æ„Ÿè¿˜æ˜¯æœ‰æ‰€æé«˜çš„ 2333ã€‚</p><p>ç»¼ä¸Šï¼Œé™¤äº†1.2æ¡ä»¥å¤–ï¼ŒåŸºæœ¬è¿˜æ˜¯å®Œæˆäº†ï¼ˆæ‡’ç™Œæ²¡æ•‘-ã€‚-ï¼‰ã€‚</p><p>å¦å¤–ï¼Œ2016å¹´è¿˜æœ‰ä¸€äº›å…¶ä»–æ”¶è·ã€‚<br>è¿æ°”å¾ˆå¥½ï¼ŒæŠ±å…»äº†ä¸€åªå–µï¼Œæ¯å¤©å›å®¶å¼€é—¨çš„æ—¶å€™ï¼Œå°±èƒ½å¬è§å®ƒå–µå–µçš„å«ï¼Œè·‘åˆ°é—¨å£æ¥è¿æ¥æˆ‘ï¼ˆæˆ‘è®¤ä¸ºçš„ï¼‰ï¼Œæœ‰æ—¶å€™æ‰‹ä¸€ä¼¸è¿‡å»ï¼Œå®ƒå°±æ­ªç€å€’ä¸‹å»ï¼Œè‚šå­æœä¸Šå–èŒäº†ç­‰æŠšæ‘¸äº†ã€‚ç°åœ¨å¤©å†·äº†ï¼Œå®ƒä¼šè¶´åœ¨ä½ æ•å¤´æ—è¾¹æœ›ç€ä½ ï¼Œä¸€ç›´æœ›åˆ°ä½ æŠŠè¢«å­æ‹‰å¼€è®©å®ƒè¿›æ¥å’Œä½ ä¸€èµ·ç¡ã€‚çœŸæ˜¯æ¯å¤©éƒ½ä¼šè¢«å®ƒèŒåˆ°ã€‚</p><p>7æœˆä»½æ­£å¼å¼€å§‹çŒªå…«æˆ’å·¥ä½œäº†ï¼Œå‚ä¸äº†å¥½å‡ ä¸ªæ¯”è¾ƒå¤§çš„å…¬å¸çº§é¡¹ç›®ï¼Œè™½ç„¶æœ‰æ—¶å€™åŠ ç­æ¯”è¾ƒå¤šï¼Œä½†æ˜¯å®Œæˆäº†é¡¹ç›®çš„æ—¶å€™è¿˜æ˜¯å¾ˆæœ‰æˆå°±æ„Ÿçš„ã€‚<br>ä¹Ÿç”¨node.jsä½œä¸ºcontrollerå±‚è°ƒsoaæœåŠ¡çš„å½¢å¼ï¼Œå¼€å‘äº†2ä¸ªå…¬å¸æ¯”è¾ƒé‡è¦çš„åŠŸèƒ½ï¼Œè™½ç„¶æ˜¯æ–°äººï¼Œä½†æ˜¯èƒ½å¤Ÿç‹¬ç«‹å¼€å‘è¿™ä¹ˆå¤§çš„æ¨¡å—ï¼Œæ„Ÿè§‰è´£ä»»å’Œæˆå°±æ„Ÿå¹¶å­˜ã€‚</p><p>å–œæ¬¢ä¸Šäº†ç‹¼äººæ€ï¼Œç»“è¯†äº†ä¸€ç¾¤æ€å‹ï¼Œæœ‰æ—¶å€™ä¸‹ç­å°±ä¼šç»„ç»‡æ€ä¸€æŠŠã€‚ä½œä¸ºå…¬å¸ç‹¼äººæ€å°åˆ†é˜Ÿè€å¸æœºçš„ä¸€å‘˜ï¼Œæ„Ÿè§‰è¿™ä¸ªç»„ç»‡éå¸¸æœ‰çˆ±ã€‚</p><h2 id="2017å¹´ç›®æ ‡"><a href="#2017å¹´ç›®æ ‡" class="headerlink" title="2017å¹´ç›®æ ‡"></a>2017å¹´ç›®æ ‡</h2><p>å®šä¸€ä¸‹2017å¹´çš„ç›®æ ‡å§ï¼Œæ¯•ç«Ÿ2017å¹´çš„é¸¡è¡€è¿˜æ˜¯è¦æ‰“ä¸€æ‰“çš„ã€‚</p><ol><li>æ·±å…¥å­¦ä¹ ï¼Œç§¯ç´¯15ç¯‡ä»¥ä¸Šåšå®¢ï¼Œnç¯‡ç¬”è®°ã€‚</li><li>ä»Šå¹´æœ‰å¹´å‡äº†ï¼Œä¹ŸåŠäº†æŠ¤ç…§ï¼Œæ˜¯è¯¥è¾¾æˆä¸€æ³¢å‡ºå›½æˆå°±äº†ã€‚</li><li>æ¯å‘¨æŠ½ä¸ª3.5ä¸ªå°æ—¶çœ‹ä¹¦å§ï¼Œå†™è¯»ä¹¦ç¬”è®°ã€‚å¸å–å»å¹´çš„ç»éªŒï¼Œä¸å¹³å‡åˆ°æ¯å¤©äº†ã€‚</li><li>å­˜é’±ï¼Œ4wä»¥ä¸Šï¼Œä¸èƒ½å†æœˆå…‰äº†ã€‚</li><li>æ¯ä¸ªæœˆä¹°ä¸€ä¸ªè‡ªå·±è´­ç‰©æ„¿æœ›æ¸…å•ä¸Šçš„ä¸œè¥¿ã€‚ï¼ˆå•Šï¼Œè¿™æ¡å…¶å®å’Œ4æœ‰ç‚¹å†²çªï¼Œä½†æ˜¯ä¸ºäº†æå‡è‡ªå·±çš„å¹¸ç¦æ„Ÿï¼Œå­˜é’±å¥½éš¾ï¼Œå˜¤å˜¤å˜¤ã€‚ï¼‰</li><li>å¾…å®š</li></ol><p>æœ€åæ”¾èŒçŒ«ä¸€åªã€‚<br><img src="http://ww2.sinaimg.cn/mw690/680ee472gw1fawjr222kbj20qo0zk114.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ï¼Œä¸Šä¸€æ¬¡çš„åšå®¢éƒ½è¦è¿½æº¯åˆ°4æœˆä»½äº†ï¼ŒçœŸæ˜¯æƒ­æ„§ã€‚&lt;br&gt;ä»Šå¤©å·¥ä½œéœ€æ±‚æµ‹è¯•é˜¶æ®µåŸºæœ¬å¿«å‘Šä¸€æ®µè½ï¼Œè€Œä¸”ä»Šå¤©æ­£å¥½éƒ¨é—¨å‰ç«¯å¼€äº†ä¸ªæ€»ç»“ä¼šï¼Œæƒ³æƒ³2016å¹´è¿‡å»äº†ï¼Œè¶ç€ç°åœ¨æœ‰æ—¶é—´ï¼Œä¹Ÿè¯¥æ¥å†™ä¸€ä¸‹2016å¹´çš„æ€»ç»“å’Œè§„åˆ’è§„åˆ’2017å¹´çš„ç›®æ ‡äº†ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="ç”Ÿæ´»çäº‹" scheme="http://blog.chenkeyi.com/tags/%E7%94%9F%E6%B4%BB%E7%90%90%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨pm2+githubå°†nodeé¡¹ç›®ä¸€é”®éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨</title>
    <link href="http://blog.chenkeyi.com/2016/07/25/pm2-node-service/"/>
    <id>http://blog.chenkeyi.com/2016/07/25/pm2-node-service/</id>
    <published>2016-07-25T06:06:50.000Z</published>
    <updated>2017-10-17T20:11:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ¯æ¬¡åœ¨æœ¬åœ°è·‘Nodeé¡¹ç›®è‡ªå¨±è‡ªä¹æ€»ä¸æ˜¯å¾ˆçˆ½ï¼Œä¸€ç›´æƒ³æŠŠè‡ªå·±çš„nodeé¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚ä½†æ˜¯æˆ‘å¯¹äºåç«¯å’Œè¿ç»´çŸ¥è¯†æˆ‘è¿˜æ˜¯å¤„äºå°ç™½é˜¶æ®µï¼Œä»Šå¤©ç ”ç©¶äº†ä¸€ä¸‹åˆï¼Œæ€»ç®—æ˜¯æˆåŠŸæŠŠè‡ªå·±çš„nodeé¡¹ç›®æäº†ä¸Šå»ï¼Œåˆå­¦åˆ°äº†æ–°å§¿åŠ¿ã€‚æœ¬æ–‡å°†ä»‹ç»æ€ä¹ˆä»é›¶å¼€å§‹ï¼Œè·å¾—æœåŠ¡å™¨ï¼Œå¹¶å°†nodeé¡¹ç›®é€šè¿‡github+pm2éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚<br><a id="more"></a></p><h3 id="æœåŠ¡å™¨ç¯å¢ƒæ­å»º"><a href="#æœåŠ¡å™¨ç¯å¢ƒæ­å»º" class="headerlink" title="æœåŠ¡å™¨ç¯å¢ƒæ­å»º"></a>æœåŠ¡å™¨ç¯å¢ƒæ­å»º</h3><h4 id="è´­ä¹°æœåŠ¡å™¨"><a href="#è´­ä¹°æœåŠ¡å™¨" class="headerlink" title="è´­ä¹°æœåŠ¡å™¨"></a>è´­ä¹°æœåŠ¡å™¨</h4><p>(å·²æœ‰æœåŠ¡å™¨çš„å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤)ã€‚<br>æˆ‘æ˜¯ç”¨çš„è…¾è®¯çš„äº‘æœåŠ¡å™¨ï¼Œå› ä¸ºè…¾è®¯äº‘è¿˜æ˜¯æ¯”è¾ƒè‰¯å¿ƒï¼Œäº‘æœåŠ¡å™¨å¼€æ”¾äº†å…è´¹ä½“éªŒåŠŸèƒ½ï¼ˆä¸çŸ¥é“ä¹‹åä¼šä¸ä¼šå…³é—­ï¼‰ï¼Œå¾ˆé€‚åˆæˆ‘ä»¬è¿™ç§æ–°æ‰‹å…ˆè¯•ç”¨å†è´­ä¹°ã€‚é€šè¿‡è¿™ä¸ªã€<a href="https://www.qcloud.com/act/try?t=cvm" target="_blank" rel="noopener">é“¾æ¥</a>ã€‘ç”³è¯·äº†å…è´¹è¯•ç”¨ã€‚ç”³è¯·æˆåŠŸåï¼Œå°±ä¼šæ”¶åˆ°è¯¥æ”¹ä¸»æœºçš„ä¿¡æ¯ã€‚æˆ‘é€‰æ‹©çš„1æ ¸CPUã€1GBå†…å­˜,ç³»ç»Ÿä¸ºCentOS 7.2 64ä½ã€‚ä¹Ÿè®¸åœ¨ä½ çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¹Ÿè¿‡æœŸäº†- -</p><hr><p>ç°åœ¨æˆ‘æ¢æˆäº†å›½å¤–çš„vps ä¾¿å®œå¥½ç”¨è¿˜èƒ½ç¿»å¢™ åš¯åš¯åš¯ã€‚</p><h4 id="ç™»å½•äº‘æœåŠ¡å™¨"><a href="#ç™»å½•äº‘æœåŠ¡å™¨" class="headerlink" title="ç™»å½•äº‘æœåŠ¡å™¨"></a>ç™»å½•äº‘æœåŠ¡å™¨</h4><p>åœ¨æœ¬æœºç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯è¿æ¥ä¸Šäº‘æœåŠ¡å™¨ï¼Œç„¶åéœ€è¦è¾“å…¥ç»™ä½ çš„åˆå§‹å¯†ç ã€‚<br><code>ssh root@æœåŠ¡å™¨å…¬ç½‘ip</code></p><h4 id="å®‰è£…ç›¸å…³æ–‡ä»¶"><a href="#å®‰è£…ç›¸å…³æ–‡ä»¶" class="headerlink" title="å®‰è£…ç›¸å…³æ–‡ä»¶"></a>å®‰è£…ç›¸å…³æ–‡ä»¶</h4><p>æ›´æ–°yumï¼ˆäº‘æœåŠ¡å™¨è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·ï¼‰ï¼š<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">update</span> -<span class="built_in">y</span></span><br></pre></td></tr></table></figure></p><p>æ›´æ–°å®Œæ¯•åï¼Œå®‰è£…Node.jsï¼š<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> nodejs -y</span><br></pre></td></tr></table></figure></p><p>å®‰è£…Npmï¼š<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> npm -y</span><br></pre></td></tr></table></figure></p><p>å®‰è£…pm2ï¼š<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> pm2 -g</span><br></pre></td></tr></table></figure></p><p>åˆ†åˆ«æ‰§è¡Œ<code>node -v</code>ã€<code>npm -v</code>ã€<code>pm2 -v</code>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœæ²¡æœ‰å®‰è£…æˆåŠŸï¼Œå‰é¢åŠ ä¸Š<code>sudo</code>å‘½ä»¤é‡è¯•</p><h4 id="æœåŠ¡å™¨ç«¯åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰"><a href="#æœåŠ¡å™¨ç«¯åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æœåŠ¡å™¨ç«¯åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰"></a>æœåŠ¡å™¨ç«¯åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰</h4><p>ä¸ºæœåŠ¡å™¨å®‰å…¨èµ·è§ï¼Œåˆ›å»ºç”¨æˆ·(ç”¨æˆ·åï¼šyourName)ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">useradd yourName</span></span><br></pre></td></tr></table></figure></p><p>è®¾ç½®å¯†ç ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">passwd yourName</span></span><br></pre></td></tr></table></figure></p><p>æ·»åŠ sudoæƒé™ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">usermod -aG wheel yourName</span></span><br></pre></td></tr></table></figure></p><h4 id="æœåŠ¡å™¨ç«¯å…³é—­rootç”¨æˆ·çš„sshè®¿é—®-å¯é€‰-ï¼š"><a href="#æœåŠ¡å™¨ç«¯å…³é—­rootç”¨æˆ·çš„sshè®¿é—®-å¯é€‰-ï¼š" class="headerlink" title="æœåŠ¡å™¨ç«¯å…³é—­rootç”¨æˆ·çš„sshè®¿é—®(å¯é€‰)ï¼š"></a>æœåŠ¡å™¨ç«¯å…³é—­rootç”¨æˆ·çš„sshè®¿é—®(å¯é€‰)ï¼š</h4><p>ä¸ºæœåŠ¡å™¨å®‰å…¨èµ·è§ï¼Œå…³é—­rootè´¦æˆ·çš„è¿œç¨‹è®¿é—®ã€‚<br>æ‰“å¼€é…ç½®æ–‡ä»¶ï¼š<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ssh<span class="regexp">/sshd_config</span></span><br></pre></td></tr></table></figure></p><p>æŒ‰ä¸‹<code>i</code>,åˆ‡æ¢viä¸ºè¾“å…¥çŠ¶æ€<br>æ‰¾åˆ°å¦‚ä¸‹è®¾ç½®ï¼Œåˆ é™¤å‰é¢çš„<code>#</code>ï¼Œå¹¶ä¿®æ”¹yesä¸ºnoï¼š<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PermitRootLogin</span> <span class="literal">no</span></span><br></pre></td></tr></table></figure></p><p>æŒ‰ä¸‹<code>esc</code>ï¼Œåˆ‡æ¢viä¸ºå‘½ä»¤çŠ¶æ€ï¼Œç„¶åè¾“å…¥<code>:wq</code>å›è½¦ä¿å­˜é€€å‡º<br>ä¿å­˜æ–‡ä»¶åï¼Œé‡å¯sshdæœåŠ¡ï¼š<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">service sshd restart</span></span><br></pre></td></tr></table></figure></p><p>é€€å‡ºrootè´¦æˆ·ï¼Œå¹¶ä½¿ç”¨æ–°åˆ›å»ºç”¨æˆ·è®¿é—®ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ssh</span> <span class="selector-tag">yourName</span>@æœåŠ¡å™¨å…¬ç½‘<span class="keyword">ip</span></span><br></pre></td></tr></table></figure></p><h3 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h3><p>æœ¬æ–‡çš„æ“ä½œç¯å¢ƒæ˜¯<br>æœ¬åœ°ï¼šMac OSX<br>è¿œç«¯æœåŠ¡å™¨ï¼šè…¾è®¯äº‘ECSï¼ˆ1æ ¸CPUã€1GBå†…å­˜ï¼‰ï¼ŒIPï¼š119.29.101.229ï¼Œç³»ç»Ÿä¸ºCentOS 7.2 64ä½<br>é‡‡ç”¨çš„æŠ€æœ¯ï¼šNode.js + Express.js<br>Githubï¼šè´¦æˆ·åï¼šcky917<br>ä»¥ä¸‹å‘½ä»¤å…¨éƒ¨å¸¦å…¥æˆ‘çš„è´¦å·ï¼Œ<strong>è‡ªå·±ä½¿ç”¨æ—¶è®°å¾—æ›¿æ¢ä¸ºè‡ªå·±çš„è´¦å·</strong>ã€‚<br>æœ¬æ–‡å¯¹äºGitåŸºæœ¬æ“ä½œå’Œnodeä¹Ÿä¸åšè¯¦ç»†è®²è§£ã€‚</p><h3 id="æœ¬åœ°åˆ›å»ºnodeé¡¹ç›®"><a href="#æœ¬åœ°åˆ›å»ºnodeé¡¹ç›®" class="headerlink" title="æœ¬åœ°åˆ›å»ºnodeé¡¹ç›®"></a>æœ¬åœ°åˆ›å»ºnodeé¡¹ç›®</h3><p>å…·ä½“å¦‚ä½•åˆ›å»ºï¼Œæœ¬æ–‡ä¸è¯¦ç»†è®¨è®ºã€‚å‡è®¾å·²ç»å»ºç«‹å¥½ä¸€ä¸ªåä¸ºpm2Demoçš„é¡¹ç›®ã€‚</p><h3 id="githubå»ºç«‹é“¾æ¥"><a href="#githubå»ºç«‹é“¾æ¥" class="headerlink" title="githubå»ºç«‹é“¾æ¥"></a>githubå»ºç«‹é“¾æ¥</h3><p>ç™»å½•äº‘æœåŠ¡å™¨ï¼Œå®‰è£…gitï¼Œç”Ÿæˆssh-keyã€‚ç„¶åå°†äº‘æœåŠ¡å™¨çš„ssh-keyåŠ åˆ°è‡ªå·±çš„githubä¸­ã€‚<br>åœ¨æœ¬åœ°æ‰§è¡ŒåŒæ ·çš„æ“ä½œã€‚</p><p>è¿›å…¥æœ¬åœ°é¡¹ç›®ç›®å½•./pm2Demoï¼Œå°†æœ¬åœ°é¡¹ç›®ä¸githubè¿œç¨‹ä»“åº“å»ºç«‹è¿æ¥ã€‚<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="keyword">add</span><span class="bash"> origin https://github.com/cky917/pm2Demo.git</span></span><br><span class="line"><span class="bash">git push -u origin master</span></span><br></pre></td></tr></table></figure></p><h3 id="pm2éƒ¨ç½²"><a href="#pm2éƒ¨ç½²" class="headerlink" title="pm2éƒ¨ç½²"></a>pm2éƒ¨ç½²</h3><p>pm2çš„ä»‹ç»å¯ä»¥çœ‹çœ‹è¿™ç¯‡<a href="https://segmentfault.com/a/1190000002539204" target="_blank" rel="noopener">æ–‡ç« </a><br>è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤ä¹Ÿå¯ä»¥çœ‹<a href="http://pm2.keymetrics.io/docs/usage/deployment/#considerations" target="_blank" rel="noopener">å®˜æ–¹é…ç½®æ–‡æ¡£</a></p><p>æœ¬åœ°å®‰è£…pm2ä¹‹åæ‰§è¡Œ<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p<span class="name">m2</span> ecosystem</span><br></pre></td></tr></table></figure></p><p>ä¼šç”Ÿæˆä¸€ä¸ªecosystem.config.js(ç‰ˆæœ¬åŸå› ï¼Œä¹Ÿå¯èƒ½æ˜¯ecosystem.json)æ–‡ä»¶ï¼Œæ‰“å¼€è¯¥æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚ä¿®æ”¹<code>script</code>é…ç½®ä¸ºnodeé¡¹ç›®å¯åŠ¨æ–‡ä»¶ã€‚<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">apps :</span> [</span><br><span class="line">    <span class="comment">//ç”±äºæˆ‘ä»¬æ­¤æ¬¡åªæœ‰ä¸€ä¸ªé¡¹ç›®,æˆ‘ä»¬åªé…ç½®ä¸€ä¸ªapp</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">name      :</span> <span class="string">"pm2Demo"</span>,</span><br><span class="line">      <span class="string">script    :</span> <span class="string">"./bin/www"</span>,</span><br></pre></td></tr></table></figure></p><p>å…¶ä½™å…³äºappéƒ¨åˆ†çš„é…ç½®ï¼Œå¯è§<a href="http://pm2.keymetrics.io/docs/usage/application-declaration/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>;</p><p>å†é…ç½®éƒ¨ç½²éƒ¨åˆ†ï¼š<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">deploy </span>: &#123;</span><br><span class="line">    <span class="attribute">production </span>: &#123;<span class="comment">//ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²é…ç½®</span></span><br><span class="line">      <span class="attribute">user </span>: <span class="string">"cky"</span>,<span class="comment">//ç™»å½•è¿œç¨‹æœåŠ¡å™¨çš„ç”¨æˆ·å</span></span><br><span class="line">      <span class="attribute">host </span>: <span class="string">"119.29.101.229"</span>,<span class="comment">//è¿œç¨‹æœåŠ¡å™¨çš„IPæˆ–hostnameï¼Œæ­¤å¤„å¯ä»¥æ˜¯æ•°ç»„åŒæ­¥éƒ¨ç½²å¤šä¸ªæœåŠ¡å™¨</span></span><br><span class="line">      <span class="attribute">ref  </span>: <span class="string">"origin/master"</span>,<span class="comment">//è¿œç«¯åç§°åŠåˆ†æ”¯å</span></span><br><span class="line">      <span class="attribute">repo </span>: <span class="string">"git@github.com:cky917/pm2Demo.git"</span>,<span class="comment">//gitä»“åº“åœ°å€</span></span><br><span class="line">      <span class="attribute">path </span>: <span class="string">"/home/cky/www/production/pm2Demo"</span>,<span class="comment">//è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²ç›®å½•ï¼Œéœ€è¦å¡«å†™userå…·å¤‡å†™å…¥æƒé™çš„ç›®å½•</span></span><br><span class="line">      <span class="string">"post-deploy"</span> : <span class="string">"npm install &amp;&amp; pm2 startOrRestart ecosystem.config.js --env production"</span>,<span class="comment">//éƒ¨ç½²åéœ€è¦æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line">      <span class="string">"env"</span>  : &#123;</span><br><span class="line">        <span class="string">"NODE_ENV"</span>: <span class="string">"production"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attribute">dev </span>: &#123;<span class="comment">//å¼€å‘ç¯å¢ƒéƒ¨ç½²é…ç½®</span></span><br><span class="line">      <span class="attribute">user </span>: <span class="string">"cky"</span>,</span><br><span class="line">      <span class="attribute">host </span>: <span class="string">"119.29.101.229"</span>,</span><br><span class="line">      <span class="attribute">ref  </span>: <span class="string">"origin/dev"</span>,</span><br><span class="line">      <span class="attribute">repo </span>: <span class="string">"git@github.com:cky917/pm2Demo.git"</span>,</span><br><span class="line">      <span class="attribute">path </span>: <span class="string">"/home/cky/www/dev/pm2Demo"</span>,</span><br><span class="line">      <span class="string">"post-deploy"</span> : <span class="string">"npm install &amp;&amp; pm2 startOrRestart ecosystem.config.js --env dev"</span>,</span><br><span class="line">      <span class="attribute">env  </span>: &#123;</span><br><span class="line">        <span class="attribute">NODE_ENV</span>: <span class="string">"dev"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢çš„ä»£ç æˆ‘ä»¬éƒ¨ç½²äº†2ä¸ªç¯å¢ƒï¼Œå½“ç„¶ä½ å¾—æœ‰å¯¹åº”çš„åˆ†æ”¯ã€‚<br>æ”¹å¥½åï¼Œæˆ‘ä»¬å°†ecosystem.config.jsä»£ç æäº¤åˆ°è¿œç¨‹githubä»“åº“å»ï¼Œ<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">add</span><span class="bash"> .</span></span><br><span class="line"><span class="bash">git commit -m <span class="string">"update ecosystem"</span></span></span><br><span class="line"><span class="bash">git push</span></span><br></pre></td></tr></table></figure></p><p>åœ¨äº‘æœåŠ¡å™¨ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†<code>http://github.com</code>åŠ å…¥known_hostsï¼š<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keyscan -t rsa github.com <span class="meta">&gt;&gt; </span>~<span class="regexp">/.ssh/known</span>_hosts</span><br></pre></td></tr></table></figure></p><p>å› ä¸ºpm2çš„éƒ¨ç½²æ˜¯é€šè¿‡sshè¿›è¡Œçš„ï¼Œå› æ­¤éœ€è¦å¼€é€šæœ¬åœ°åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æ— å¯†ç ç™»å½•ï¼ŒåŒæ ·ï¼Œåœ¨Macä¸‹ï¼Œé€šè¿‡ssh-keygenç”ŸæˆRSAå…¬é’¥ï¼Œå¹¶æ‹·è´åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼š<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~<span class="regexp">/.ssh/id</span>_rsa.pub cky<span class="variable">@119</span>.<span class="number">29.101</span>.<span class="number">229</span><span class="symbol">:/home/cky/</span>.ssh/authorized_keys</span><br></pre></td></tr></table></figure></p><p>åœ¨æœ¬åœ°æ‰§è¡Œå‘½ä»¤æŠŠæ–‡ä»¶ç›®å½•åˆå§‹åŒ–åˆ°æœåŠ¡å™¨ç«¯ï¼š<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pm2 deploy &lt;configuration_file&gt; &lt;environment&gt; <span class="built_in">setup</span></span><br><span class="line"><span class="comment">//æ¯”å¦‚ï¼š</span></span><br><span class="line">pm2 deploy ecosystem.<span class="built_in">config</span>.js production <span class="built_in">setup</span></span><br></pre></td></tr></table></figure></p><p>å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œä¼šè¾“å‡º<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  ...</span><br><span class="line">  â—‹ setup complete</span><br><span class="line">--&gt; Success</span><br></pre></td></tr></table></figure></p><h3 id="ä¸€é”®éƒ¨ç½²ä»£ç åˆ°æœåŠ¡å™¨"><a href="#ä¸€é”®éƒ¨ç½²ä»£ç åˆ°æœåŠ¡å™¨" class="headerlink" title="ä¸€é”®éƒ¨ç½²ä»£ç åˆ°æœåŠ¡å™¨"></a>ä¸€é”®éƒ¨ç½²ä»£ç åˆ°æœåŠ¡å™¨</h3><p>åœ¨æœ¬åœ°./pm2Demoé¡¹ç›®ä¸‹ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤éƒ¨ç½²ä»£ç åˆ°æœåŠ¡å™¨<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 deploy ecosystem<span class="selector-class">.config</span><span class="selector-class">.js</span> production</span><br></pre></td></tr></table></figure></p><p>ä¼šçœ‹åˆ°è¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼Œè¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">Use</span> <span class="string">`pm2 show &lt;id|name&gt;`</span> <span class="keyword">to</span> <span class="keyword">get</span> more details about an app</span><br><span class="line">  â—‹ hook <span class="keyword">test</span></span><br><span class="line">  â—‹ successfully deployed origin/<span class="keyword">master</span></span><br><span class="line"><span class="comment">--&gt; Success</span></span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ï¼Œä½ çš„ä»£ç å·²ç»è¢«éƒ¨ç½²ï¼Œè€Œä¸”é¡¹ç›®ä¹Ÿå¯åŠ¨äº†ã€‚<br>pm2éƒ¨ç½²å‘½ä»¤åˆ—è¡¨å¦‚ä¸‹ï¼š<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pm2 deploy <span class="symbol">&lt;configuration_file&gt;</span> <span class="symbol">&lt;environment&gt;</span> <span class="symbol">&lt;command&gt;</span></span><br><span class="line">  Command<span class="variable">s:</span></span><br><span class="line">    setup                run remote setup commands</span><br><span class="line">    <span class="keyword">update</span>               <span class="keyword">update</span> deploy <span class="keyword">to</span> the latest release</span><br><span class="line">    revert [n]           revert <span class="keyword">to</span> [n]<span class="keyword">th</span> <span class="keyword">last</span> deployment <span class="built_in">or</span> <span class="number">1</span></span><br><span class="line">    curr[ent]            output current release commit</span><br><span class="line">    <span class="keyword">prev</span>[ious]           output <span class="keyword">previous</span> release commit</span><br><span class="line">    exec|run <span class="symbol">&lt;cmd&gt;</span>       <span class="keyword">execute</span> the given <span class="symbol">&lt;cmd&gt;</span></span><br><span class="line">    <span class="keyword">list</span>                 <span class="keyword">list</span> <span class="keyword">previous</span> deploy commits</span><br><span class="line">    [ref]                deploy <span class="keyword">to</span> [ref], the <span class="string">"ref"</span> setting, <span class="built_in">or</span> latest <span class="keyword">tag</span></span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæˆ‘å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæˆ‘çš„åˆ†æ”¯ä»£ç æ›´æ–°äº†ï¼Œæˆ‘æ‰§è¡Œéƒ¨ç½²æ›´æ–°å‘½ä»¤æ‹‰å–çš„æäº¤è®°å½•è¿˜æ˜¯åˆå§‹åŒ–æ—¶çš„æäº¤è®°å½•ï¼Œæˆ‘å¿…é¡»åˆ æ‰æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¤¹ï¼Œé‡æ–°æ‰§è¡Œåˆå§‹åŒ–å’Œéƒ¨ç½²çš„æ“ä½œï¼Œä¸çŸ¥é“æ˜¯æœ¬æ¥å°±è¿™æ ·è¿˜æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°åŸå› - -ã€‚</p><p>éƒ¨ç½²æˆåŠŸåï¼Œåœ¨è¿œç¨‹æœåŠ¡å™¨ç«¯è¾“å…¥<code>netstat -antp</code>æŸ¥çœ‹ç«¯å£æƒ…å†µã€‚å¯ä»¥çœ‹åˆ°3000ç«¯å£å·²ç»å¯ä»¥è®¿é—®ã€‚<br>è¾“å…¥<a href="http://119.29.101.229:3000/" target="_blank" rel="noopener">http://119.29.101.229:3000/</a> å°±èƒ½è®¿é—®åˆ°é¡¹ç›®äº†ï¼ˆæˆ‘æŠŠæˆ‘ç®€é™‹çš„æ¯•è®¾é¡¹ç›®æäº†ä¸Šå» - -,ç®¡ç†å‘˜è´¦æˆ·root,å¯†ç 123 æœ‰å…´è¶£å¯ä»¥ç™»å½•è¯•ä¸€ä¸‹ï¼‰</p><h3 id="è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"><a href="#è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"></a>è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</h3><p>å¯ä»¥é€šè¿‡pm2 startupæ¥å®ç°å¼€æœºè‡ªå¯åŠ¨ã€‚ç»†èŠ‚å¯<a href="http://pm2.keymetrics.io/docs/usage/startup/" target="_blank" rel="noopener">å‚è€ƒ</a>ã€‚å¤§è‡´æµç¨‹å¦‚ä¸‹</p><ol><li>é€šè¿‡<code>pm2 save</code>ä¿å­˜å½“å‰è¿›ç¨‹çŠ¶æ€ã€‚</li><li>é€šè¿‡<code>pm2 startup [platform]</code>ç”Ÿæˆå¼€æœºè‡ªå¯åŠ¨çš„å‘½ä»¤ã€‚ï¼ˆè®°å¾—æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼‰</li><li>å°†æ­¥éª¤2ç”Ÿæˆçš„å‘½ä»¤ï¼Œç²˜è´´åˆ°æ§åˆ¶å°è¿›è¡Œï¼Œæå®šã€‚</li></ol><h3 id="nginxåå‘ä»£ç†"><a href="#nginxåå‘ä»£ç†" class="headerlink" title="nginxåå‘ä»£ç†"></a>nginxåå‘ä»£ç†</h3><p>é€šè¿‡nginxåå‘ä»£ç†ï¼Œå¯ä»¥è®©æœåŠ¡å™¨ä¸ŠæŸç«¯å£ï¼ŒæŒ‡å‘æŒ‡å®šåŸŸåçš„80ç«¯å£ï¼Œè¿™æ ·è®¿é—®æ—¶å°±ä¸éœ€è¦åŠ ç«¯å£å·äº†ã€‚<br>è¯¦ç»†è§<a href="http://pm2.keymetrics.io/docs/tutorials/pm2-nginx-production-setup" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a><br>é¦–å…ˆæˆ‘ä»¬è¦åœ¨äº‘æœåŠ¡å™¨ä¸Šå®‰è£…nginx:<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> nginx</span><br></pre></td></tr></table></figure></p><p>å®‰è£…æˆåŠŸåï¼Œå¯åŠ¨nginxæœåŠ¡ï¼š<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx <span class="literal">start</span></span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨å‘½ä»¤<code>nginx -t</code>æŸ¥æ‰¾nginxé…ç½®æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨viå‘½ä»¤ä¿®æ”¹è¯¥é…ç½®æ–‡ä»¶ã€‚<br>æˆ‘çš„é…ç½®å¦‚ä¸‹</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log <span class="string">/var/log/nginx/error.log</span>;</span><br><span class="line">pid <span class="string">/run/nginx.pid</span>;</span><br><span class="line"><span class="comment"># Load dynamic modules. See /usr/share/nginx/README.dynamic.</span></span><br><span class="line">include <span class="string">/usr/share/nginx/modules/</span>*<span class="string">.conf</span>;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">  upstream my_nodejs_upstream &#123;</span><br><span class="line">    server 127.0.0.1<span class="function">:3000</span>;</span><br><span class="line">    keepalive 64;</span><br><span class="line">  &#125;</span><br><span class="line">  server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name   www.chenkeyi.com;<span class="string">//</span>ä½ çš„åŸŸå</span><br><span class="line">    access_log  <span class="string">/var/log/nginx/bysj.log</span>;</span><br><span class="line">    error_log <span class="string">/var/log/nginx/bysj.error.log</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_<span class="keyword">set</span>_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_<span class="keyword">set</span>_header Host $http_host;</span><br><span class="line">        proxy_<span class="keyword">set</span>_header X-NginX-Proxy <span class="literal">true</span>;</span><br><span class="line">        proxy_http_<span class="keyword">version</span> 1.1;</span><br><span class="line">        proxy_pass http:<span class="string">//my_nodejs_upstream/</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹å®Œå<code>service nginx restart</code>é‡å¯nginx</p><h3 id="è§£æåŸŸå"><a href="#è§£æåŸŸå" class="headerlink" title="è§£æåŸŸå"></a>è§£æåŸŸå</h3><p>è¿™ä¸ªåœ¨è…¾è®¯äº‘å’Œé˜¿é‡Œäº‘ç­‰éƒ½æä¾›è§£æåŸŸåæœåŠ¡ã€‚</p><p>é…ç½®æˆåŠŸï¼š<a href="http://bysj.chenkeyi.com" target="_blank" rel="noopener">bysj.chenkeyi.com</a>å¯ä»¥è®¿é—®ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¯æ¬¡åœ¨æœ¬åœ°è·‘Nodeé¡¹ç›®è‡ªå¨±è‡ªä¹æ€»ä¸æ˜¯å¾ˆçˆ½ï¼Œä¸€ç›´æƒ³æŠŠè‡ªå·±çš„nodeé¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚ä½†æ˜¯æˆ‘å¯¹äºåç«¯å’Œè¿ç»´çŸ¥è¯†æˆ‘è¿˜æ˜¯å¤„äºå°ç™½é˜¶æ®µï¼Œä»Šå¤©ç ”ç©¶äº†ä¸€ä¸‹åˆï¼Œæ€»ç®—æ˜¯æˆåŠŸæŠŠè‡ªå·±çš„nodeé¡¹ç›®æäº†ä¸Šå»ï¼Œåˆå­¦åˆ°äº†æ–°å§¿åŠ¿ã€‚æœ¬æ–‡å°†ä»‹ç»æ€ä¹ˆä»é›¶å¼€å§‹ï¼Œè·å¾—æœåŠ¡å™¨ï¼Œå¹¶å°†nodeé¡¹ç›®é€šè¿‡github+pm2éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
      <category term="node.jså­¦ä¹ ç¬”è®°" scheme="http://blog.chenkeyi.com/tags/node-js%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºjQueryçš„Deferredå¯¹è±¡ä»‹ç»ï¼ˆè¯‘ï¼‰</title>
    <link href="http://blog.chenkeyi.com/2016/03/25/introduction-jquery-deferred-objects/"/>
    <id>http://blog.chenkeyi.com/2016/03/25/introduction-jquery-deferred-objects/</id>
    <published>2016-03-25T09:28:50.000Z</published>
    <updated>2017-10-17T17:27:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>(è¶ç€æ¯•è®¾è¦æ±‚ï¼Œç¿»è¯‘äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¡ºä¾¿æ”¾ä¸Šæ¥ã€‚è‹±æ–‡ä¸å¥½ç¿»äº†2å¤©æ‰ç¿»å®Œï¼Œ/(ã„’oã„’)/~~å¦‚æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£ã€‚)<br>åŸæ–‡é“¾æ¥:<a href="http://www.sitepoint.com/introduction-jquery-deferred-objects/" target="_blank" rel="noopener">An Introduction to jQueryâ€™s Deferred Objects</a></p><p>é•¿ä¹…ä»¥æ¥ï¼Œjavascriptçš„å¼€å‘è€…ä¹ æƒ¯äºä½¿ç”¨å›è°ƒå‡½æ•°å»æ‰§è¡ŒæŸäº›ä»»åŠ¡ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­å°±æ˜¯å½“æŸäº›äº‹ä»¶æ¯”å¦‚<code>click</code>æˆ–è€…<code>keypress</code>æ‰§è¡Œçš„æ—¶å€™ï¼Œé€šè¿‡<code>addEventListener()</code>æ·»åŠ å›è°ƒå‡½æ•°ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå›è°ƒå‡½æ•°å¾ˆç®€å•ï¼Œè®©å·¥ä½œèƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°å®Œæˆï¼Œä¸å¹¸çš„æ˜¯ï¼Œå½“ä½ çš„ç½‘é¡µå˜å¾—è¶Šæ¥è¶Šå¤æ‚è€Œä¸”ä½ éœ€è¦æ‰§è¡Œè®¸å¤šå¼‚æ­¥è¯·æ±‚æ—¶ï¼Œå®ƒä»¬å˜å¾—è¶Šæ¥è¶Šéš¾ä»¥å¤„ç†ã€‚</p><p>ECMAScript2015å¼•è¿›äº†ä¸€ä¸ªåŸç”Ÿçš„æ–¹æ³•å»å¤„ç†è¿™ç§æƒ…å†µï¼špromiseã€‚å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯promiseï¼Œä½ å¯ä»¥è¯»ä¸€è¯»è¿™ç¯‡æ–‡ç« <a href="http://www.sitepoint.com/overview-javascript-promises/" target="_blank" rel="noopener">An Overview of JavaScript Promises</a>ã€‚jQueryæ¨å‡ºäº†å®ƒè‡ªå·±é£æ ¼çš„promiseï¼Œå°±æ˜¯ <strong>Deferredå¯¹è±¡</strong> ã€‚å®ƒåœ¨promiseè¢«å¼•å…¥ECMAScriptä¹‹å‰å‡ å¹´å°±è¢«å¼•å…¥äº†jqureyï¼Œåœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä¼šè®¨è®ºä¸€ä¸‹ä»€ä¹ˆæ˜¯<code>Deferred</code>å¯¹è±¡ï¼Œè¿˜æœ‰å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚</p><h2 id="ä¸€ä¸ªç®€å•çš„å†å²ä»‹ç»"><a href="#ä¸€ä¸ªç®€å•çš„å†å²ä»‹ç»" class="headerlink" title="ä¸€ä¸ªç®€å•çš„å†å²ä»‹ç»"></a>ä¸€ä¸ªç®€å•çš„å†å²ä»‹ç»</h2><p><code>Deferred</code>å¯¹è±¡åœ¨jQuery1.5ç‰ˆæœ¬è¢«å¼•å…¥ï¼Œå®ƒèƒ½è®©å›è°ƒå‡½æ•°æˆä¸ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼Œç»§è€Œè¢«é“¾å¼è°ƒç”¨ï¼Œå®ƒè¿˜èƒ½å¤„ç†åŒæ­¥æˆ–è€…å¼‚æ­¥å‡½æ•°çš„æˆåŠŸæˆ–è€…å¤±è´¥çŠ¶æ€ã€‚ä»æ­¤ä»¥åï¼Œå®ƒæˆä¸ºäº†ä¸€ä¸ªè¯¾é¢˜è¢«è®¨è®ºå’Œç ”ç©¶ï¼Œä¹Ÿæœ‰ä¸€äº›æ‰¹è¯„çš„å£°éŸ³ï¼Œä¼´éšç€æ‰¹è¯„å’Œå®ƒä¹Ÿå‘ç”Ÿäº†è®¸å¤šæ”¹å˜ã€‚è¿™é‡Œæœ‰ä¸¤ç¯‡å¯¹å®ƒçš„æ‰¹åˆ¤æ€§çš„æ–‡ç« ï¼š<a href="https://blog.domenic.me/youre-missing-the-point-of-promises/" target="_blank" rel="noopener">Youâ€™re Missing the Point of Promises</a>å’Œ<a href="https://thewayofcode.wordpress.com/tag/jquery-deferred-broken/" target="_blank" rel="noopener">JavaScript Promises and why jQuery implementation is broken</a>ã€‚</p><p>è¿åŒ<a href="http://api.jquery.com/Types/#Promise" target="_blank" rel="noopener">Promiseå¯¹è±¡</a>,Deferredä»£è¡¨äº†jQueryå¯¹äºPromisesçš„å®ç°ã€‚åœ¨jQuery1.Xç‰ˆæœ¬å’Œ2.xç‰ˆæœ¬é‡Œï¼Œdeferredå¯¹è±¡ä¾é™„äº<a href="http://wiki.commonjs.org/wiki/Promises/A" target="_blank" rel="noopener">the CommonJS Promises/A proposal</a>ï¼Œè¿™ä¸ªææ¡ˆè¢«ä½œä¸º<a href="https://promisesaplus.com/" target="_blank" rel="noopener">Promises/A+ proposal</a>çš„åŸºç¡€ï¼Œè€ŒåŸç”Ÿçš„promiseså°±æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šå»ºç«‹çš„ã€‚æ­£å¦‚å‰é¢æ‰€æåˆ°çš„ï¼ŒjQueryæ²¡æœ‰ä¾é™„äº Promises/A+çš„åŸå› æ˜¯å®ƒåœ¨è¿™ä¹‹å‰å°±å·²ç»äº§ç”Ÿäº†ã€‚</p><p>å› ä¸ºjQueryæ˜¯ä¸€ä¸ªå…ˆé©±è€…ï¼Œè¿˜ç”±äºå‘åå…¼å®¹é—®é¢˜ï¼Œåœ¨åŸç”Ÿjavascripté‡Œä½¿ç”¨promiseä¸åœ¨jQuery1.xã€2.xç‰ˆæœ¬é‡Œä½¿ç”¨éƒ½æœ‰ä¸€äº›åŒºåˆ«ã€‚è€Œä¸”ï¼Œç”±äºjQueryéµå¾ªäº†ä¸€ä¸ªä¸åŒçš„ææ¡ˆï¼Œè¿™ä¸ªæ¡†æ¶å’Œå…¶ä»–å®ç°äº†promisesçš„æ¡†æ¶æ¯”å¦‚<a href="https://github.com/kriskowal/q" target="_blank" rel="noopener">the Q library</a>æ˜¯äº’ä¸å…¼å®¹çš„ã€‚</p><p>åœ¨å³å°†åˆ°æ¥çš„ <strong>jQuery 3</strong> ç‰ˆæœ¬é‡Œï¼Œæ”¹è¿›äº†ä¸åŸç”Ÿçš„Promises(åœ¨ECMAScript 2015è¢«å®ç°çš„)çš„å…¼å®¹æ€§ã€‚è™½ç„¶æœ‰äº›ä¸»è¦çš„æ–¹æ³•ï¼ˆthen())è¿˜æ˜¯ç”±äºå‘åå…¼å®¹çš„åŸå› å’ŒåŸç”Ÿçš„Promisesæœ‰äº›å·®åˆ«ï¼Œä½†æ˜¯å…¶ä½¿ç”¨ä¹ æƒ¯å·²ç»è¶Šæ¥è¶Šæ¥è¿‘è§„èŒƒæ ‡å‡†äº†ã€‚</p><p></p><h2 id="callbackJquery">jQueryä¸­çš„å›è°ƒ</h2><br>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆä½ éœ€è¦ä½¿ç”¨<code>Deferred</code>å¯¹è±¡ï¼Œè®©æˆ‘ä»¬å…ˆè®¨è®ºä¸€ä¸ªä¾‹å­ã€‚å½“ä½ ä½¿ç”¨jQueryçš„æ—¶å€™ï¼Œä¸€å®šç»å¸¸ä½¿ç”¨å®ƒçš„ajaxæ–¹æ³•å»å¤„ç†å¼‚æ­¥è¯·æ±‚ã€‚ä¸ºäº†ç†è§£è¿™ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘é¡µå¹¶ä¸”æ­£åœ¨å‘Githubçš„APIå‘é€Ajaxè¯·æ±‚ã€‚ä½ çš„ç›®æ ‡æ˜¯æ”¶åˆ°ç”¨æˆ·çš„ä»“åº“åˆ—è¡¨ï¼Œæ‰¾åˆ°æœ€è¿‘æ›´æ–°è¿‡çš„ä»“åº“ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªåä¸ºâ€™README.mdâ€™çš„æ–‡ä»¶ï¼Œæœ€ç»ˆæ¥æ”¶åˆ°è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚åŸºäºä»¥ä¸Šçš„æè¿°ï¼Œä½ æ¯ä¸€ä¸ªAjaxè¯·æ±‚å¯èƒ½éƒ½ä¼šæ˜¯åœ¨ä¸Šä¸€ä¸ªæ­¥éª¤å®Œæˆçš„æ—¶å€™å‘é€ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™äº›è¯·æ±‚å¿…é¡»åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚<p></p><p>è®©æˆ‘ä»¬æŠŠè¿™äº›æè¿°è½¬æ¢ä¸ºä»£ç ï¼ˆè¯·æ³¨æ„æˆ‘æ²¡æœ‰ä½¿ç”¨çœŸçš„Githubçš„APIï¼‰ï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹ä»£ç ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> username = <span class="string">'testuser'</span>;</span><br><span class="line"><span class="keyword">var</span> fileToSearch = <span class="string">'README.md'</span>;</span><br><span class="line"></span><br><span class="line">$.getJSON(<span class="string">'https://api.github.com/user/'</span> + username + <span class="string">'/repositories'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">repositories</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> lastUpdatedRepository = repositories[<span class="number">0</span>].name;</span><br><span class="line"></span><br><span class="line">  $.getJSON(<span class="string">'https://api.github.com/user/'</span> + username + <span class="string">'/repository/'</span> + lastUpdatedRepository + <span class="string">'/files'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">files</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> README = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (files[i].name.indexOf(fileToSearch) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        README = files[i].path;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $.getJSON(<span class="string">'https://api.github.com/user/'</span> + username + <span class="string">'/repository/'</span> + lastUpdatedRepository + <span class="string">'/file/'</span> + README + <span class="string">'/content'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'The content of the file is: '</span> + content);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>æ­£å¦‚ä½ åœ¨è¿™ä¸ªä¾‹å­é‡Œçœ‹åˆ°çš„ï¼Œä¸ºäº†è¾¾åˆ°ç›®çš„ï¼Œæˆ‘ä»¬å¿…é¡»åµŒå¥—æ‰§è¡ŒAjaxè¯·æ±‚ã€‚è¿™è®©æˆ‘ä»¬çš„ä»£ç å˜å¾—å¯è¯»æ€§æ¯”è¾ƒå·®ã€‚åœ¨æˆ‘ä»¬å¿…é¡»åµŒå¥—ä½¿ç”¨å¤§é‡çš„å›è°ƒï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„å›è°ƒå‡½æ•°éœ€è¦å’Œå¦ä¸€ä¸ªå‡½æ•°ä»¥åŒæ­¥çš„æ–¹å¼æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ç§°è¿™ç§æƒ…å†µä¸ºâ€œå›è°ƒåœ°ç‹±â€ã€‚</p><p>ä¸ºäº†è®©è¿™ç§æƒ…å†µå˜å¥½ä¸€ç‚¹ï¼Œä½ å¯ä»¥å°†æˆ‘ä¸Šé¢å†™çš„åŒ¿åå‡½æ•°æå–å‡ºæ¥å‘½åã€‚ç„¶è€Œï¼Œè¿™æ ·æ”¹å˜ä¹Ÿæ²¡å•¥å¸®åŠ©ï¼Œæˆ‘ä»¬ä»ç„¶å‘ç°æˆ‘ä»¬èº«å¤„äºå›è°ƒåœ°ç‹±ä¸­ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°±èµ°è¿›<code>Deferred</code>å¯¹è±¡å’Œ<code>Promise</code>å¯¹è±¡å§ã€‚</p><h2 id="Deferredå¯¹è±¡å’ŒPromiseå¯¹è±¡"><a href="#Deferredå¯¹è±¡å’ŒPromiseå¯¹è±¡" class="headerlink" title="Deferredå¯¹è±¡å’ŒPromiseå¯¹è±¡"></a>Deferredå¯¹è±¡å’ŒPromiseå¯¹è±¡</h2><p>Deferredå¯¹è±¡å¯ä»¥åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™ä½¿ç”¨ï¼Œæ¯”å¦‚Ajaxè¯·æ±‚å’ŒåŠ¨ç”»ã€‚åœ¨jQueryé‡Œï¼Œ<code>Promise</code>å¯¹è±¡åˆ›å»ºäº<code>Deferred</code>å¯¹è±¡æˆ–è€…<code>jQuery</code>å¯¹è±¡ã€‚å®ƒæ‹¥æœ‰<code>Deferred</code>å¯¹è±¡ä¸‹çš„æ–¹æ³•ï¼Œå¦‚ï¼š<code>always()</code>,<code>done()</code>,<code>fail()</code>,<code>state()</code>,å’Œ<code>then()</code>ã€‚æˆ‘ä¼šåœ¨ä¸‹é¢ä»‹ç»è¿™äº›æ–¹æ³•ã€‚</p><p>å¦‚æœä½ æ˜¯æ¥è‡ªåŸç”Ÿjavascriptä¸–ç•Œçš„ï¼Œä½ å¯èƒ½ä¼šå¯¹è¿™ä¸¤ä¸ªå¯¹è±¡çš„å­˜åœ¨æ„Ÿåˆ°å¾ˆå›°æƒ‘ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼ˆ<code>Deferred</code>å’Œ<code>Promise</code>ï¼‰ï¼Œè€ŒåŸç”ŸJavascriptåªæœ‰ä¸€ä¸ªï¼ˆ<code>Promise</code>)ï¼Ÿä¸ºäº†è§£é‡Šä»–ä»¬çš„ä¸åŒå’Œä»–ä»¬çš„ç”¨ä¾‹ï¼Œæˆ‘åœ¨æˆ‘çš„ä¹¦ä¸­å¯¹ä»–ä»¬è¿›è¡Œäº†ç±»æ¯”<a href="https://www.manning.com/books/jquery-in-action-third-edition" target="_blank" rel="noopener">jQuery in Action, Third Edition</a>ã€‚</p><p>ä¸€ä¸ªä½¿ç”¨<code>Deferred</code>å¯¹è±¡çš„å…¸å‹æƒ…å†µæ˜¯ï¼Œå¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªå‡½æ•°å»å¤„ç†å¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼ˆè¿”å›ä¸€ä¸ªé”™è¯¯æˆ–è€…ä¸è¿”å›å€¼ä¹Ÿè¡Œï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ çš„å‡½æ•°æ˜¯å€¼çš„â€œç”Ÿäº§è€…â€ï¼Œè€Œä¸”ä½ å¸Œæœ›é˜»æ­¢ç”¨æˆ·å»æ”¹å˜<code>Deferred</code>çš„çŠ¶æ€ã€‚å½“ä½ æ˜¯è¿™ä¸ªå‡½æ•°çš„æ¶ˆè´¹è€…æ—¶ï¼Œä½ å°±è¦ä½¿ç”¨<code>promise</code>ã€‚</p><p>ä¸ºäº†é˜æ˜è¿™ä¸ªè§‚ç‚¹ï¼Œè®©æˆ‘ä»¬å‡è®¾ä½ å¸Œæœ›å®ç°ä¸€ä¸ªåŸºäºpromiseçš„ <code>timeout()</code>æ–¹æ³•(ä¸‹é¢æ˜¯è¿™ä¸ª<a href="#creatingapromisebasedsettimeoutfunction">ä¾‹å­çš„ä»£ç </a>ã€‚ä½ è´Ÿè´£å†™è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å¿…é¡»ç­‰åˆ°è·å¾—ä¸€ä¸ªæ—¶é—´çš„æ•°å­—ï¼ˆåœ¨è¿™ä¸ªç­‰å¾…çš„æƒ…å†µä¸‹æ²¡æœ‰å€¼è¿”å›ï¼‰ï¼Œè¿™è®©ä½ æˆä¸ºä¸€ä¸ªâ€œç”Ÿäº§è€…â€ã€‚ä½ è¿™ä¸ªå‡½æ•°çš„â€œæ¶ˆè´¹è€…â€ä¸éœ€è¦å…³å¿ƒå»resolveå®ƒæˆ–è€…rejectå®ƒï¼Œâ€œæ¶ˆè´¹è€…â€åªéœ€è¦èƒ½å¤Ÿåœ¨Deferredæ‰§è¡Œå®Œæˆåã€å¤±è´¥åã€æˆ–è€…è¿›ç¨‹ä¸­æ·»åŠ å‡½æ•°ã€‚å¦å¤–ï¼Œä½ æƒ³è¦ç¡®ä¿ä½ çš„â€œæ¶ˆè´¹è€…â€ä¸èƒ½resolveæˆ–rejectè¿™ä¸ªDeferredå¯¹è±¡ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œä½ éœ€è¦åœ¨ä½ åˆ›å»ºçš„<code>timeoout()</code>å‡½æ•°ä¸­è¿”å›<code>Deferred</code>çš„<code>promise</code>å¯¹è±¡ï¼Œè€Œä¸æ˜¯<code>Deferred</code>å¯¹è±¡æœ¬èº«ã€‚è¿™æ ·åšä¹‹åï¼Œä½ èƒ½ç¡®ä¿é™¤äº†ä½ çš„<code>timeout()</code>å‡½æ•°ä»¥å¤–ï¼Œæ²¡æœ‰äººèƒ½å¤Ÿè°ƒç”¨<code>resolve()</code>å’Œ<code>reject()</code>æ–¹æ³•ã€‚</p><p>ä½ å¯ä»¥åœ¨<a href="http://stackoverflow.com/questions/17308172/deferred-versus-promise" target="_blank" rel="noopener">StackOverflow question</a>äº†è§£æ›´å¤šå…³äºjQueryçš„Deferredå¯¹è±¡å’ŒPromiseå¯¹è±¡çš„åŒºåˆ«ã€‚</p><p>ç°åœ¨ä½ çŸ¥é“è¿™äº›å¯¹è±¡æ˜¯ä»€ä¹ˆäº†ï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™äº›æ–¹æ³•çš„ä½œç”¨ã€‚</p><h2 id="Deferredå¯¹è±¡çš„æ–¹æ³•"><a href="#Deferredå¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="Deferredå¯¹è±¡çš„æ–¹æ³•"></a>Deferredå¯¹è±¡çš„æ–¹æ³•</h2><p><code>Deferred</code>å¯¹è±¡éå¸¸çµæ´»ï¼Œæä¾›äº†å¾ˆå¤šæ–¹æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚å®ƒå¯ä»¥è¢«åˆ›å»ºä¸º<code>jQuery.Deferred()</code>ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deferred = jQuery.Deferred();</span><br></pre></td></tr></table></figure></p><p>æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨<code>$</code>åˆ›å»ºï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deferred = $.Deferred();</span><br></pre></td></tr></table></figure></p><p>ä¸€æ—¦åˆ›å»ºï¼Œè¿™ä¸ª<code>Deferred</code>å¯¹è±¡å°±æš´éœ²äº†ä¸€äº›æ–¹æ³•ï¼Œé™¤äº†é‚£äº›ä¸èµæˆä½¿ç”¨çš„å’Œè¢«ç§»é™¤çš„æ–¹æ³•ï¼Œå®ƒæš´éœ²çš„æ–¹æ³•æœ‰ï¼š</p><ul><li><code>always(callbacks[, callbacks, ..., callbacks]):</code> åœ¨æ— è®ºDeferredå¯¹è±¡resolvedè¿˜æ˜¯rejectedçš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œã€‚</li><li><code>done(callbacks[, callbacks, ..., callbacks]):</code> å½“Deferredå¯¹è±¡resolvedçš„æ—¶å€™æ‰§è¡Œã€‚</li><li><code>fail(callbacks[, callbacks, ..., callbacks]):</code> å½“Deferredå¯¹è±¡rejectedçš„æ—¶å€™æ‰§è¡Œã€‚</li><li><code>notify([argument, ..., argument]):</code> æ ¹æ®ç»™å®šçš„ argså‚æ•° è°ƒç”¨Deferredå¯¹è±¡ä¸Šè¿›è¡Œä¸­çš„å›è°ƒ ï¼ˆprogressCallbacksï¼‰ã€‚</li><li><code>notifyWith(context[, argument, ..., argument]):</code> æ ¹æ®ç»™å®šçš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰å’Œargsé€’å»¶è°ƒç”¨Deferredå¯¹è±¡ä¸Šè¿›è¡Œä¸­çš„å›è°ƒï¼ˆprogressCallbacks ï¼‰ã€‚</li><li><code>progress(callbacks[, callbacks, ..., callbacks])</code>:å½“Deferredï¼ˆå»¶è¿Ÿï¼‰å¯¹è±¡ç”Ÿæˆè¿›åº¦é€šçŸ¥æ—¶ï¼Œè°ƒç”¨æ·»åŠ å¤„ç†ç¨‹åºã€‚</li><li><code>promise([target]):</code> Return a Deferredâ€˜s Promise object.</li><li><code>reject([argument, ..., argument]):</code> æ‹’ç»Deferredï¼ˆå»¶è¿Ÿï¼‰å¯¹è±¡ï¼Œå¹¶æ ¹æ®ç»™å®šçš„argså‚æ•°è°ƒç”¨ä»»ä½•å¤±è´¥å›è°ƒå‡½æ•°ï¼ˆfailCallbacksï¼‰ã€‚</li><li><code>rejectWith(context[, argument, ..., argument]):</code>æ‹’ç»Deferredï¼ˆå»¶è¿Ÿï¼‰å¯¹è±¡ï¼Œå¹¶æ ¹æ®ç»™å®šçš„ contextå’Œargså‚æ•°è°ƒç”¨ä»»ä½•å¤±è´¥å›è°ƒå‡½æ•°ï¼ˆfailCallbacksï¼‰ã€‚</li><li><code>resolve([argument, ..., argument]):</code> è§£å†³Deferredï¼ˆå»¶è¿Ÿï¼‰å¯¹è±¡ï¼Œå¹¶æ ¹æ®ç»™å®šçš„argså‚æ•°è°ƒç”¨ä»»ä½•å®Œæˆå›è°ƒå‡½æ•°ï¼ˆdoneCallbacksï¼‰ã€‚</li><li><code>resolveWith(context[, argument, ..., argument]):</code> è§£å†³Deferredï¼ˆå»¶è¿Ÿï¼‰å¯¹è±¡ï¼Œå¹¶æ ¹æ®ç»™å®šçš„ contextå’Œargså‚æ•°è°ƒç”¨ä»»ä½•å®Œæˆå›è°ƒå‡½æ•°ï¼ˆdoneCallbacksï¼‰ã€‚</li><li><code>state():</code>ç¡®å®šä¸€ä¸ªDeferredï¼ˆå»¶è¿Ÿï¼‰å¯¹è±¡çš„å½“å‰çŠ¶æ€ã€‚</li><li><code>then(resolvedCallback[, rejectedCallback[, progressCallback]]):</code> å½“Deferredï¼ˆå»¶è¿Ÿï¼‰å¯¹è±¡è§£å†³ï¼Œæ‹’ç»æˆ–ä»åœ¨è¿›è¡Œä¸­æ—¶ï¼Œè°ƒç”¨æ·»åŠ å¤„ç†ç¨‹åºã€‚</li></ul><p>é€šè¿‡è¿™äº›æ–¹æ³•çš„æè¿°ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿæ›´æ˜æ˜¾åœ°äº†è§£åˆ°jQueryæ–‡æ¡£ä¸­çš„æœ¯è¯­å’ŒECMAScriptæ ‡å‡†é‡Œçš„åŒºåˆ«ã€‚åœ¨ECMAScriptæ ‡å‡†é‡Œï¼Œä¸€ä¸ªpromiseå¯¹è±¡è¢«ç§°ä½œresolvedæ˜¯åœ¨ä»–å®Œæˆæˆ–è€…è¢«æ‹’ç»çš„æ—¶å€™ã€‚ç„¶è€Œï¼Œåœ¨jQueryæ–‡æ¡£é‡Œï¼Œresolvedæè¿°çš„åªæ˜¯åœ¨ECMAScriptä¸­çš„å®ŒæˆçŠ¶æ€ã€‚</p><p>Deferredæä¾›äº†å¤§é‡çš„æ–¹æ³•ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ä¸èƒ½å…¨éƒ¨ä»‹ç»åˆ°ã€‚ä¸è¿‡ï¼Œåœ¨ä¸‹é¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä¼šå±•ç¤ºä¸€äº›<code>Deferred</code>å¯¹è±¡å’Œ<code>Promise</code>å¯¹è±¡çš„ä½¿ç”¨çš„ä¾‹å­ã€‚é¦–å…ˆï¼Œæˆ‘æ¥ä¼šç”¨Deferredå¯¹è±¡é‡å†™ä¸€ä¸‹åœ¨<a href="#callbackJquery">jQueryä¸­çš„å›è°ƒ</a>ä¸­çš„é‚£æ®µä»£ç ï¼Œç„¶åæˆ‘ä¼šæŠŠâ€œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…â€çš„æ¯”å–»å†è§£é‡Šä¸€ä¸‹ã€‚</p><h2 id="ç”¨Deferredå¯¹è±¡å®ŒæˆAjaxè¯·æ±‚é˜Ÿåˆ—"><a href="#ç”¨Deferredå¯¹è±¡å®ŒæˆAjaxè¯·æ±‚é˜Ÿåˆ—" class="headerlink" title="ç”¨Deferredå¯¹è±¡å®ŒæˆAjaxè¯·æ±‚é˜Ÿåˆ—"></a>ç”¨Deferredå¯¹è±¡å®ŒæˆAjaxè¯·æ±‚é˜Ÿåˆ—</h2><p>åœ¨è¿™ä¸ªç« èŠ‚æˆ‘ä¼šå±•ç¤ºæ€ä¹ˆç”¨Deferredå¯¹è±¡å’Œå®ƒçš„ä¸€äº›æ–¹æ³•å»æé«˜<a href="#callbackJquery">jQueryä¸­çš„å›è°ƒ</a>é‡Œçš„é‚£æ®µä»£ç çš„å¯è¯»æ€§ï¼Œåœ¨å¼€å§‹æ¢ç´¢ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦æ˜ç™½æˆ‘ä»¬éœ€è¦ç”¨åˆ°å“ªäº›æ–¹æ³•ã€‚</p><p>æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚å’Œä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•åˆ—è¡¨ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬å¯ä»¥ç”¨<code>done()</code>æˆ–è€…<code>then()</code>æ–¹æ³•å»ç®¡ç†æˆåŠŸçš„çŠ¶æ€ã€‚ç”±äºä½ ä»¬å¤§å¤šæ•°å¯èƒ½å·²ç»ä¹ æƒ¯äºä½¿ç”¨Javascriptçš„<code>Promise</code>å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä¼šé€‰æ‹©ä½¿ç”¨<code>then()</code>æ–¹æ³•ã€‚åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•æœ€é‡è¦çš„ä¸€ä¸ªåŒºåˆ«æ˜¯<code>then()</code>æ–¹æ³•èƒ½å¤Ÿ<br>å°†æ¥æ”¶åˆ°çš„å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–åœ¨åé¢è°ƒç”¨çš„<code>then()</code>ã€<code>done()</code>ã€<code>fail()</code>æˆ–<code>progress()</code>æ–¹æ³•ã€‚</p><p>æœ€åçš„ä»£ç ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> username = <span class="string">'testuser'</span>;</span><br><span class="line"><span class="keyword">var</span> fileToSearch = <span class="string">'README.md'</span>;</span><br><span class="line"></span><br><span class="line">$.getJSON(<span class="string">'https://api.github.com/user/'</span> + username + <span class="string">'/repositories'</span>)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">repositories</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> repositories[<span class="number">0</span>].name;</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">lastUpdatedRepository</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $.getJSON(<span class="string">'https://api.github.com/user/'</span> + username + <span class="string">'/repository/'</span> + lastUpdatedRepository + <span class="string">'/files'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">files</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> README = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (files[i].name.indexOf(fileToSearch) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                README = files[i].path;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> README;</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">README</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $.getJSON(<span class="string">'https://api.github.com/user/'</span> + username + <span class="string">'/repository/'</span> + lastUpdatedRepository + <span class="string">'/file/'</span> + README + <span class="string">'/content'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(content);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p><p>æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œè¿™æ®µä»£ç æ¯”ä¹‹å‰çš„å¯è¯»æ€§å¥½äº†å¾ˆå¤šï¼Œå› ä¸ºæˆ‘ä»¬èƒ½æŠŠæ¯ä¸€ä¸ªæ­¥éª¤æ‹†å¼€çœ‹ï¼Œå®ƒä»¬éƒ½åŒä¸€çº§ï¼Œæ²¡æœ‰åµŒå¥—ã€‚</p><p></p><h2 id="creatingapromisebasedsettimeoutfunction">åˆ›é€ ä¸€ä¸ªåŸºäºPromiseçš„setTimeoutå‡½æ•°</h2><br>ä½ ä¹Ÿè®¸çŸ¥é“ï¼Œ<code>setTimeout()</code>èƒ½åœ¨æŒ‡å®šçš„æ—¶é—´åæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚å®ƒçš„ä¸¤ä¸ªå…ƒç´ ï¼ˆå›è°ƒå‡½æ•°å’Œæ—¶é—´ï¼‰éƒ½åº”è¯¥ä½œä¸ºå‚æ•°è¢«æä¾›ã€‚è®©æˆ‘ä»¬å‡è®¾ä½ æƒ³è¦1ç§’ååœ¨æ§åˆ¶å°æ‰“å°ä¸€æ®µä¿¡æ¯ã€‚ä½¿ç”¨<code>setTimeout()</code>ï¼Œä½ å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼š<p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'I waited for 1 second!'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">1000</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä½ æ‰€è§ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæƒ³è¦è¢«æ‰§è¡Œçš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯å¤šå°‘éœ€è¦ç­‰å¾…çš„æ¯«ç§’æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸€å‘å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³ç”¨é€šè¿‡<code>Deferred</code>é˜Ÿåˆ—å®ç°å‘¢ï¼Ÿ</p><p>åœ¨ä¸‹é¢æˆ‘ä¼šå‘Šè¯‰ä½ æ€ä¹ˆç”¨jQueryæä¾›çš„<code>Promise</code>å¯¹è±¡å®Œæˆä¸€ä¸ªåŸºäºpromiseçš„<code>setTimeout()</code>å‡½æ•°ã€‚</p><p>æœ€åçš„ä»£ç ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">milliseconds</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Create a new Deferred object</span></span><br><span class="line">    <span class="keyword">var</span> deferred = $.Deferred();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Resolve the Deferred after the amount of time specified by milliseconds</span></span><br><span class="line">    setTimeout(deferred.resolve, milliseconds);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return the Deferred's Promise object</span></span><br><span class="line">    <span class="keyword">return</span> deferred.promise();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timeout(<span class="number">1000</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'I waited for 1 second!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>æˆ‘å®šä¹‰äº†ä¸€ä¸ª<code>timeout()</code>å‡½æ•°ï¼ŒåŒ…è£¹äº†javaScriptçš„åŸç”Ÿ<code>setTimeout()</code>æ–¹æ³•ã€‚åœ¨<code>timeout()</code>æ–¹æ³•é‡Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„<code>Deferred</code>å¯¹è±¡å»ç®¡ç†å¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨<code>milliseconds</code>æ—¶é—´å<code>deferred</code>å¯¹è±¡è¢«è®¾ç½®ä¸ºresolveçŠ¶æ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>timeout()</code>å‡½æ•°æ˜¯è¿™ä¸ªå€¼çš„ç”Ÿäº§è€…ï¼Œæ‰€ä»¥å®ƒåˆ›å»ºäº†<code>Deferred</code>å¯¹è±¡è¿˜è¿”å›äº†<code>Promise</code>å¯¹è±¡ã€‚é€šè¿‡è¿™æ ·ï¼Œæˆ‘èƒ½ç¡®ä¿è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ä¸èƒ½å¤Ÿresolveæˆ–è€…rejectè¿™ä¸ª<code>Deferred</code>å¯¹è±¡ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªè°ƒç”¨è€…åªèƒ½æ·»åŠ å‡½æ•°å»æ‰§è¡Œï¼Œå’Œä½¿ç”¨<code>done()</code>,<code>faile()</code>ç­‰æ–¹æ³•ã€‚</p><h2 id="jQuery-1-x-2-x-ä¸-jQuery-3çš„åŒºåˆ«"><a href="#jQuery-1-x-2-x-ä¸-jQuery-3çš„åŒºåˆ«" class="headerlink" title="jQuery 1.x/2.x ä¸ jQuery 3çš„åŒºåˆ«"></a>jQuery 1.x/2.x ä¸ jQuery 3çš„åŒºåˆ«</h2><p>åœ¨ç¬¬ä¸€ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€æ®µä»£ç å»æŸ¥æ‰¾ä¸€ä¸ªåä¸ºâ€README.mdâ€çš„æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å¤„ç†è¿™ä¸ªæ–‡ä»¶æ²¡æœ‰è¢«æ‰¾åˆ°çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µåº”è¯¥è¢«ç§°ä½œå¤±è´¥çš„æƒ…å†µï¼Œå½“å¤±è´¥å‘é€æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å»æ‰“æ–­è¿™ä¸ªé˜Ÿåˆ—ç›´æ¥ç»“æŸã€‚å¦‚æœè¿™æ ·åšçš„è¯å®ƒä¼šå¾ˆè‡ªç„¶çš„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå–åˆ°è¿™ä¸ªå¼‚å¸¸åè¢«fail()è¿™ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œå°±åƒä½ åœ¨jsé‡Œé¢ç”¨çš„catch()æ–¹æ³•ä¸€æ ·ã€‚</p><p>éµå¾ªPromises/Aå’ŒPromises/A+çš„åº“ï¼ˆæ¯”å¦‚jQuery3.xï¼‰ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸æ˜¯è¢«è½¬æ¢ä¸ºrejectionç„¶åè°ƒç”¨é”™è¯¯å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚<code>fail()</code>ï¼Œè¢«æ•è·çš„å¼‚å¸¸ä¼šä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ã€‚</p><p>åœ¨jQuery1.xå’Œ2.xç‰ˆæœ¬ä¸­ï¼Œæœªè¢«æ•è·çš„å¼‚å¸¸ä¼šç»ˆæ­¢ç¨‹åºçš„æ‰§è¡Œï¼Œè¿™äº›ç‰ˆæœ¬ä¸‹å…è®¸æŠ›å‡ºçš„å¼‚å¸¸å†’æ³¡ï¼Œé€šå¸¸æ˜¯è¾¾åˆ°<code>window.onerror</code>ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰å‡½æ•°å»å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºï¼Œè€Œä¸”ä¼šä¸­æ–­ä»£ç æ‰§è¡Œã€‚</p><p>ä¸ºäº†æ›´å¥½çš„ç†è§£ä»–ä»¬ä¸åŒçš„åœ°æ–¹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> deferred = $.Deferred();</span><br><span class="line">deferred</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'An error message'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'First success function'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'First failure function'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Second success function'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Second failure function'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">deferred.resolve();</span><br></pre></td></tr></table></figure></p><p>åœ¨jQuery3.xç‰ˆæœ¬ä¸­ï¼Œä¼šæ‰“å°ä¿¡æ¯â€First failure functionâ€å’Œâ€Second success functionâ€åˆ°æ§åˆ¶å°ã€‚åŸå› å°±å’Œæˆ‘ä¸Šé¢è¯´çš„ä¸€æ ·ï¼Œä¸€ä¸ªæŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«è½¬å˜ä¸º<code>rejection</code>ï¼Œç„¶åé”™è¯¯å¤„ç†å‡½æ•°ä¼šåœ¨è¿™æ—¶å€™è¢«è°ƒç”¨ã€‚è€Œä¸”ï¼Œä¸€æ—¦å¼‚å¸¸è¢«ç®¡ç†åˆ°ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ä¼ é€’ç»™äº†ç¬¬äºŒä¸ª<code>then()</code>ï¼‰ï¼Œæ¥ä¸‹æ¥çš„æˆåŠŸå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼ˆæœ¬ä¾‹ä¸­çš„ç¬¬ä¸‰ä¸ª<code>then()</code>ï¼‰ã€‚</p><p>åœ¨jQuery1.xå’Œ2.xç‰ˆæœ¬ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå‡½æ•°ï¼ˆæŠ›å‡ºå¼‚å¸¸çš„å‡½æ•°ï¼‰ä¼šæ‰§è¡Œï¼Œç„¶åä½ ä¼šçœ‹åˆ°åœ¨æ§åˆ¶å°è¾“å‡ºäº†â€Uncaught Error: An error messageâ€ã€‚</p><p><strong>jQuery 1.x/2.x</strong></p><iframe class="" id="" data-url="http://jsbin.com/nozege/embed?js,console" src="http://jsbin.com/nozege/embed?js,console" style="border: 1px solid rgb(170, 170, 170); width: 100%; min-height: 300px; height: 200px;"></iframe><br><strong>jQuery3</strong><br><iframe class="" id="" data-url="http://jsbin.com/kifazi/embed?js,console" src="http://jsbin.com/kifazi/embed?js,console" style="border: 1px solid rgb(170, 170, 170); width: 100%; min-height: 300px; height: 200px;"></iframe><p>ä¸ºäº†è¿›ä¸€æ­¥æé«˜å®ƒä¸ECMAScript 2015çš„å…¼å®¹æ€§ï¼ŒjQuery3ä¹Ÿç»™<code>Deferred</code>å’Œ<code>Promise</code>å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ª<code>catch()</code>æ–¹æ³•ã€‚å®ƒæ˜¯è¢«å®šä¹‰æ¥å¤„ç†<code>Deferred</code>å¯¹è±¡<code>rejected</code>æˆ–è€… å®ƒçš„<code>Promise</code>å¯¹è±¡å¤„äºrejectedçš„æƒ…å†µï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deferred.catch(rejectedCallback)</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ–¹æ³•åªæ˜¯<code>then(null,rejectedCallback)</code>çš„ç®€å†™å½¢å¼ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘å‘ä½ ä»‹ç»äº†jQueryå¯¹äºpromisesçš„å®ç°æ–¹å¼ã€‚Promisesè®©ä½ ä¸ç”¨å¾ˆéº»çƒ¦åœ°è®©å¼‚æ­¥å‡½æ•°å¹¶è¡Œèµ·æ¥ï¼Œä¹Ÿä¸ç”¨åœ¨å›è°ƒå‡½æ•°é‡ŒåµŒå¥—å›è°ƒå‡½æ•°å†åµŒå¥—å›è°ƒå‡½æ•°â€¦â€¦</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä¹Ÿä»‹ç»äº†jQuery3æ€ä¹ˆæå‡å®ƒå’ŒåŸç”Ÿpromiseçš„å…¼å®¹æ€§ã€‚å°½ç®¡è€ç‰ˆæœ¬çš„jQueryå’ŒECMAScript 2015çš„è¿˜æœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä¸åŒï¼Œ<code>Deferred</code>å¯¹è±¡ä»ç„¶æ˜¯ä¸€ä¸ªä»¤äººéš¾ä»¥ç½®ä¿¡çš„å¼ºå¤§çš„å·¥å…·ã€‚ä½œä¸ºä¸€ä¸ªä¸“ä¸šçš„å¼€å‘è€…ï¼Œéšç€é¡¹ç›®éš¾åº¦çš„å¢åŠ ï¼Œä½ ä¼šå‘ç°ä½ ä¼šç»å¸¸ç”¨åˆ°å®ƒã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;(è¶ç€æ¯•è®¾è¦æ±‚ï¼Œç¿»è¯‘äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¡ºä¾¿æ”¾ä¸Šæ¥ã€‚è‹±æ–‡ä¸å¥½ç¿»äº†2å¤©æ‰ç¿»å®Œï¼Œ/(ã„’oã„’)/~~å¦‚æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£ã€‚)&lt;br&gt;åŸæ–‡é“¾æ¥:&lt;a href=&quot;http://www.sitepoint.com/introduction-jquery-deferred-objects/&quot; ta
      
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨Fiddlerè¿›è¡Œå‰ç«¯è°ƒè¯•</title>
    <link href="http://blog.chenkeyi.com/2016/02/24/%E5%88%A9%E7%94%A8fiddler%E8%BF%9B%E8%A1%8C%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95/"/>
    <id>http://blog.chenkeyi.com/2016/02/24/åˆ©ç”¨fiddlerè¿›è¡Œå‰ç«¯è°ƒè¯•/</id>
    <published>2016-02-24T01:34:50.000Z</published>
    <updated>2017-10-17T17:27:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åˆšgetäº†ä¸€ä¸ªå¾ˆæ–¹ä¾¿å‰ç«¯è°ƒè¯•çš„æ–°æŠ€èƒ½ï¼Œç‰¹åˆ«åœ¨å·²ä¸Šçº¿ç½‘é¡µä¸Šä¿®å¤bugçš„æ—¶å€™è°ƒè¯•å¾ˆå®ç”¨ï¼Œæ¯”å¦‚æˆ‘åœ¨æœ¬åœ°æ”¹äº†ä¸€ä¸ªtest1.jsæ–‡ä»¶æƒ³è¦æµ‹è¯•æ•ˆæœï¼Œä½†æ˜¯åˆä¸æƒ³å¾ˆéº»çƒ¦åœ°æ¨åˆ°æµ‹è¯•ç¯å¢ƒï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªå·¥å…·æŠŠçº¿ä¸Šçš„test1.jsæ–‡ä»¶è¯·æ±‚åˆ°è‡ªå·±çš„æœ¬åœ°test1.jsæ–‡ä»¶ï¼Œè¿™æ ·ä½ çš„ä»£ç å¯ä»¥ç›´æ¥è¿›è¡Œè°ƒè¯•äº†ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦ç”¨çš„å·¥å…·æ˜¯<a href="http://www.telerik.com/fiddler" target="_blank" rel="noopener">Fiddler</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œåœ¨è¿™é‡Œæˆ‘å°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹<a href="http://www.imooc.com/learn/37" target="_blank" rel="noopener">æ…•è¯¾ç½‘ï¼šFiddlerå·¥å…·çš„ä½¿ç”¨</a>ã€‚</p><p>æˆ‘ä»¬ç›´æ¥è¿›å…¥æ­£é¢˜ï¼šåˆ©ç”¨Fiddlerè¿›è¡Œå‰ç«¯è°ƒè¯•ã€‚</p><p>æ‰“å¼€è½¯ä»¶ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯è¿™æ ·çš„ç•Œé¢ï¼š<br><img src="https://raw.githubusercontent.com/cky917/blog/master/themes/mabao-theme/source/img/1.png" alt="è½¯ä»¶ç•Œé¢"><br>å·¦è¾¹é‚£äº›å°±æ˜¯ä½ çš„ç½‘ç»œè¯·æ±‚åˆ—è¡¨ï¼Œå³è¾¹æ˜¯ä¸€äº›å·¥å…·é¢æ¿ã€‚</p><p>æˆ‘ä»¬ä»¥coolmogu.comä¸ºä¾‹ï¼Œæ‰“å¼€æœ¬ç½‘ç«™ï¼Œå‡ºç°ä»¥ä¸‹è¯·æ±‚ï¼š<br><img src="https://raw.githubusercontent.com/cky917/blog/master/themes/mabao-theme/source/img/2.png" alt=""></p><p>å‡å¦‚æˆ‘ä»¬è¦ä¿®æ”¹index.jsï¼Œåœ¨æœ¬åœ°æˆ‘ä»¬æœ‰ä¸€ä¸ªindex.jsï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹å›¾</p><p><img src="https://raw.githubusercontent.com/cky917/blog/master/themes/mabao-theme/source/img/4.png" alt=""></p><p>è¿™æ ·å†åˆ·æ–°é¡µé¢ï¼Œå®é™…coolmogu.comä»¥åè¯·æ±‚çš„index.jså°±æ˜¯è¯·æ±‚çš„ä½ æœ¬åœ°çš„Index.jsäº†ã€‚å‡å¦‚æˆ‘index.jsé‡ŒåŠ äº†ä¸€è¡Œ<code>alert(&quot;cky&quot;)</code>, <img src="https://raw.githubusercontent.com/cky917/blog/master/themes/mabao-theme/source/img/3.png" alt=""> çœ‹çœ‹æ•ˆæœï¼š<br><img src="https://raw.githubusercontent.com/cky917/blog/master/themes/mabao-theme/source/img/5.png" alt=""></p><p>å¾ˆç®€å•å§ï¼Œè¿˜å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œcssæ–‡ä»¶è°ƒè¯•ç­‰~</p><p><img src="https://raw.githubusercontent.com/cky917/blog/master/themes/mabao-theme/source/img/6.jpg" alt=""></p><p>ï¼ˆæœ¬æ¥ä¹‹å‰ç”¨çš„å›¾åºŠï¼Œç»“æœå›¾åºŠæŒ‚äº†- -ï¼Œä»Šå¤©æ¥ä¿®å¤å›¾ç‰‡ã€‚ä»¥åå›¾ç‰‡è¿˜æ˜¯æ”¾åœ¨è‡ªå·±çš„githubä¸Šå§ï¼‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åˆšgetäº†ä¸€ä¸ªå¾ˆæ–¹ä¾¿å‰ç«¯è°ƒè¯•çš„æ–°æŠ€èƒ½ï¼Œç‰¹åˆ«åœ¨å·²ä¸Šçº¿ç½‘é¡µä¸Šä¿®å¤bugçš„æ—¶å€™è°ƒè¯•å¾ˆå®ç”¨ï¼Œæ¯”å¦‚æˆ‘åœ¨æœ¬åœ°æ”¹äº†ä¸€ä¸ªtest1.jsæ–‡ä»¶æƒ³è¦æµ‹è¯•æ•ˆæœï¼Œä½†æ˜¯åˆä¸æƒ³å¾ˆéº»çƒ¦åœ°æ¨åˆ°æµ‹è¯•ç¯å¢ƒï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªå·¥å…·æŠŠçº¿ä¸Šçš„test1.jsæ–‡ä»¶è¯·æ±‚åˆ°è‡ªå·±çš„æœ¬åœ°test1.jsæ–‡ä»¶ï¼Œè¿™æ ·ä½ çš„ä»£ç å¯ä»¥ç›´
      
    
    </summary>
    
    
      <category term="webå‰ç«¯çŸ¥è¯†" scheme="http://blog.chenkeyi.com/tags/web%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
</feed>
